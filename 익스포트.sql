--------------------------------------------------------
--  파일이 생성됨 - 화요일-11월-11-2025   
--------------------------------------------------------
--------------------------------------------------------
--  DDL for Sequence XSCADA_ALARM_LOG_SEQ
--------------------------------------------------------

   CREATE SEQUENCE  "INFINITY21_JSFMS"."XSCADA_ALARM_LOG_SEQ"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL ;
--------------------------------------------------------
--  DDL for Sequence XSCADA_DATATAG_LOG_SEQ
--------------------------------------------------------

   CREATE SEQUENCE  "INFINITY21_JSFMS"."XSCADA_DATATAG_LOG_SEQ"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 137596601 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL ;
--------------------------------------------------------
--  DDL for Sequence XSCADA_DATATAG_SEQ
--------------------------------------------------------

   CREATE SEQUENCE  "INFINITY21_JSFMS"."XSCADA_DATATAG_SEQ"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 850381 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL ;
--------------------------------------------------------
--  DDL for Sequence XSCADA_GROUP_SEQ
--------------------------------------------------------

   CREATE SEQUENCE  "INFINITY21_JSFMS"."XSCADA_GROUP_SEQ"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL ;
--------------------------------------------------------
--  DDL for Sequence XSCADA_MOBILE_SEQ
--------------------------------------------------------

   CREATE SEQUENCE  "INFINITY21_JSFMS"."XSCADA_MOBILE_SEQ"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL ;
--------------------------------------------------------
--  DDL for Sequence XSCADA_PROPERTIES_SEQ
--------------------------------------------------------

   CREATE SEQUENCE  "INFINITY21_JSFMS"."XSCADA_PROPERTIES_SEQ"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL ;
--------------------------------------------------------
--  DDL for Sequence XSCADA_SECURITY_KEY_SEQ
--------------------------------------------------------

   CREATE SEQUENCE  "INFINITY21_JSFMS"."XSCADA_SECURITY_KEY_SEQ"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL ;
--------------------------------------------------------
--  DDL for Sequence XSCADA_SECURITY_LOG_SEQ
--------------------------------------------------------

   CREATE SEQUENCE  "INFINITY21_JSFMS"."XSCADA_SECURITY_LOG_SEQ"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1301 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL ;
--------------------------------------------------------
--  DDL for Sequence XSCADA_SMS_LOG_SEQ
--------------------------------------------------------

   CREATE SEQUENCE  "INFINITY21_JSFMS"."XSCADA_SMS_LOG_SEQ"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL ;
--------------------------------------------------------
--  DDL for Sequence XSCADA_SYSTEM_LOG_SEQ
--------------------------------------------------------

   CREATE SEQUENCE  "INFINITY21_JSFMS"."XSCADA_SYSTEM_LOG_SEQ"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 995741 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL ;
--------------------------------------------------------
--  DDL for Sequence XSCADA_SYSTEM_SEQ
--------------------------------------------------------

   CREATE SEQUENCE  "INFINITY21_JSFMS"."XSCADA_SYSTEM_SEQ"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 2581 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL ;
--------------------------------------------------------
--  DDL for Sequence XSCADA_USER_SEQ
--------------------------------------------------------

   CREATE SEQUENCE  "INFINITY21_JSFMS"."XSCADA_USER_SEQ"  MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE  GLOBAL ;

--------------------------------------------------------
--  DDL for Table ICOM_MACHINE_DETAIL
--------------------------------------------------------

  CREATE TABLE "INFINITY21_JSFMS"."ICOM_MACHINE_DETAIL" 
   (	"MACHINE_CODE" VARCHAR2(20 BYTE), 
	"MACHINE_PROPERTY" VARCHAR2(20 BYTE), 
	"MACHINE_PROPERTY_VALUE" VARCHAR2(200 BYTE), 
	"COMMENTS" VARCHAR2(2000 BYTE), 
	"ENTER_DATE" DATE, 
	"ENTER_BY" VARCHAR2(20 BYTE), 
	"LAST_MODIFY_DATE" DATE, 
	"LAST_MODIFY_BY" VARCHAR2(20 BYTE), 
	"ORGANIZATION_ID" NUMBER DEFAULT 1
   ) SEGMENT CREATION DEFERRED 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Table ICOM_MACHINE_MASTER
--------------------------------------------------------

  CREATE TABLE "INFINITY21_JSFMS"."ICOM_MACHINE_MASTER" 
   (	"MACHINE_CODE" VARCHAR2(20 BYTE), 
	"MACHINE_NAME" VARCHAR2(200 BYTE) DEFAULT '*', 
	"MACHINE_NAME_ENG" VARCHAR2(200 BYTE) DEFAULT '*', 
	"MACHINE_SPEC" VARCHAR2(200 BYTE) DEFAULT '*', 
	"MACHINE_TYPE" VARCHAR2(20 BYTE) DEFAULT '*', 
	"MACHINE_STATUS" VARCHAR2(20 BYTE) DEFAULT 'N', 
	"MACHINE_GROUP" VARCHAR2(20 BYTE) DEFAULT '*', 
	"MACHINE_DIVISION" VARCHAR2(20 BYTE) DEFAULT '*', 
	"WORKSTAGE_CODE" VARCHAR2(20 BYTE) DEFAULT '*', 
	"PLC_CODE" VARCHAR2(20 BYTE) DEFAULT '*', 
	"LINE_CODE" VARCHAR2(20 BYTE) DEFAULT '*', 
	"MACHINE_LOCATION" VARCHAR2(50 BYTE) DEFAULT '*', 
	"USE_YN" VARCHAR2(1 BYTE) DEFAULT 'Y', 
	"COMMENTS" VARCHAR2(2000 BYTE), 
	"ENTER_DATE" DATE, 
	"ENTER_BY" VARCHAR2(20 BYTE), 
	"LAST_MODIFY_DATE" DATE, 
	"LAST_MODIFY_BY" VARCHAR2(20 BYTE), 
	"ORGANIZATION_ID" NUMBER DEFAULT 1, 
	"MACHINE_SEQ" NUMBER, 
	"EQP_STATE" VARCHAR2(20 BYTE), 
	"CONTROL_STATE" VARCHAR2(20 BYTE), 
	"ACTUAL_QTY" NUMBER, 
	"TACT_TIME_INOUT" NUMBER, 
	"TACT_TIME_SETUP" VARCHAR2(20 BYTE), 
	"TACT_TIME_INSTEP" NUMBER, 
	"TACT_TIME_OUTSTEP" NUMBER, 
	"MODEL_NAME" VARCHAR2(20 BYTE), 
	"CONTROL_STATE_TAG_ADDRESS" VARCHAR2(20 BYTE), 
	"EQP_STATE_TAG_ADDRESS" VARCHAR2(20 BYTE), 
	"MODEL_NAME_TAG_ADDRESS" VARCHAR2(20 BYTE), 
	"LAST_ALARM_TAG_ADDRESS" VARCHAR2(20 BYTE), 
	"LAST_ALARM_DATETIME" DATE, 
	"LAST_STATE_DATETIME" DATE, 
	"LAST_OPERATION_DATETIME" DATE
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;

   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_MACHINE_MASTER"."MACHINE_CODE" IS '설비코드';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_MACHINE_MASTER"."MACHINE_NAME" IS '설비명';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_MACHINE_MASTER"."MACHINE_NAME_ENG" IS '설비명영문';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_MACHINE_MASTER"."MACHINE_SPEC" IS '설비규격';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_MACHINE_MASTER"."MACHINE_TYPE" IS '설비타입';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_MACHINE_MASTER"."MACHINE_STATUS" IS '설비상태';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_MACHINE_MASTER"."MACHINE_GROUP" IS '설비그룹';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_MACHINE_MASTER"."MACHINE_DIVISION" IS '설비구분';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_MACHINE_MASTER"."WORKSTAGE_CODE" IS '설비가속한공정코드';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_MACHINE_MASTER"."PLC_CODE" IS 'PLC코드';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_MACHINE_MASTER"."LINE_CODE" IS '설비가속한라인코드';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_MACHINE_MASTER"."MACHINE_LOCATION" IS '설비위치';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_MACHINE_MASTER"."USE_YN" IS '사용여부';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_MACHINE_MASTER"."COMMENTS" IS '설명';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_MACHINE_MASTER"."ENTER_DATE" IS '등록일자';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_MACHINE_MASTER"."ENTER_BY" IS '등록자';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_MACHINE_MASTER"."LAST_MODIFY_DATE" IS '수정일자';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_MACHINE_MASTER"."LAST_MODIFY_BY" IS '수정자';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_MACHINE_MASTER"."ORGANIZATION_ID" IS '조직';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_MACHINE_MASTER"."MACHINE_SEQ" IS '설비순번';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_MACHINE_MASTER"."EQP_STATE" IS '동작상태';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_MACHINE_MASTER"."CONTROL_STATE" IS '운행모드';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_MACHINE_MASTER"."ACTUAL_QTY" IS '실적수량(마지막집계)';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_MACHINE_MASTER"."MODEL_NAME" IS '모델명';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_MACHINE_MASTER"."CONTROL_STATE_TAG_ADDRESS" IS '운행모드태그주소';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_MACHINE_MASTER"."EQP_STATE_TAG_ADDRESS" IS '동작상태태그주소';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_MACHINE_MASTER"."MODEL_NAME_TAG_ADDRESS" IS '모델명태그주소';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_MACHINE_MASTER"."LAST_ALARM_TAG_ADDRESS" IS '마지막알람태그주소';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_MACHINE_MASTER"."LAST_ALARM_DATETIME" IS '마지막알람발생일자';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_MACHINE_MASTER"."LAST_STATE_DATETIME" IS '마지막상태변화일자';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_MACHINE_MASTER"."LAST_OPERATION_DATETIME" IS '마지막동작값수집일자';
--------------------------------------------------------
--  DDL for Table ICOM_PLC_MASTER
--------------------------------------------------------

  CREATE TABLE "INFINITY21_JSFMS"."ICOM_PLC_MASTER" 
   (	"PLC_CODE" VARCHAR2(20 BYTE), 
	"PLC_NAME" VARCHAR2(200 BYTE) DEFAULT '*', 
	"PLC_SPEC" VARCHAR2(200 BYTE) DEFAULT '*', 
	"PLC_TYPE" VARCHAR2(20 BYTE) DEFAULT '*', 
	"PLC_STATUS" VARCHAR2(20 BYTE) DEFAULT 'N', 
	"PLC_GROUP" VARCHAR2(20 BYTE) DEFAULT '*', 
	"PLC_DIVISION" VARCHAR2(20 BYTE) DEFAULT '*', 
	"PLC_LOCATION" VARCHAR2(50 BYTE) DEFAULT '*', 
	"PLC_IP" VARCHAR2(50 BYTE) DEFAULT '*', 
	"PLC_PORT" VARCHAR2(50 BYTE) DEFAULT '*', 
	"PLC_USE_YN" VARCHAR2(1 BYTE) DEFAULT 'Y', 
	"COMMENTS" VARCHAR2(2000 BYTE), 
	"ENTER_DATE" DATE, 
	"ENTER_BY" VARCHAR2(20 BYTE), 
	"LAST_MODIFY_DATE" DATE, 
	"LAST_MODIFY_BY" VARCHAR2(20 BYTE), 
	"ORGANIZATION_ID" NUMBER DEFAULT 1, 
	"PIE_URL" VARCHAR2(100 BYTE), 
	"PLC_NETWORK_NO" NUMBER, 
	"PLC_STATION_NO" NUMBER, 
	"RMS_URL" VARCHAR2(100 BYTE), 
	"WELD_URL" VARCHAR2(100 BYTE), 
	"PRAICAM_URL" VARCHAR2(100 BYTE)
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;

   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_PLC_MASTER"."PLC_CODE" IS 'PLC코드';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_PLC_MASTER"."PLC_NAME" IS 'PLC명';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_PLC_MASTER"."PLC_SPEC" IS 'PLC규격';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_PLC_MASTER"."PLC_TYPE" IS 'PLC타입 MELSEC';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_PLC_MASTER"."PLC_STATUS" IS 'PLC 상태 N 정상 , S 정지 , F 고장';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_PLC_MASTER"."PLC_GROUP" IS '미정';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_PLC_MASTER"."PLC_DIVISION" IS '미정';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_PLC_MASTER"."PLC_LOCATION" IS 'PLC 설치위치';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_PLC_MASTER"."PLC_IP" IS 'PLC 통신아이피';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_PLC_MASTER"."PLC_PORT" IS 'PLC 통신포트 2001';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_PLC_MASTER"."PLC_USE_YN" IS '사용여부 Y , N';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_PLC_MASTER"."COMMENTS" IS '설명';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_PLC_MASTER"."PIE_URL" IS 'PIE 싸이트주소';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_PLC_MASTER"."PLC_NETWORK_NO" IS 'PLC 네트워크번호';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_PLC_MASTER"."PLC_STATION_NO" IS 'PLC 스테이션번호';
   COMMENT ON TABLE "INFINITY21_JSFMS"."ICOM_PLC_MASTER"  IS 'PLC 마스터 테이블';
--------------------------------------------------------
--  DDL for Table ICOM_PLC_TAG_MASTER
--------------------------------------------------------

  CREATE TABLE "INFINITY21_JSFMS"."ICOM_PLC_TAG_MASTER" 
   (	"PLC_CODE" VARCHAR2(20 BYTE), 
	"TAG_ID" VARCHAR2(200 BYTE) DEFAULT '*', 
	"TAG_ADDRESS" VARCHAR2(200 BYTE) DEFAULT '*', 
	"TAG_NAME" VARCHAR2(200 BYTE) DEFAULT '*', 
	"TAG_GROUP" VARCHAR2(100 BYTE) DEFAULT '*', 
	"TAG_TYPE" VARCHAR2(200 BYTE) DEFAULT '*', 
	"TAG_STATUS" VARCHAR2(20 BYTE) DEFAULT 'N', 
	"TAG_DIVISION" VARCHAR2(20 BYTE) DEFAULT '*', 
	"TAG_VALUE_TYPE" VARCHAR2(20 BYTE) DEFAULT '*', 
	"TAG_VALUE" VARCHAR2(30 BYTE), 
	"TAG_USE_YN" VARCHAR2(1 BYTE) DEFAULT 'Y', 
	"TAG_DATA_TYPE" VARCHAR2(20 BYTE), 
	"TAG_UNIT" VARCHAR2(10 BYTE), 
	"TAG_SCALE" NUMBER, 
	"MACHINE_CODE" VARCHAR2(100 BYTE) DEFAULT '*', 
	"COMMENTS" VARCHAR2(2000 BYTE), 
	"LAST_CHANGED_DATE" DATE, 
	"ENTER_DATE" DATE, 
	"ENTER_BY" VARCHAR2(20 BYTE), 
	"LAST_MODIFY_DATE" DATE, 
	"LAST_MODIFY_BY" VARCHAR2(20 BYTE), 
	"ORGANIZATION_ID" NUMBER DEFAULT 1, 
	"TAG_CLASS" VARCHAR2(20 BYTE), 
	"ALARM_GROUP_LVL1" VARCHAR2(50 BYTE), 
	"ALARM_GROUP_LVL2" VARCHAR2(50 BYTE), 
	"ALARM_GROUP_LVL3" VARCHAR2(50 BYTE), 
	"TARGET_MIN_VALUE" NUMBER, 
	"TARGET_MAX_VALUE" NUMBER
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;

   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_PLC_TAG_MASTER"."PLC_CODE" IS 'PLC 코드';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_PLC_TAG_MASTER"."TAG_ID" IS '태그식별자(임의값)';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_PLC_TAG_MASTER"."TAG_ADDRESS" IS '태그주소';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_PLC_TAG_MASTER"."TAG_NAME" IS '태그명';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_PLC_TAG_MASTER"."TAG_GROUP" IS '알람 (ALARM) / 동작(Operation) / 상태(STATE)';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_PLC_TAG_MASTER"."TAG_TYPE" IS '설비상태,
작동모드,
생산수량,
소모품목표,
소모품실적,
검사인자,
이상감지,
진입/배출,
생산정보,
(안착/완료)';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_PLC_TAG_MASTER"."TAG_STATUS" IS 'N 정상';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_PLC_TAG_MASTER"."TAG_DIVISION" IS 'L	부하율
W	경고
C	횟수
R	RPM
T	시간
V	전류치
S	정지';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_PLC_TAG_MASTER"."TAG_VALUE_TYPE" IS '값유형 D Digital';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_PLC_TAG_MASTER"."TAG_VALUE" IS '현재태그값';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_PLC_TAG_MASTER"."TAG_USE_YN" IS 'Y,N';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_PLC_TAG_MASTER"."TAG_DATA_TYPE" IS 'Boolean';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_PLC_TAG_MASTER"."TAG_UNIT" IS '표시단위';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_PLC_TAG_MASTER"."TAG_SCALE" IS '스케일값';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_PLC_TAG_MASTER"."MACHINE_CODE" IS '설비코드';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_PLC_TAG_MASTER"."COMMENTS" IS '주석';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_PLC_TAG_MASTER"."LAST_CHANGED_DATE" IS '태그값 마지막변경일자';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_PLC_TAG_MASTER"."ENTER_DATE" IS '등록일자';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_PLC_TAG_MASTER"."ENTER_BY" IS '등록자';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_PLC_TAG_MASTER"."LAST_MODIFY_DATE" IS '수정일자';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_PLC_TAG_MASTER"."LAST_MODIFY_BY" IS '수정자';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_PLC_TAG_MASTER"."ORGANIZATION_ID" IS '조직';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_PLC_TAG_MASTER"."TAG_CLASS" IS 'ST	정지
WN	경고
MS	수동정지
AS	자동정지
SF	안전
SA	안전';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_PLC_TAG_MASTER"."TARGET_MIN_VALUE" IS '목표최소값';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_PLC_TAG_MASTER"."TARGET_MAX_VALUE" IS '목표최대값';

--------------------------------------------------------
--  DDL for Table ICOM_RECIEVE_BIT_RAW
--------------------------------------------------------

  CREATE TABLE "INFINITY21_JSFMS"."ICOM_RECIEVE_BIT_RAW" 
   (	"PLC_CODE" VARCHAR2(20 BYTE), 
	"MACHINE_CODE" VARCHAR2(20 BYTE), 
	"TAG_ADDRESS" VARCHAR2(20 BYTE), 
	"TAG_VALUE" VARCHAR2(20 BYTE), 
	"MACHINE_DATETIME" VARCHAR2(30 BYTE), 
	"PLC_TIMESTAMP" TIMESTAMP (6), 
	"COMMENTS" VARCHAR2(1000 BYTE), 
	"ENTER_DATE" DATE, 
	"ENTER_BY" VARCHAR2(20 BYTE), 
	"ORGANIZATION_ID" NUMBER
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Table ICOM_RECIEVE_DATA_RAW
--------------------------------------------------------

  CREATE TABLE "INFINITY21_JSFMS"."ICOM_RECIEVE_DATA_RAW" 
   (	"MACHINE_DIV" VARCHAR2(20 BYTE), 
	"MACHINE_CODE" VARCHAR2(20 BYTE), 
	"MACHINE_STATUS_DIV" VARCHAR2(20 BYTE), 
	"MACHINE_STATUS_VALUE" VARCHAR2(20 BYTE), 
	"MACHINE_MESSAGE" VARCHAR2(1000 BYTE), 
	"MACHINE_DATETIME" VARCHAR2(30 BYTE), 
	"COMMENTS" VARCHAR2(1000 BYTE), 
	"ENTER_DATE" DATE, 
	"ENTER_BY" VARCHAR2(20 BYTE), 
	"ORGANIZATION_ID" NUMBER, 
	"PLC_CODE" VARCHAR2(20 BYTE) DEFAULT '*', 
	"TAG_ADDRESS" VARCHAR2(20 BYTE) DEFAULT '*', 
	"ALARM_START_DATETIME" DATE, 
	"ALARM_END_DATETIME" DATE, 
	"ALARM_TIME_TERM" NUMBER, 
	"PLC_TIMESTAMP" TIMESTAMP (6), 
	"TAG_TYPE" VARCHAR2(20 BYTE), 
	"IS_FIXED" VARCHAR2(20 BYTE), 
	"SCADA_ID" NUMBER, 
	"EQP_STATE" VARCHAR2(20 BYTE), 
	"CONTROL_STATE" VARCHAR2(20 BYTE), 
	"TAG_ADDRESS_REASON" VARCHAR2(20 BYTE)
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;

   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_RECIEVE_DATA_RAW"."MACHINE_DIV" IS '영역구분 PIE , WELD , RMS , PRAICAM , PLC';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_RECIEVE_DATA_RAW"."MACHINE_CODE" IS '설비코드';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_RECIEVE_DATA_RAW"."MACHINE_STATUS_DIV" IS '상태구분 ALARM , QC';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_RECIEVE_DATA_RAW"."MACHINE_STATUS_VALUE" IS '상태값 1 , 2';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_RECIEVE_DATA_RAW"."MACHINE_MESSAGE" IS '상태메시지';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_RECIEVE_DATA_RAW"."MACHINE_DATETIME" IS '전송일자 YYYYMMDDHH24MISS';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_RECIEVE_DATA_RAW"."COMMENTS" IS '설명';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_RECIEVE_DATA_RAW"."ENTER_DATE" IS '등록일자';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_RECIEVE_DATA_RAW"."ENTER_BY" IS '등록자';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_RECIEVE_DATA_RAW"."ORGANIZATION_ID" IS '조직';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_RECIEVE_DATA_RAW"."PLC_CODE" IS '트리거에서생성 : PLC 코드';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_RECIEVE_DATA_RAW"."TAG_ADDRESS" IS '스카다가전송 : TAG 주소';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_RECIEVE_DATA_RAW"."ALARM_START_DATETIME" IS '알람발생시간';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_RECIEVE_DATA_RAW"."ALARM_END_DATETIME" IS '알람해제시간';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_RECIEVE_DATA_RAW"."ALARM_TIME_TERM" IS '알람지속시간(분)';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_RECIEVE_DATA_RAW"."EQP_STATE" IS '현재설비상태';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_RECIEVE_DATA_RAW"."CONTROL_STATE" IS '현재작동모드 수동,자동';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_RECIEVE_DATA_RAW"."TAG_ADDRESS_REASON" IS '알람발생원인후속선택주소';
   COMMENT ON TABLE "INFINITY21_JSFMS"."ICOM_RECIEVE_DATA_RAW"  IS '설비알람발생 데이터 수집 테이블';
--------------------------------------------------------
--  DDL for Table ICOM_RECIEVE_DOWN_TIME_RAW
--------------------------------------------------------

  CREATE TABLE "INFINITY21_JSFMS"."ICOM_RECIEVE_DOWN_TIME_RAW" 
   (	"PLC_CODE" VARCHAR2(20 BYTE), 
	"MACHINE_CODE" VARCHAR2(20 BYTE), 
	"PLC_DATETIME" VARCHAR2(30 BYTE), 
	"TAG_ADDRESS" VARCHAR2(20 BYTE), 
	"DOWN_START_DATETIME" DATE, 
	"DOWN_END_DATETIME" DATE, 
	"DOWN_TIME_TERM" NUMBER, 
	"COMMENTS" VARCHAR2(2000 BYTE), 
	"ENTER_DATE" DATE, 
	"ENTER_BY" VARCHAR2(20 BYTE), 
	"LAST_MODIFY_DATE" DATE, 
	"LAST_MODIFY_BY" VARCHAR2(20 BYTE), 
	"ORGANIZATION_ID" NUMBER DEFAULT 1, 
	"TAG_VALUE" VARCHAR2(20 BYTE), 
	"TAG_VALUE_LAST" VARCHAR2(20 BYTE), 
	"IS_FIXED" VARCHAR2(20 BYTE) DEFAULT 'N'
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;

   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_RECIEVE_DOWN_TIME_RAW"."PLC_CODE" IS 'PLC코드';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_RECIEVE_DOWN_TIME_RAW"."MACHINE_CODE" IS '설비코드';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_RECIEVE_DOWN_TIME_RAW"."PLC_DATETIME" IS '설비발생시간';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_RECIEVE_DOWN_TIME_RAW"."TAG_ADDRESS" IS '태그주소';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_RECIEVE_DOWN_TIME_RAW"."DOWN_START_DATETIME" IS '정지시작시간';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_RECIEVE_DOWN_TIME_RAW"."DOWN_END_DATETIME" IS '정지완료시간';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_RECIEVE_DOWN_TIME_RAW"."DOWN_TIME_TERM" IS '정지시간(분)';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_RECIEVE_DOWN_TIME_RAW"."COMMENTS" IS '설명';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_RECIEVE_DOWN_TIME_RAW"."ENTER_DATE" IS '등록일자';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_RECIEVE_DOWN_TIME_RAW"."ENTER_BY" IS '등록자';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_RECIEVE_DOWN_TIME_RAW"."LAST_MODIFY_DATE" IS '수정일자';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_RECIEVE_DOWN_TIME_RAW"."LAST_MODIFY_BY" IS '수정자';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_RECIEVE_DOWN_TIME_RAW"."ORGANIZATION_ID" IS '조직';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_RECIEVE_DOWN_TIME_RAW"."TAG_VALUE" IS '태그값';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_RECIEVE_DOWN_TIME_RAW"."TAG_VALUE_LAST" IS '태그마지막값';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_RECIEVE_DOWN_TIME_RAW"."IS_FIXED" IS 'Y , N 정지가복구되었는지 구분';
--------------------------------------------------------
--  DDL for Table ICOM_RECIEVE_PLC_RAW
--------------------------------------------------------

  CREATE TABLE "INFINITY21_JSFMS"."ICOM_RECIEVE_PLC_RAW" 
   (	"PLC_CODE" VARCHAR2(20 BYTE), 
	"MACHINE_CODE" VARCHAR2(20 BYTE), 
	"PLC_DATETIME" VARCHAR2(30 BYTE), 
	"TAG_ADDRESS" VARCHAR2(20 BYTE), 
	"TAG_VALUE" VARCHAR2(100 BYTE), 
	"COMMENTS" VARCHAR2(1000 BYTE), 
	"ENTER_DATE" DATE, 
	"ENTER_BY" VARCHAR2(20 BYTE), 
	"ORGANIZATION_ID" NUMBER, 
	"TAG_DATA_TYPE" VARCHAR2(20 BYTE), 
	"TAG_TYPE" VARCHAR2(20 BYTE) DEFAULT 'N', 
	"PLC_TIMESTAMP" TIMESTAMP (6), 
	"TAG_TYPE_R" VARCHAR2(20 BYTE)
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" 
  PARALLEL 4 ;

   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_RECIEVE_PLC_RAW"."PLC_CODE" IS 'PLC코드 PLC01 , PLC02 , PLC03';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_RECIEVE_PLC_RAW"."MACHINE_CODE" IS '설비코드(트리거에서입력)';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_RECIEVE_PLC_RAW"."PLC_DATETIME" IS '수집일자시간';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_RECIEVE_PLC_RAW"."TAG_ADDRESS" IS 'TAG주소';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_RECIEVE_PLC_RAW"."TAG_VALUE" IS 'TAG값';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_RECIEVE_PLC_RAW"."COMMENTS" IS '설명';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_RECIEVE_PLC_RAW"."ENTER_DATE" IS '등록일자';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_RECIEVE_PLC_RAW"."ENTER_BY" IS '등록자';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_RECIEVE_PLC_RAW"."ORGANIZATION_ID" IS '조직';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_RECIEVE_PLC_RAW"."TAG_DATA_TYPE" IS '데이터타입';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_RECIEVE_PLC_RAW"."TAG_TYPE" IS '태그유형 알람,
소모품실적,
이상감지,
작동모드,
소모품목표,
설비상태,
검사인자,
생산수량,
생산정보,
진입/배출,
(안착/완료)';
--------------------------------------------------------
--  DDL for Table ICOM_TROUBLE_SOLVE_HIST
--------------------------------------------------------

  CREATE TABLE "INFINITY21_JSFMS"."ICOM_TROUBLE_SOLVE_HIST" 
   (	"MACHINE_CODE" VARCHAR2(20 BYTE), 
	"TROUBLE_DATETIME" DATE, 
	"SOLVE_ACTION_DATETIME" DATE DEFAULT SYSDATE, 
	"SOLVE_ACTION_DESC" VARCHAR2(1000 BYTE), 
	"COMMENTS" VARCHAR2(2000 BYTE), 
	"ENTER_DATE" DATE DEFAULT SYSDATE, 
	"ENTER_BY" VARCHAR2(20 BYTE), 
	"LAST_MODIFY_DATE" DATE DEFAULT SYSDATE, 
	"LAST_MODIFY_BY" VARCHAR2(20 BYTE), 
	"ORGANIZATION_ID" NUMBER DEFAULT 1
   ) SEGMENT CREATION DEFERRED 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Table ICOM_WORKSTAGE_MASTER
--------------------------------------------------------

  CREATE TABLE "INFINITY21_JSFMS"."ICOM_WORKSTAGE_MASTER" 
   (	"WORKSTAGE_CODE" VARCHAR2(20 BYTE), 
	"WORKSTAGE_NAME" VARCHAR2(200 BYTE) DEFAULT '*', 
	"WORKSTAGE_SPEC" VARCHAR2(200 BYTE) DEFAULT '*', 
	"WORKSTAGE_TYPE" VARCHAR2(20 BYTE) DEFAULT '*', 
	"WORKSTAGE_STATUS" VARCHAR2(20 BYTE) DEFAULT 'N', 
	"WORKSTAGE_GROUP" VARCHAR2(20 BYTE) DEFAULT '*', 
	"WORKSTAGE_DIVISION" VARCHAR2(20 BYTE) DEFAULT '*', 
	"WORKSTAGE_DESC" VARCHAR2(100 BYTE) DEFAULT '*', 
	"WORKSTAGE_SEQ" NUMBER, 
	"USE_YN" VARCHAR2(1 BYTE) DEFAULT 'Y', 
	"COMMENTS" VARCHAR2(2000 BYTE), 
	"ENTER_DATE" DATE, 
	"ENTER_BY" VARCHAR2(20 BYTE), 
	"LAST_MODIFY_DATE" DATE, 
	"LAST_MODIFY_BY" VARCHAR2(20 BYTE), 
	"ORGANIZATION_ID" NUMBER DEFAULT 1, 
	"MODEL_NAME" VARCHAR2(50 BYTE), 
	"MODEL_SETTING_NO" VARCHAR2(50 BYTE), 
	"WORK_ORDER_NO" VARCHAR2(20 BYTE), 
	"PLAN_QTY" NUMBER, 
	"ACTUAL_QTY" NUMBER, 
	"TACT_TIME_INOUT" NUMBER, 
	"TACT_TIME_SETUP" NUMBER, 
	"CONTROL_STATE" VARCHAR2(20 BYTE) DEFAULT '2', 
	"EQP_STATE" VARCHAR2(20 BYTE) DEFAULT '0', 
	"TACT_TIME_INSTEP" NUMBER, 
	"TACT_TIME_OUTSTEP" NUMBER
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;

   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_WORKSTAGE_MASTER"."WORKSTAGE_CODE" IS '공정코드';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_WORKSTAGE_MASTER"."WORKSTAGE_NAME" IS '공정명';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_WORKSTAGE_MASTER"."WORKSTAGE_SPEC" IS '공정규격';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_WORKSTAGE_MASTER"."WORKSTAGE_TYPE" IS '공정유형(미정)';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_WORKSTAGE_MASTER"."WORKSTAGE_STATUS" IS '공정상태 0 초기화,1 IDLE , 2 RUN , 3 DOWN , 4 SKIP , 5 DISCONNECT';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_WORKSTAGE_MASTER"."WORKSTAGE_GROUP" IS '미정';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_WORKSTAGE_MASTER"."WORKSTAGE_DIVISION" IS '미정';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_WORKSTAGE_MASTER"."WORKSTAGE_DESC" IS '상세설명';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_WORKSTAGE_MASTER"."WORKSTAGE_SEQ" IS '공정순서';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_WORKSTAGE_MASTER"."USE_YN" IS '사용여부';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_WORKSTAGE_MASTER"."COMMENTS" IS '설명';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_WORKSTAGE_MASTER"."MODEL_NAME" IS '모델명';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_WORKSTAGE_MASTER"."MODEL_SETTING_NO" IS '모델세팅번호';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_WORKSTAGE_MASTER"."WORK_ORDER_NO" IS '제조번호';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_WORKSTAGE_MASTER"."PLAN_QTY" IS '계획수량';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_WORKSTAGE_MASTER"."ACTUAL_QTY" IS '실적수량';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_WORKSTAGE_MASTER"."TACT_TIME_INOUT" IS 'TACT TIME 진입/배출';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_WORKSTAGE_MASTER"."TACT_TIME_SETUP" IS 'TACT TIME 안착/완료';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_WORKSTAGE_MASTER"."CONTROL_STATE" IS '1 수동 , 2 자동 ';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_WORKSTAGE_MASTER"."EQP_STATE" IS '0:초기값
1:Idle
2:Run
3:Down(알람)
4:Skip(Pass)
5:Disconnect';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_WORKSTAGE_MASTER"."TACT_TIME_INSTEP" IS '진입스텝 택타임';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ICOM_WORKSTAGE_MASTER"."TACT_TIME_OUTSTEP" IS '배출스텝 택타임';
   COMMENT ON TABLE "INFINITY21_JSFMS"."ICOM_WORKSTAGE_MASTER"  IS '공정코드마스터 테이블

0 : Initialize     : 설비 초기화 - PLC 재기동시 초기값
1 : Idle           : 설비의 상태가 정상이며 제품을 기다리는 상태로 진입/배출 시간을 포함한다.
 - 진입, 배출 시 걸리는 시간도 구분 필요함
2 : Run          : 해당 공정에 맞게 제품을 제작하는 실질적인 시간으로 설비로 진입/배출 시간을 미포함 한다.
                      → (진입 ▶) 가공/제작 (▶ 배출)
3 : Down        : 설비 문제가 있어 멈춘상태(알람 등), 설비가 메뉴얼 모드로 작동 하고 하고 있는 상태
4 : Skip          : 값은 Skip 으로 따로 받으나 모니터링 화면에 Idle 과 동일하게 표기함.
                    예) 모델에 따라 사용 미사용 하는 경우로 예를 들어 컴프에서 3점, 4점 용접이 모델따라 다름
5 : Disconnect : 설비와 네트워크가 끊어진 상태
                       가동율 계산 시 Down에 포함하여 계산함.';
--------------------------------------------------------
--  DDL for Table ICOM_WORK_CAPA_CALENDAR
--------------------------------------------------------

  CREATE TABLE "INFINITY21_JSFMS"."ICOM_WORK_CAPA_CALENDAR" 
   (	"PLAN_DATE" DATE, 
	"MACHINE_CODE" VARCHAR2(20 BYTE), 
	"PLAN_START_TIME" DATE, 
	"PLAN_END_TIME" DATE, 
	"PLAN_TIME" NUMBER, 
	"PLAN_REST_TIME" NUMBER, 
	"MANAGE_REST_TIME" NUMBER, 
	"LOAD_TIME" NUMBER, 
	"SHIFT_CODE" VARCHAR2(1 BYTE), 
	"ENTER_DATE" DATE, 
	"ENTER_BY" VARCHAR2(20 BYTE), 
	"LAST_MODIFY_DATE" DATE, 
	"LAST_MODIFY_BY" VARCHAR2(20 BYTE), 
	"ORGANIZATION_ID" NUMBER
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Table ISYS_BASECODE_MASTER
--------------------------------------------------------

  CREATE TABLE "INFINITY21_JSFMS"."ISYS_BASECODE_MASTER" 
   (	"CODE_TYPE" VARCHAR2(30 BYTE), 
	"CODE_NAME" VARCHAR2(100 BYTE), 
	"CODE_VALUE" VARCHAR2(100 BYTE), 
	"ORGANIZATION_ID" NUMBER, 
	"CODE_MEAN_KOR" VARCHAR2(100 BYTE), 
	"CODE_MEAN_ENG" VARCHAR2(100 BYTE), 
	"CODE_MEAN_LOCAL" VARCHAR2(100 BYTE), 
	"CODE_NAME_DESCRIPTION_KOR" VARCHAR2(100 BYTE), 
	"CODE_NAME_DESCRIPTION_ENG" VARCHAR2(100 BYTE), 
	"CODE_NAME_DESCRIPTION_LOCAL" VARCHAR2(100 BYTE), 
	"CODE_TYPE_DESC_KOR" VARCHAR2(100 BYTE), 
	"CODE_TYPE_DESC_ENG" VARCHAR2(100 BYTE), 
	"CODE_TYPE_DESC_LOCAL" VARCHAR2(100 BYTE), 
	"CODE_GROUP" VARCHAR2(100 BYTE), 
	"ENTER_DATE" DATE, 
	"ENTER_BY" VARCHAR2(20 BYTE), 
	"LAST_MODIFY_DATE" DATE, 
	"LAST_MODIFY_BY" VARCHAR2(20 BYTE)
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;

   COMMENT ON COLUMN "INFINITY21_JSFMS"."ISYS_BASECODE_MASTER"."CODE_TYPE" IS '코드타입';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ISYS_BASECODE_MASTER"."CODE_NAME" IS '코드명';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ISYS_BASECODE_MASTER"."CODE_VALUE" IS '코드값';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ISYS_BASECODE_MASTER"."ORGANIZATION_ID" IS '조직';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ISYS_BASECODE_MASTER"."CODE_MEAN_KOR" IS '코드의미한글';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ISYS_BASECODE_MASTER"."CODE_MEAN_ENG" IS '코드의미영문';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ISYS_BASECODE_MASTER"."CODE_MEAN_LOCAL" IS '코드의미로컬';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ISYS_BASECODE_MASTER"."CODE_NAME_DESCRIPTION_KOR" IS '코드명상세설명한글';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ISYS_BASECODE_MASTER"."CODE_NAME_DESCRIPTION_ENG" IS '코드명상세설명영문';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ISYS_BASECODE_MASTER"."CODE_NAME_DESCRIPTION_LOCAL" IS '코드명상세설명로컬';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ISYS_BASECODE_MASTER"."CODE_TYPE_DESC_KOR" IS '코드타입상세설명한글';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ISYS_BASECODE_MASTER"."CODE_TYPE_DESC_ENG" IS '코드타입상세설명영문';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ISYS_BASECODE_MASTER"."CODE_TYPE_DESC_LOCAL" IS '코드타입상세설명로컬';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ISYS_BASECODE_MASTER"."CODE_GROUP" IS '코드그룹';
   COMMENT ON TABLE "INFINITY21_JSFMS"."ISYS_BASECODE_MASTER"  IS '기초코드관리 마스터 테이블';
--------------------------------------------------------
--  DDL for Table ISYS_CONFIG_MASTER
--------------------------------------------------------

  CREATE TABLE "INFINITY21_JSFMS"."ISYS_CONFIG_MASTER" 
   (	"CONFIG_NAME" VARCHAR2(100 BYTE), 
	"ORGANIZATION_ID" NUMBER, 
	"CONFIG_DESCRIPTION" VARCHAR2(100 BYTE), 
	"CONFIG_VALUE" VARCHAR2(100 BYTE), 
	"CONFIG_VALUE_DESCRIPTION" VARCHAR2(100 BYTE), 
	"USE_YN" VARCHAR2(1 BYTE), 
	"ENTER_DATE" DATE, 
	"ENTER_BY" VARCHAR2(20 BYTE), 
	"LAST_MODIFY_DATE" DATE, 
	"LAST_MODIFY_BY" VARCHAR2(20 BYTE)
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;

   COMMENT ON COLUMN "INFINITY21_JSFMS"."ISYS_CONFIG_MASTER"."CONFIG_NAME" IS '환경설정기준명';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ISYS_CONFIG_MASTER"."ORGANIZATION_ID" IS '조직';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ISYS_CONFIG_MASTER"."CONFIG_DESCRIPTION" IS '환경설정설명';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ISYS_CONFIG_MASTER"."CONFIG_VALUE" IS '환경설정값';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ISYS_CONFIG_MASTER"."CONFIG_VALUE_DESCRIPTION" IS '환경설정값설명';
   COMMENT ON COLUMN "INFINITY21_JSFMS"."ISYS_CONFIG_MASTER"."USE_YN" IS '사용여부';
   COMMENT ON TABLE "INFINITY21_JSFMS"."ISYS_CONFIG_MASTER"  IS '시스템 환경설정 마스터 테이블';
--------------------------------------------------------
--  DDL for Table TB_ADM_BATCHJOBERRORLOG
--------------------------------------------------------

  CREATE TABLE "INFINITY21_JSFMS"."TB_ADM_BATCHJOBERRORLOG" 
   (	"BATCH_JOB_SEQ" NUMBER, 
	"ORGANIZATION_ID" NUMBER, 
	"BATCH_JOB_PROCESS_NAME" VARCHAR2(50 BYTE), 
	"BATCH_JOB_OBJECT_NAME" VARCHAR2(100 BYTE), 
	"BATCH_JOB_STATUS_CODE" VARCHAR2(10 BYTE), 
	"BATCH_JOB_REMARK" VARCHAR2(400 BYTE), 
	"WORKED_BY" VARCHAR2(40 BYTE), 
	"LOG_DATE" DATE
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Table T_DASHBOARD_ITEMS
--------------------------------------------------------

  CREATE TABLE "INFINITY21_JSFMS"."T_DASHBOARD_ITEMS" 
   (	"ITEM_IDENT" NUMBER GENERATED ALWAYS AS IDENTITY MINVALUE 1 MAXVALUE 9999999999999999999999999999 INCREMENT BY 1 START WITH 1 CACHE 20 NOORDER  NOCYCLE  NOKEEP  NOSCALE , 
	"DASHBOARD_IDENT" NUMBER, 
	"ITEM_TITLE" VARCHAR2(200 BYTE), 
	"ITEM_WIDTH" NUMBER, 
	"ITEM_HEIGHT" NUMBER, 
	"ITEM_ORDER_NUMBER" NUMBER, 
	"TYPE_ID" VARCHAR2(50 BYTE), 
	"ATTRIBUTE_01_C" CLOB, 
	"ATTRIBUTE_01" VARCHAR2(4000 CHAR), 
	"ATTRIBUTE_02" VARCHAR2(4000 CHAR), 
	"ATTRIBUTE_03" VARCHAR2(4000 CHAR), 
	"ATTRIBUTE_04" VARCHAR2(4000 CHAR), 
	"ATTRIBUTE_05" VARCHAR2(4000 CHAR)
   ) SEGMENT CREATION DEFERRED 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  TABLESPACE "USERS" 
 LOB ("ATTRIBUTE_01_C") STORE AS SECUREFILE (
  TABLESPACE "USERS" ENABLE STORAGE IN ROW CHUNK 8192
  NOCACHE LOGGING  NOCOMPRESS  KEEP_DUPLICATES ) ;
--------------------------------------------------------
--  DDL for Table T_DASHBOARD_ITEM_TYPES
--------------------------------------------------------

  CREATE TABLE "INFINITY21_JSFMS"."T_DASHBOARD_ITEM_TYPES" 
   (	"TYPE_ID" VARCHAR2(100 BYTE), 
	"TITLE" VARCHAR2(200 BYTE), 
	"DESCRIPTION" VARCHAR2(1000 BYTE), 
	"ICON" VARCHAR2(50 BYTE), 
	"DEFAULT_WIDTH" NUMBER, 
	"DEFAULT_HEIGHT" NUMBER
   ) SEGMENT CREATION DEFERRED 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Table XSCADA_ALARM_LOG
--------------------------------------------------------

  CREATE TABLE "INFINITY21_JSFMS"."XSCADA_ALARM_LOG" 
   (	"ID" NUMBER(19,0), 
	"CTIME" TIMESTAMP (3) DEFAULT CURRENT_TIMESTAMP, 
	"OTIME" TIMESTAMP (3), 
	"NAME" NVARCHAR2(100), 
	"LEVEL_" NUMBER(*,0) DEFAULT 1, 
	"ZONE" NVARCHAR2(100) DEFAULT '(empty)', 
	"STATUS" CHAR(1 BYTE) DEFAULT 'N', 
	"MESSAGE" NVARCHAR2(255) DEFAULT '(empty)', 
	"DATATAG_NAME" NVARCHAR2(255), 
	"DATATAG_VALUE" NVARCHAR2(255) DEFAULT '(empty)' -- 태그 값
		, 
	"ACK_YN" CHAR(1 BYTE) DEFAULT 'N'
   ) SEGMENT CREATION DEFERRED 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Table XSCADA_DATATAG
--------------------------------------------------------

  CREATE TABLE "INFINITY21_JSFMS"."XSCADA_DATATAG" 
   (	"ID" NUMBER(19,0), 
	"CTIME" TIMESTAMP (3) DEFAULT CURRENT_TIMESTAMP, 
	"MTIME" TIMESTAMP (3) DEFAULT CURRENT_TIMESTAMP, 
	"NAME" NVARCHAR2(255), 
	"TYPE" CHAR(1 BYTE) DEFAULT 'A', 
	"TAG_DESC" NVARCHAR2(255), 
	"LAST_VALUE_STR" NVARCHAR2(255), 
	"LAST_VALUE_NUM" NUMBER
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Table XSCADA_DATATAG_LOG
--------------------------------------------------------

  CREATE TABLE "INFINITY21_JSFMS"."XSCADA_DATATAG_LOG" 
   (	"ID" NUMBER(19,0), 
	"CTIME" TIMESTAMP (6) DEFAULT CURRENT_TIMESTAMP, 
	"OTIME" TIMESTAMP (6), 
	"DATATAG_NAME" NVARCHAR2(255), 
	"DATATAG_TYPE" CHAR(1 BYTE) DEFAULT 'A', 
	"VALUE_STR" NVARCHAR2(255), 
	"VALUE_NUM" NUMBER, 
	"VALUE_RAW" NVARCHAR2(2000)
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Table XSCADA_DATA_REPOSITORY
--------------------------------------------------------

  CREATE TABLE "INFINITY21_JSFMS"."XSCADA_DATA_REPOSITORY" 
   (	"CTIME" TIMESTAMP (3) DEFAULT CURRENT_TIMESTAMP, 
	"MTIME" TIMESTAMP (3) DEFAULT CURRENT_TIMESTAMP, 
	"KEY_" NVARCHAR2(255), 
	"VALUE" NCLOB
   ) SEGMENT CREATION DEFERRED 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  TABLESPACE "USERS" 
 LOB ("VALUE") STORE AS SECUREFILE (
  TABLESPACE "USERS" ENABLE STORAGE IN ROW CHUNK 8192
  NOCACHE LOGGING  NOCOMPRESS  KEEP_DUPLICATES ) ;
--------------------------------------------------------
--  DDL for Table XSCADA_GROUP
--------------------------------------------------------

  CREATE TABLE "INFINITY21_JSFMS"."XSCADA_GROUP" 
   (	"IDX" NUMBER(19,0), 
	"CTIME" TIMESTAMP (3), 
	"MTIME" TIMESTAMP (3), 
	"GROUPFULLNAME" NVARCHAR2(255), 
	"GROUPNAME" NVARCHAR2(255), 
	"DESCRIPTION" NVARCHAR2(2000), 
	"DELETED" CHAR(1 BYTE)
   ) SEGMENT CREATION DEFERRED 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Table XSCADA_GROUP_KEY_REF
--------------------------------------------------------

  CREATE TABLE "INFINITY21_JSFMS"."XSCADA_GROUP_KEY_REF" 
   (	"GROUPIDX" NUMBER(19,0), 
	"KEYIDX" NUMBER(19,0)
   ) SEGMENT CREATION DEFERRED 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Table XSCADA_LOGIN_USER
--------------------------------------------------------

  CREATE TABLE "INFINITY21_JSFMS"."XSCADA_LOGIN_USER" 
   (	"SESSION_" NVARCHAR2(140), 
	"CTIME" TIMESTAMP (3), 
	"LASTACCESS" TIMESTAMP (3), 
	"USERID" NVARCHAR2(100), 
	"HOST" NVARCHAR2(50), 
	"WEBLOGIN" CHAR(1 BYTE), 
	"TOTALKEYS" NCLOB, 
	"TIMEOUTMIN" NUMBER(10,0)
   ) SEGMENT CREATION DEFERRED 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  TABLESPACE "USERS" 
 LOB ("TOTALKEYS") STORE AS SECUREFILE (
  TABLESPACE "USERS" ENABLE STORAGE IN ROW CHUNK 8192
  NOCACHE LOGGING  NOCOMPRESS  KEEP_DUPLICATES ) ;
--------------------------------------------------------
--  DDL for Table XSCADA_MOBILE
--------------------------------------------------------

  CREATE TABLE "INFINITY21_JSFMS"."XSCADA_MOBILE" 
   (	"ID" NUMBER(19,0), 
	"CTIME" TIMESTAMP (3) DEFAULT CURRENT_TIMESTAMP, 
	"MTIME" TIMESTAMP (3) DEFAULT CURRENT_TIMESTAMP, 
	"NAME" NVARCHAR2(100), 
	"TYPE" NVARCHAR2(100) DEFAULT '(empty)', 
	"HOST" NVARCHAR2(100) DEFAULT '(empty)', 
	"PUSH_KEY" NVARCHAR2(100) DEFAULT '(empty)'
   ) SEGMENT CREATION DEFERRED 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Table XSCADA_OPERATION
--------------------------------------------------------

  CREATE TABLE "INFINITY21_JSFMS"."XSCADA_OPERATION" 
   (	"TIME" TIMESTAMP (6), 
	"NAME" VARCHAR2(200 BYTE), 
	"VALUE" VARCHAR2(100 BYTE)
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Table XSCADA_PROPERTIES
--------------------------------------------------------

  CREATE TABLE "INFINITY21_JSFMS"."XSCADA_PROPERTIES" 
   (	"IDX" NUMBER(19,0), 
	"NAME" NVARCHAR2(255), 
	"VALUE" NVARCHAR2(255)
   ) SEGMENT CREATION DEFERRED 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Table XSCADA_SECURITY_KEY
--------------------------------------------------------

  CREATE TABLE "INFINITY21_JSFMS"."XSCADA_SECURITY_KEY" 
   (	"IDX" NUMBER(19,0), 
	"CTIME" TIMESTAMP (3), 
	"MTIME" TIMESTAMP (3), 
	"KEYVALUE" NVARCHAR2(255), 
	"CATEGORY" NVARCHAR2(255), 
	"DESCRIPTION" NVARCHAR2(2000), 
	"DELETED" CHAR(1 BYTE)
   ) SEGMENT CREATION DEFERRED 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Table XSCADA_SECURITY_LOG
--------------------------------------------------------

  CREATE TABLE "INFINITY21_JSFMS"."XSCADA_SECURITY_LOG" 
   (	"IDX" NUMBER(19,0), 
	"CTIME" TIMESTAMP (3) DEFAULT CURRENT_TIMESTAMP, 
	"OTIME" TIMESTAMP (3), 
	"ID" NVARCHAR2(100), 
	"HOST" NVARCHAR2(100), 
	"ACTION" NVARCHAR2(100), 
	"TAG" NVARCHAR2(100), 
	"CURRENTVALUE" NVARCHAR2(255), 
	"NEWVALUE" NVARCHAR2(255), 
	"TAGDESCRIPTION" NVARCHAR2(2000), 
	"MESSAGE" NVARCHAR2(2000), 
	"SOURCE" NVARCHAR2(100)
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Table XSCADA_SMS_LOG
--------------------------------------------------------

  CREATE TABLE "INFINITY21_JSFMS"."XSCADA_SMS_LOG" 
   (	"ID" NUMBER(19,0), 
	"CTIME" TIMESTAMP (3) DEFAULT CURRENT_TIMESTAMP, 
	"MTIME" TIMESTAMP (3) DEFAULT CURRENT_TIMESTAMP, 
	"NAME" NVARCHAR2(100), 
	"USER_" NVARCHAR2(63), 
	"ADDRESS" NVARCHAR2(63), 
	"MESSAGE" NVARCHAR2(255) DEFAULT '(empty)', 
	"STATUS" CHAR(1 BYTE) DEFAULT 'W', 
	"SENDING_TIME" TIMESTAMP (3), 
	"SENT_TIME" TIMESTAMP (3), 
	"TRIAL_COUNT" NUMBER(*,0)
   ) SEGMENT CREATION DEFERRED 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Table XSCADA_SYSTEM
--------------------------------------------------------

  CREATE TABLE "INFINITY21_JSFMS"."XSCADA_SYSTEM" 
   (	"ID" NUMBER(19,0), 
	"CTIME" TIMESTAMP (3) DEFAULT CURRENT_TIMESTAMP, 
	"MTIME" TIMESTAMP (3) DEFAULT CURRENT_TIMESTAMP, 
	"KEY" NVARCHAR2(255), 
	"VALUE" NVARCHAR2(2000)
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Table XSCADA_SYSTEM_LOG
--------------------------------------------------------

  CREATE TABLE "INFINITY21_JSFMS"."XSCADA_SYSTEM_LOG" 
   (	"ID" NUMBER(19,0), 
	"CTIME" TIMESTAMP (3) DEFAULT CURRENT_TIMESTAMP, 
	"OTIME" TIMESTAMP (3), 
	"CATEGORY" NVARCHAR2(32), 
	"LEVEL_" NVARCHAR2(32), 
	"MESSAGE" NVARCHAR2(2000)
   ) SEGMENT CREATION IMMEDIATE 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Table XSCADA_USER
--------------------------------------------------------

  CREATE TABLE "INFINITY21_JSFMS"."XSCADA_USER" 
   (	"IDX" NUMBER(19,0), 
	"CTIME" TIMESTAMP (3), 
	"MTIME" TIMESTAMP (3), 
	"USERID" NVARCHAR2(100), 
	"PASSWORD" NVARCHAR2(255), 
	"USERTYPE" NVARCHAR2(100), 
	"DESCRIPTION" NVARCHAR2(2000), 
	"ACTIVE" CHAR(1 BYTE), 
	"TIMEOUTMIN" NUMBER(10,0), 
	"PROVIDER" NVARCHAR2(50), 
	"DELETED" CHAR(1 BYTE)
   ) SEGMENT CREATION DEFERRED 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Table XSCADA_USER_GROUP_REF
--------------------------------------------------------

  CREATE TABLE "INFINITY21_JSFMS"."XSCADA_USER_GROUP_REF" 
   (	"USERIDX" NUMBER(19,0), 
	"GROUPIDX" NUMBER(19,0)
   ) SEGMENT CREATION DEFERRED 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Table XSCADA_USER_KEY_REF
--------------------------------------------------------

  CREATE TABLE "INFINITY21_JSFMS"."XSCADA_USER_KEY_REF" 
   (	"USERIDX" NUMBER(19,0), 
	"KEYIDX" NUMBER(19,0)
   ) SEGMENT CREATION DEFERRED 
  PCTFREE 10 PCTUSED 40 INITRANS 1 MAXTRANS 255 
 NOCOMPRESS LOGGING
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for View VIEW_ALARM_CODE_MASTER
--------------------------------------------------------

  CREATE OR REPLACE FORCE EDITIONABLE VIEW "INFINITY21_JSFMS"."VIEW_ALARM_CODE_MASTER" ("PLC_CODE", "TAG_ID", "TAG_ADDRESS", "TAG_NAME", "TAG_GROUP", "TAG_TYPE", "TAG_STATUS", "TAG_DIVISION", "TAG_VALUE_TYPE", "TAG_VALUE", "TAG_USE_YN", "TAG_DATA_TYPE", "TAG_UNIT", "TAG_SCALE", "MACHINE_CODE", "MACHINE_NAME", "COMMENTS", "LAST_CHANGED_DATE", "ENTER_DATE", "ENTER_BY", "LAST_MODIFY_DATE", "LAST_MODIFY_BY", "ORGANIZATION_ID", "TAG_CLASS", "ALARM_GROUP_LVL1", "ALARM_GROUP_LVL2", "ALARM_GROUP_LVL3") AS 
  SELECT "PLC_CODE","TAG_ID","TAG_ADDRESS","TAG_NAME",
       "TAG_GROUP","TAG_TYPE","TAG_STATUS","TAG_DIVISION",
       "TAG_VALUE_TYPE","TAG_VALUE","TAG_USE_YN","TAG_DATA_TYPE",
       "TAG_UNIT","TAG_SCALE",
       "MACHINE_CODE",
       F_GET_MACHINE_NAME("MACHINE_CODE") MACHINE_NAME ,
       "COMMENTS",
       "LAST_CHANGED_DATE",
       "ENTER_DATE","ENTER_BY","LAST_MODIFY_DATE","LAST_MODIFY_BY","ORGANIZATION_ID",
       "TAG_CLASS",
       "ALARM_GROUP_LVL1",
       "ALARM_GROUP_LVL2",
       "ALARM_GROUP_LVL3"
    
FROM ICOM_PLC_TAG_MASTER
WHERE TAG_GROUP IN ( 'A' , 'S' , 'R' )
;
--------------------------------------------------------
--  DDL for View VIEW_ALARM_DATA_1_PIVOT
--------------------------------------------------------

  CREATE OR REPLACE FORCE EDITIONABLE VIEW "INFINITY21_JSFMS"."VIEW_ALARM_DATA_1_PIVOT" ("DVI", "MACHINE_DIV", "'Upper 로딩'", "'Lower 로딩'", "'Upper 브라켓 용접'", "'Lower 브라켓 용접'", "'U/L 댐핑시트 공급'", "'U/L 가열로'", "'U/L 쿨링'", "'실런트 로봇'", "'센터 로딩'", "'센터 댐핑시트 공급'", "'센터 가열로'", "'센터 쿨링'", "'U 밴딩'", "'센터 Tub 브라켓 용접'", "'Tub 가조립'", "'Shuttle 1'", "'시밍 1'") AS 
  SELECT "DVI","MACHINE_DIV","'Upper 로딩'","'Lower 로딩'","'Upper 브라켓 용접'","'Lower 브라켓 용접'","'U/L 댐핑시트 공급'","'U/L 가열로'","'U/L 쿨링'","'실런트 로봇'","'센터 로딩'","'센터 댐핑시트 공급'","'센터 가열로'","'센터 쿨링'","'U 밴딩'","'센터 Tub 브라켓 용접'","'Tub 가조립'","'Shuttle 1'","'시밍 1'" FROM
       ( SELECT '이상감지' DVI , MACHINE_DIV , MACHINE_NAME
            FROM VIEW_ALARM_DATA_RAW
          WHERE MACHINE_DATETIME >= TO_CHAR(SYSDATE, 'YYYYMMDD')||'073000'
            AND MACHINE_STATUS_DIV = 'ALARM'
            AND   MACHINE_STATUS_VALUE = '1'

        )
     PIVOT ( COUNT(*)
             FOR   MACHINE_NAME IN ('Upper 로딩','Lower 로딩','Upper 브라켓 용접','Lower 브라켓 용접','U/L 댐핑시트 공급','U/L 가열로','U/L 쿨링','실런트 로봇','센터 로딩','센터 댐핑시트 공급','센터 가열로','센터 쿨링','U 밴딩','센터 Tub 브라켓 용접','Tub 가조립','Shuttle 1','시밍 1')
            )
UNION ALL
SELECT "DVI","MACHINE_DIV","'Upper 로딩'","'Lower 로딩'","'Upper 브라켓 용접'","'Lower 브라켓 용접'","'U/L 댐핑시트 공급'","'U/L 가열로'","'U/L 쿨링'","'실런트 로봇'","'센터 로딩'","'센터 댐핑시트 공급'","'센터 가열로'","'센터 쿨링'","'U 밴딩'","'센터 Tub 브라켓 용접'","'Tub 가조립'","'Shuttle 1'","'시밍 1'" FROM
       (


          select '이상감지' DVI,
                 'CT' MACHINE_DIV,
                  m.machine_name as MACHINE_NAME,
                  TRUNC(AVG(NVL((r.tag_value * r.tag_scale), 0)), 1) AS TAG_VALUE

            from (select *
                    from (SELECT X.MACHINE_CODE,
                                 PLC_DATETIME,
                                 X.TAG_VALUE,
                                 X.TAG_ADDRESS,
                                 X.PLC_CODE,
                                 T.TAG_TYPE,
                                 T.TAG_SCALE,
                                 T.TAG_UNIT,
                                 ROW_NUMBER() OVER(PARTITION BY X.MACHINE_CODE ORDER BY PLC_TIMESTAMP DESC) RN
                            FROM ICOM_RECIEVE_PLC_RAW X, ICOM_PLC_TAG_MASTER T
                           WHERE X.PLC_DATETIME >= TO_CHAR(TRUNC(SYSDATE) + 7.5/24,'yyyymmddhh24miss')
                             AND X.PLC_DATETIME <= TO_CHAR(SYSDATE, 'YYYYMMDDhh24MIss')
                             AND X.TAG_TYPE_R = 'TC' --- 컬럼 추가 했고 Trigger 에서 TAG Type 넣게 함.
                             AND X.MACHINE_CODE = T.MACHINE_CODE
                             AND X.TAG_ADDRESS = T.TAG_ADDRESS

                          )
                   where rn <= 5

                  ) r,

                 icom_machine_master m
           where m.machine_code = r.machine_code(+)
           group by machine_name

          /*SELECT '이상감지' DVI , 'CT' MACHINE_DIV , MACHINE_NAME  , TRUNC(AVG(NVL(TAG_VALUE,0)),1) AS TAG_VALUE
            FROM
              (
                SELECT M.MACHINE_NAME AS MACHINE_NAME,
                      TRUNC(NVL(V.TAG_VALUE,0) * NVL(V.TAG_SCALE ,1) , 1) AS TAG_VALUE  ,
                      ROW_NUMBER() OVER (PARTITION BY V.MACHINE_NAME ORDER BY V.PLC_DATETIME DESC) AS RN
                 FROM ICOM_MACHINE_MASTER M , VIEW_CYCLETIME_DATA_RAW  V
                WHERE M.MACHINE_CODE = V.MACHINE_CODE(+)
                  AND V.PLC_DATETIME(+) >= TO_CHAR(SYSDATE, 'YYYYMMDD')||'073000'              )
            WHERE RN <= 5
            GROUP BY MACHINE_NAME  */
        )
     PIVOT ( AVG(NVL(TAG_VALUE,0))
             FOR   MACHINE_NAME IN ('Upper 로딩','Lower 로딩','Upper 브라켓 용접','Lower 브라켓 용접','U/L 댐핑시트 공급','U/L 가열로','U/L 쿨링','실런트 로봇','센터 로딩','센터 댐핑시트 공급','센터 가열로','센터 쿨링','U 밴딩','센터 Tub 브라켓 용접','Tub 가조립','Shuttle 1','시밍 1')
            )
 UNION ALL

 SELECT "DVI","MACHINE_DIV","'Upper 로딩'","'Lower 로딩'","'Upper 브라켓 용접'","'Lower 브라켓 용접'","'U/L 댐핑시트 공급'","'U/L 가열로'","'U/L 쿨링'","'실런트 로봇'","'센터 로딩'","'센터 댐핑시트 공급'","'센터 가열로'","'센터 쿨링'","'U 밴딩'","'센터 Tub 브라켓 용접'","'Tub 가조립'","'Shuttle 1'","'시밍 1'" FROM
       (
          SELECT '이상감지' DVI , 'STOP' MACHINE_DIV ,
                 M.MACHINE_NAME AS MACHINE_NAME ,
                 F_GET_TODAY_STOP_RATE(M.MACHINE_CODE) AS DOWN_TIME_TERM
            FROM ICOM_MACHINE_MASTER M
        )
     PIVOT ( SUM(DOWN_TIME_TERM)
             FOR   MACHINE_NAME IN ('Upper 로딩','Lower 로딩','Upper 브라켓 용접','Lower 브라켓 용접','U/L 댐핑시트 공급','U/L 가열로','U/L 쿨링','실런트 로봇','센터 로딩','센터 댐핑시트 공급','센터 가열로','센터 쿨링','U 밴딩','센터 Tub 브라켓 용접','Tub 가조립','Shuttle 1','시밍 1')
            )
;
--------------------------------------------------------
--  DDL for View VIEW_ALARM_DATA_1_PIVOT_ZKEY
--------------------------------------------------------

  CREATE OR REPLACE FORCE EDITIONABLE VIEW "INFINITY21_JSFMS"."VIEW_ALARM_DATA_1_PIVOT_ZKEY" ("DVI", "MACHINE_DIV", "'Upper 로딩'", "'Lower 로딩'", "'Upper 브라켓 용접'", "'Lower 브라켓 용접'", "'U/L 댐핑시트 공급'", "'U/L 가열로'", "'U/L 쿨링'", "'실런트 로봇'", "'센터 로딩'", "'센터 댐핑시트 공급'", "'센터 가열로'", "'센터 쿨링'", "'U 밴딩'", "'센터 Tub 브라켓 용접'", "'Tub 가조립'", "'Shuttle 1'", "'시밍 1'") AS 
  SELECT "DVI","MACHINE_DIV","'Upper 로딩'","'Lower 로딩'","'Upper 브라켓 용접'","'Lower 브라켓 용접'","'U/L 댐핑시트 공급'","'U/L 가열로'","'U/L 쿨링'","'실런트 로봇'","'센터 로딩'","'센터 댐핑시트 공급'","'센터 가열로'","'센터 쿨링'","'U 밴딩'","'센터 Tub 브라켓 용접'","'Tub 가조립'","'Shuttle 1'","'시밍 1'" FROM
       ( SELECT '이상감지' DVI , MACHINE_DIV , MACHINE_NAME
            FROM VIEW_ALARM_DATA_RAW
          WHERE MACHINE_DATETIME >= TO_CHAR(SYSDATE, 'YYYYMMDD')||'073000'
            AND MACHINE_STATUS_DIV = 'ALARM'
            AND   MACHINE_STATUS_VALUE = '1'

        )
     PIVOT ( COUNT(*)
             FOR   MACHINE_NAME IN ('Upper 로딩','Lower 로딩','Upper 브라켓 용접','Lower 브라켓 용접','U/L 댐핑시트 공급','U/L 가열로','U/L 쿨링','실런트 로봇','센터 로딩','센터 댐핑시트 공급','센터 가열로','센터 쿨링','U 밴딩','센터 Tub 브라켓 용접','Tub 가조립','Shuttle 1','시밍 1')
            )
UNION ALL
SELECT "DVI","MACHINE_DIV","'Upper 로딩'","'Lower 로딩'","'Upper 브라켓 용접'","'Lower 브라켓 용접'","'U/L 댐핑시트 공급'","'U/L 가열로'","'U/L 쿨링'","'실런트 로봇'","'센터 로딩'","'센터 댐핑시트 공급'","'센터 가열로'","'센터 쿨링'","'U 밴딩'","'센터 Tub 브라켓 용접'","'Tub 가조립'","'Shuttle 1'","'시밍 1'" FROM
       (


          select '이상감지' DVI,
                 'CT' MACHINE_DIV,
                  m.machine_name as MACHINE_NAME,
                  TRUNC(AVG(NVL((r.tag_value * r.tag_scale), 0)), 1) AS TAG_VALUE

            from (select *
                    from (SELECT X.MACHINE_CODE,
                                 PLC_DATETIME,
                                 X.TAG_VALUE,
                                 X.TAG_ADDRESS,
                                 X.PLC_CODE,
                                 T.TAG_TYPE,
                                 T.TAG_SCALE,
                                 T.TAG_UNIT,
                                 ROW_NUMBER() OVER(PARTITION BY X.MACHINE_CODE ORDER BY PLC_TIMESTAMP DESC) RN
                            FROM ICOM_RECIEVE_PLC_RAW X, ICOM_PLC_TAG_MASTER T
                           WHERE X.PLC_DATETIME >= TO_CHAR(TRUNC(SYSDATE) + 7.5/24,'yyyymmddhh24miss')
                             AND X.PLC_DATETIME <= TO_CHAR(SYSDATE, 'YYYYMMDDhh24MIss')
                             AND X.TAG_TYPE_R = 'TC' --- 컬럼 추가 했고 Trigger 에서 TAG Type 넣게 함.
                             AND X.MACHINE_CODE = T.MACHINE_CODE
                             AND X.TAG_ADDRESS = T.TAG_ADDRESS

                          )
                   where rn <= 5

                  ) r,

                 icom_machine_master m
           where m.machine_code = r.machine_code(+)
           group by machine_name

          /*SELECT '이상감지' DVI , 'CT' MACHINE_DIV , MACHINE_NAME  , TRUNC(AVG(NVL(TAG_VALUE,0)),1) AS TAG_VALUE
            FROM
              (
                SELECT M.MACHINE_NAME AS MACHINE_NAME,
                      TRUNC(NVL(V.TAG_VALUE,0) * NVL(V.TAG_SCALE ,1) , 1) AS TAG_VALUE  ,
                      ROW_NUMBER() OVER (PARTITION BY V.MACHINE_NAME ORDER BY V.PLC_DATETIME DESC) AS RN
                 FROM ICOM_MACHINE_MASTER M , VIEW_CYCLETIME_DATA_RAW  V
                WHERE M.MACHINE_CODE = V.MACHINE_CODE(+)
                  AND V.PLC_DATETIME(+) >= TO_CHAR(SYSDATE, 'YYYYMMDD')||'073000'              )
            WHERE RN <= 5
            GROUP BY MACHINE_NAME  */
        )
     PIVOT ( AVG(NVL(TAG_VALUE,0))
             FOR   MACHINE_NAME IN ('Upper 로딩','Lower 로딩','Upper 브라켓 용접','Lower 브라켓 용접','U/L 댐핑시트 공급','U/L 가열로','U/L 쿨링','실런트 로봇','센터 로딩','센터 댐핑시트 공급','센터 가열로','센터 쿨링','U 밴딩','센터 Tub 브라켓 용접','Tub 가조립','Shuttle 1','시밍 1')
            )
 UNION ALL

 SELECT "DVI","MACHINE_DIV","'Upper 로딩'","'Lower 로딩'","'Upper 브라켓 용접'","'Lower 브라켓 용접'","'U/L 댐핑시트 공급'","'U/L 가열로'","'U/L 쿨링'","'실런트 로봇'","'센터 로딩'","'센터 댐핑시트 공급'","'센터 가열로'","'센터 쿨링'","'U 밴딩'","'센터 Tub 브라켓 용접'","'Tub 가조립'","'Shuttle 1'","'시밍 1'" FROM
       (
          SELECT '이상감지' DVI , 'STOP' MACHINE_DIV ,
                 M.MACHINE_NAME AS MACHINE_NAME ,
                 F_GET_TODAY_STOP_RATE(M.MACHINE_CODE) AS DOWN_TIME_TERM
            FROM ICOM_MACHINE_MASTER M
        )
     PIVOT ( SUM(DOWN_TIME_TERM)
             FOR   MACHINE_NAME IN ('Upper 로딩','Lower 로딩','Upper 브라켓 용접','Lower 브라켓 용접','U/L 댐핑시트 공급','U/L 가열로','U/L 쿨링','실런트 로봇','센터 로딩','센터 댐핑시트 공급','센터 가열로','센터 쿨링','U 밴딩','센터 Tub 브라켓 용접','Tub 가조립','Shuttle 1','시밍 1')
            )
;
--------------------------------------------------------
--  DDL for View VIEW_ALARM_DATA_2_PIVOT
--------------------------------------------------------

  CREATE OR REPLACE FORCE EDITIONABLE VIEW "INFINITY21_JSFMS"."VIEW_ALARM_DATA_2_PIVOT" ("DVI", "MACHINE_DIV", "'플렌징 1'", "'레이저 실링 1'", "'Shuttle 2'", "'시밍 2'", "'플렌징 2'", "'레이저 실링 2'", "'시밍배출 C/V'", "'롤 포밍'", "'롤 포밍 가공'", "'패킹 가이드 공급'", "'패킹 가이드 용접1'", "'레일 브라켓 공급'", "'레일 브라켓 용접'", "'패킹 가이드 용접2'", "'바디 프레임 공급'", "'바디 프레임 용접'", "'Tub Assy 완료'") AS 
  SELECT "DVI","MACHINE_DIV","'플렌징 1'","'레이저 실링 1'","'Shuttle 2'","'시밍 2'","'플렌징 2'","'레이저 실링 2'","'시밍배출 C/V'","'롤 포밍'","'롤 포밍 가공'","'패킹 가이드 공급'","'패킹 가이드 용접1'","'레일 브라켓 공급'","'레일 브라켓 용접'","'패킹 가이드 용접2'","'바디 프레임 공급'","'바디 프레임 용접'","'Tub Assy 완료'" FROM
       ( SELECT '이상감지' DVI , MACHINE_DIV , MACHINE_NAME
            FROM VIEW_ALARM_DATA_RAW
          WHERE MACHINE_DATETIME >= TO_CHAR(SYSDATE, 'YYYYMMDD')||'073000'
            AND MACHINE_STATUS_DIV = 'ALARM'
            AND   MACHINE_STATUS_VALUE = '1'

        )
     PIVOT ( COUNT(*)
             FOR   MACHINE_NAME IN ('플렌징 1','레이저 실링 1','Shuttle 2','시밍 2','플렌징 2','레이저 실링 2','시밍배출 C/V','롤 포밍','롤 포밍 가공','패킹 가이드 공급','패킹 가이드 용접1','레일 브라켓 공급','레일 브라켓 용접','패킹 가이드 용접2','바디 프레임 공급','바디 프레임 용접','Tub Assy 완료' )
            )

 UNION ALL

 SELECT "DVI","MACHINE_DIV","'플렌징 1'","'레이저 실링 1'","'Shuttle 2'","'시밍 2'","'플렌징 2'","'레이저 실링 2'","'시밍배출 C/V'","'롤 포밍'","'롤 포밍 가공'","'패킹 가이드 공급'","'패킹 가이드 용접1'","'레일 브라켓 공급'","'레일 브라켓 용접'","'패킹 가이드 용접2'","'바디 프레임 공급'","'바디 프레임 용접'","'Tub Assy 완료'" FROM
       (

          select '이상감지' DVI,
                 'CT' MACHINE_DIV,
                  m.machine_name as MACHINE_NAME,
                  TRUNC(AVG(NVL((r.tag_value * r.tag_scale), 0)), 1) AS TAG_VALUE

            from (select *
                    from (SELECT X.MACHINE_CODE,
                                 PLC_DATETIME,
                                 X.TAG_VALUE,
                                 X.TAG_ADDRESS,
                                 X.PLC_CODE,
                                 T.TAG_TYPE,
                                 T.TAG_SCALE,
                                 T.TAG_UNIT,
                                 ROW_NUMBER() OVER(PARTITION BY X.MACHINE_CODE ORDER BY PLC_TIMESTAMP DESC) RN
                            FROM ICOM_RECIEVE_PLC_RAW X, ICOM_PLC_TAG_MASTER T
                           WHERE X.PLC_DATETIME >= TO_CHAR(TRUNC(SYSDATE) + 7.5/24,'yyyymmddhh24miss')
                             AND X.PLC_DATETIME <= TO_CHAR(SYSDATE, 'YYYYMMDDhh24MIss')
                             AND X.TAG_TYPE_R = 'TC' --- 컬럼 추가 했고 Trigger 에서 TAG Type 넣게 함.
                             AND X.MACHINE_CODE = T.MACHINE_CODE
                             AND X.TAG_ADDRESS = T.TAG_ADDRESS

                          )
                   where rn <= 5

                  ) r,

                 icom_machine_master m
           where m.machine_code = r.machine_code(+)
           group by machine_name
/*2022.10.07 Query 수정 반영 Zkey*/
          /*SELECT '이상감지' DVI , 'CT' MACHINE_DIV , MACHINE_NAME  , AVG(TAG_VALUE) AS TAG_VALUE
            FROM
              (
               SELECT M.MACHINE_NAME AS MACHINE_NAME,
                      TRUNC(NVL(V.TAG_VALUE,0) * NVL(V.TAG_SCALE ,1) ,1) AS TAG_VALUE  ,
                      ROW_NUMBER() OVER (PARTITION BY V.MACHINE_NAME ORDER BY V.OPERATION_DATETIME DESC) AS RN
                 FROM ICOM_MACHINE_MASTER M , VIEW_CYCLETIME_DATA_RAW  V
                WHERE M.MACHINE_CODE = V.MACHINE_CODE(+)
                  AND V.PLC_DATETIME(+) >= TO_CHAR(SYSDATE, 'YYYYMMDD')||'073000'
               )
            WHERE RN <= 5
            GROUP BY MACHINE_NAME  */
        )

     PIVOT ( AVG(NVL(TAG_VALUE,0))
              FOR   MACHINE_NAME IN ('플렌징 1','레이저 실링 1','Shuttle 2','시밍 2','플렌징 2','레이저 실링 2','시밍배출 C/V','롤 포밍','롤 포밍 가공','패킹 가이드 공급','패킹 가이드 용접1','레일 브라켓 공급','레일 브라켓 용접','패킹 가이드 용접2','바디 프레임 공급','바디 프레임 용접','Tub Assy 완료' )
            )
  UNION ALL

 SELECT "DVI","MACHINE_DIV","'플렌징 1'","'레이저 실링 1'","'Shuttle 2'","'시밍 2'","'플렌징 2'","'레이저 실링 2'","'시밍배출 C/V'","'롤 포밍'","'롤 포밍 가공'","'패킹 가이드 공급'","'패킹 가이드 용접1'","'레일 브라켓 공급'","'레일 브라켓 용접'","'패킹 가이드 용접2'","'바디 프레임 공급'","'바디 프레임 용접'","'Tub Assy 완료'" FROM
      (
          SELECT '이상감지' DVI , 'STOP' MACHINE_DIV ,
                 M.MACHINE_NAME AS MACHINE_NAME ,
                 F_GET_TODAY_STOP_RATE(M.MACHINE_CODE) AS DOWN_TIME_TERM
            FROM ICOM_MACHINE_MASTER M
        )
     PIVOT ( SUM(DOWN_TIME_TERM)
            FOR   MACHINE_NAME IN ('플렌징 1','레이저 실링 1','Shuttle 2','시밍 2','플렌징 2','레이저 실링 2','시밍배출 C/V','롤 포밍','롤 포밍 가공','패킹 가이드 공급','패킹 가이드 용접1','레일 브라켓 공급','레일 브라켓 용접','패킹 가이드 용접2','바디 프레임 공급','바디 프레임 용접','Tub Assy 완료' )
          )
;
--------------------------------------------------------
--  DDL for View VIEW_ALARM_DATA_2_PIVOT_ZKEY
--------------------------------------------------------

  CREATE OR REPLACE FORCE EDITIONABLE VIEW "INFINITY21_JSFMS"."VIEW_ALARM_DATA_2_PIVOT_ZKEY" ("DVI", "MACHINE_DIV", "'플렌징 1'", "'레이저 실링 1'", "'Shuttle 2'", "'시밍 2'", "'플렌징 2'", "'레이저 실링 2'", "'시밍배출 C/V'", "'롤 포밍'", "'롤 포밍 가공'", "'패킹 가이드 공급'", "'패킹 가이드 용접1'", "'레일 브라켓 공급'", "'레일 브라켓 용접'", "'패킹 가이드 용접2'", "'바디 프레임 공급'", "'바디 프레임 용접'", "'Tub Assy 완료'") AS 
  SELECT "DVI","MACHINE_DIV","'플렌징 1'","'레이저 실링 1'","'Shuttle 2'","'시밍 2'","'플렌징 2'","'레이저 실링 2'","'시밍배출 C/V'","'롤 포밍'","'롤 포밍 가공'","'패킹 가이드 공급'","'패킹 가이드 용접1'","'레일 브라켓 공급'","'레일 브라켓 용접'","'패킹 가이드 용접2'","'바디 프레임 공급'","'바디 프레임 용접'","'Tub Assy 완료'" FROM
       ( SELECT '이상감지' DVI , MACHINE_DIV , MACHINE_NAME
            FROM VIEW_ALARM_DATA_RAW
          WHERE MACHINE_DATETIME >= TO_CHAR(SYSDATE, 'YYYYMMDD')||'073000'
            AND MACHINE_STATUS_DIV = 'ALARM'
            AND   MACHINE_STATUS_VALUE = '1'

        )
     PIVOT ( COUNT(*)
             FOR   MACHINE_NAME IN ('플렌징 1','레이저 실링 1','Shuttle 2','시밍 2','플렌징 2','레이저 실링 2','시밍배출 C/V','롤 포밍','롤 포밍 가공','패킹 가이드 공급','패킹 가이드 용접1','레일 브라켓 공급','레일 브라켓 용접','패킹 가이드 용접2','바디 프레임 공급','바디 프레임 용접','Tub Assy 완료' )
            )

 UNION ALL

 SELECT "DVI","MACHINE_DIV","'플렌징 1'","'레이저 실링 1'","'Shuttle 2'","'시밍 2'","'플렌징 2'","'레이저 실링 2'","'시밍배출 C/V'","'롤 포밍'","'롤 포밍 가공'","'패킹 가이드 공급'","'패킹 가이드 용접1'","'레일 브라켓 공급'","'레일 브라켓 용접'","'패킹 가이드 용접2'","'바디 프레임 공급'","'바디 프레임 용접'","'Tub Assy 완료'" FROM
       (

          select '이상감지' DVI,
                 'CT' MACHINE_DIV,
                  m.machine_name as MACHINE_NAME,
                  TRUNC(AVG(NVL((r.tag_value * r.tag_scale), 0)), 1) AS TAG_VALUE

            from (select *
                    from (SELECT X.MACHINE_CODE,
                                 PLC_DATETIME,
                                 X.TAG_VALUE,
                                 X.TAG_ADDRESS,
                                 X.PLC_CODE,
                                 T.TAG_TYPE,
                                 T.TAG_SCALE,
                                 T.TAG_UNIT,
                                 ROW_NUMBER() OVER(PARTITION BY X.MACHINE_CODE ORDER BY PLC_TIMESTAMP DESC) RN
                            FROM ICOM_RECIEVE_PLC_RAW X, ICOM_PLC_TAG_MASTER T
                           WHERE X.PLC_DATETIME >= TO_CHAR(TRUNC(SYSDATE) + 7.5/24,'yyyymmddhh24miss')
                             AND X.PLC_DATETIME <= TO_CHAR(SYSDATE, 'YYYYMMDDhh24MIss')
                             AND X.TAG_TYPE_R = 'TC' --- 컬럼 추가 했고 Trigger 에서 TAG Type 넣게 함.
                             AND X.MACHINE_CODE = T.MACHINE_CODE
                             AND X.TAG_ADDRESS = T.TAG_ADDRESS

                          )
                   where rn <= 5

                  ) r,

                 icom_machine_master m
           where m.machine_code = r.machine_code(+)
           group by machine_name

          /*SELECT '이상감지' DVI , 'CT' MACHINE_DIV , MACHINE_NAME  , AVG(TAG_VALUE) AS TAG_VALUE
            FROM
              (
               SELECT M.MACHINE_NAME AS MACHINE_NAME,
                      TRUNC(NVL(V.TAG_VALUE,0) * NVL(V.TAG_SCALE ,1) ,1) AS TAG_VALUE  ,
                      ROW_NUMBER() OVER (PARTITION BY V.MACHINE_NAME ORDER BY V.OPERATION_DATETIME DESC) AS RN
                 FROM ICOM_MACHINE_MASTER M , VIEW_CYCLETIME_DATA_RAW  V
                WHERE M.MACHINE_CODE = V.MACHINE_CODE(+)
                  AND V.PLC_DATETIME(+) >= TO_CHAR(SYSDATE, 'YYYYMMDD')||'073000'
               )
            WHERE RN <= 5
            GROUP BY MACHINE_NAME  */
        )

     PIVOT ( AVG(NVL(TAG_VALUE,0))
              FOR   MACHINE_NAME IN ('플렌징 1','레이저 실링 1','Shuttle 2','시밍 2','플렌징 2','레이저 실링 2','시밍배출 C/V','롤 포밍','롤 포밍 가공','패킹 가이드 공급','패킹 가이드 용접1','레일 브라켓 공급','레일 브라켓 용접','패킹 가이드 용접2','바디 프레임 공급','바디 프레임 용접','Tub Assy 완료' )
            )
  UNION ALL

 SELECT "DVI","MACHINE_DIV","'플렌징 1'","'레이저 실링 1'","'Shuttle 2'","'시밍 2'","'플렌징 2'","'레이저 실링 2'","'시밍배출 C/V'","'롤 포밍'","'롤 포밍 가공'","'패킹 가이드 공급'","'패킹 가이드 용접1'","'레일 브라켓 공급'","'레일 브라켓 용접'","'패킹 가이드 용접2'","'바디 프레임 공급'","'바디 프레임 용접'","'Tub Assy 완료'" FROM
      (
          SELECT '이상감지' DVI , 'STOP' MACHINE_DIV ,
                 M.MACHINE_NAME AS MACHINE_NAME ,
                 F_GET_TODAY_STOP_RATE(M.MACHINE_CODE) AS DOWN_TIME_TERM
            FROM ICOM_MACHINE_MASTER M
        )
     PIVOT ( SUM(DOWN_TIME_TERM)
            FOR   MACHINE_NAME IN ('플렌징 1','레이저 실링 1','Shuttle 2','시밍 2','플렌징 2','레이저 실링 2','시밍배출 C/V','롤 포밍','롤 포밍 가공','패킹 가이드 공급','패킹 가이드 용접1','레일 브라켓 공급','레일 브라켓 용접','패킹 가이드 용접2','바디 프레임 공급','바디 프레임 용접','Tub Assy 완료' )
          )
;
--------------------------------------------------------
--  DDL for View VIEW_ALARM_DATA_ALL_PIVOT
--------------------------------------------------------

  CREATE OR REPLACE FORCE EDITIONABLE VIEW "INFINITY21_JSFMS"."VIEW_ALARM_DATA_ALL_PIVOT" ("DVI", "MACHINE_DIV", "'Upper 로딩'", "'Lower 로딩'", "'Upper 브라켓 용접'", "'Lower 브라켓 용접'", "'U/L 댐핑시트 공급'", "'U/L 가열로'", "'U/L 쿨링'", "'실런트 로봇'", "'센터 로딩'", "'센터 댐핑시트 공급'", "'센터 가열로'", "'센터 쿨링'", "'U 밴딩'", "'센터 Tub 브라켓 용접'", "'Tub 가조립'", "'Shuttle 1'", "'시밍 1'", "'플렌징 1'", "'레이저 실링 1'", "'Shuttle 2'", "'시밍 2'", "'플렌징 2'", "'레이저 실링 2'", "'시밍배출 C/V'", "'롤 포밍'", "'롤 포밍 가공'", "'패킹 가이드 공급'", "'패킹 가이드 용접1'", "'레일 브라켓 공급'", "'레일 브라켓 용접'", "'패킹 가이드 용접2'", "'바디 프레임 공급'", "'바디 프레임 용접'", "'Tub Assy 완료'") AS 
  SELECT "DVI","MACHINE_DIV","'Upper 로딩'","'Lower 로딩'","'Upper 브라켓 용접'","'Lower 브라켓 용접'","'U/L 댐핑시트 공급'","'U/L 가열로'","'U/L 쿨링'","'실런트 로봇'","'센터 로딩'","'센터 댐핑시트 공급'","'센터 가열로'","'센터 쿨링'","'U 밴딩'","'센터 Tub 브라켓 용접'","'Tub 가조립'","'Shuttle 1'","'시밍 1'","'플렌징 1'","'레이저 실링 1'","'Shuttle 2'","'시밍 2'","'플렌징 2'","'레이저 실링 2'","'시밍배출 C/V'","'롤 포밍'","'롤 포밍 가공'","'패킹 가이드 공급'","'패킹 가이드 용접1'","'레일 브라켓 공급'","'레일 브라켓 용접'","'패킹 가이드 용접2'","'바디 프레임 공급'","'바디 프레임 용접'","'Tub Assy 완료'" FROM
       ( SELECT '이상감지' DVI , MACHINE_DIV , MACHINE_NAME
            FROM VIEW_ALARM_DATA_RAW
          WHERE MACHINE_DATETIME >= TO_CHAR(SYSDATE, 'YYYYMMDD')||'073000'
            AND MACHINE_STATUS_DIV = 'ALARM'
            AND   MACHINE_STATUS_VALUE = '1'

        )
     PIVOT ( COUNT(*)
             FOR   MACHINE_NAME IN ('Upper 로딩','Lower 로딩','Upper 브라켓 용접','Lower 브라켓 용접','U/L 댐핑시트 공급','U/L 가열로','U/L 쿨링','실런트 로봇','센터 로딩','센터 댐핑시트 공급','센터 가열로','센터 쿨링','U 밴딩','센터 Tub 브라켓 용접','Tub 가조립','Shuttle 1','시밍 1','플렌징 1','레이저 실링 1','Shuttle 2','시밍 2','플렌징 2','레이저 실링 2','시밍배출 C/V','롤 포밍','롤 포밍 가공','패킹 가이드 공급','패킹 가이드 용접1','레일 브라켓 공급','레일 브라켓 용접','패킹 가이드 용접2','바디 프레임 공급','바디 프레임 용접','Tub Assy 완료' )
            )

 UNION ALL

 SELECT "DVI","MACHINE_DIV","'Upper 로딩'","'Lower 로딩'","'Upper 브라켓 용접'","'Lower 브라켓 용접'","'U/L 댐핑시트 공급'","'U/L 가열로'","'U/L 쿨링'","'실런트 로봇'","'센터 로딩'","'센터 댐핑시트 공급'","'센터 가열로'","'센터 쿨링'","'U 밴딩'","'센터 Tub 브라켓 용접'","'Tub 가조립'","'Shuttle 1'","'시밍 1'","'플렌징 1'","'레이저 실링 1'","'Shuttle 2'","'시밍 2'","'플렌징 2'","'레이저 실링 2'","'시밍배출 C/V'","'롤 포밍'","'롤 포밍 가공'","'패킹 가이드 공급'","'패킹 가이드 용접1'","'레일 브라켓 공급'","'레일 브라켓 용접'","'패킹 가이드 용접2'","'바디 프레임 공급'","'바디 프레임 용접'","'Tub Assy 완료'" FROM
        (

         select '이상감지' DVI,
                 'CT' MACHINE_DIV,
                  m.machine_name as MACHINE_NAME,
                  TRUNC(AVG(NVL((r.tag_value * r.tag_scale), 0)), 1) AS TAG_VALUE

            from (select *
                    from (SELECT X.MACHINE_CODE,
                                 PLC_DATETIME,
                                 X.TAG_VALUE,
                                 X.TAG_ADDRESS,
                                 X.PLC_CODE,
                                 T.TAG_TYPE,
                                 T.TAG_SCALE,
                                 T.TAG_UNIT,
                                 ROW_NUMBER() OVER(PARTITION BY X.MACHINE_CODE ORDER BY PLC_TIMESTAMP DESC) RN
                            FROM ICOM_RECIEVE_PLC_RAW X, ICOM_PLC_TAG_MASTER T
                           WHERE X.PLC_DATETIME >= TO_CHAR(TRUNC(SYSDATE) + 7.5/24,'yyyymmddhh24miss')
                             AND X.PLC_DATETIME <= TO_CHAR(SYSDATE, 'YYYYMMDDhh24MIss')
                             AND X.TAG_TYPE_R = 'TC' --- 컬럼 추가 했고 Trigger 에서 TAG Type 넣게 함.
                             AND X.MACHINE_CODE = T.MACHINE_CODE
                             AND X.TAG_ADDRESS = T.TAG_ADDRESS

                          )
                   where rn <= 5

                  ) r,

                 icom_machine_master m
           where m.machine_code = r.machine_code(+)
           group by machine_name
          /*2022.10.07 Query 수정 반영 Zkey*/
          /*SELECT '이상감지' DVI , 'CT' MACHINE_DIV , MACHINE_NAME  , TRUNC( AVG(TAG_VALUE) , 1) AS TAG_VALUE
            FROM
              (
               SELECT MACHINE_NAME , TRUNC(TAG_VALUE * TAG_SCALE ,1 ) AS TAG_VALUE  ,
                      ROW_NUMBER() OVER (PARTITION BY MACHINE_NAME ORDER BY OPERATION_DATETIME DESC) AS RN
                 FROM VIEW_CYCLETIME_DATA_RAW
                WHERE PLC_DATETIME >= TO_CHAR(SYSDATE, 'YYYYMMDD')||'073000'
               )
            WHERE RN <= 5
            GROUP BY MACHINE_NAME  */
        )

     PIVOT ( AVG(NVL(TAG_VALUE,0))
             FOR   MACHINE_NAME IN ('Upper 로딩','Lower 로딩','Upper 브라켓 용접','Lower 브라켓 용접','U/L 댐핑시트 공급','U/L 가열로','U/L 쿨링','실런트 로봇','센터 로딩','센터 댐핑시트 공급','센터 가열로','센터 쿨링','U 밴딩','센터 Tub 브라켓 용접','Tub 가조립','Shuttle 1','시밍 1','플렌징 1','레이저 실링 1','Shuttle 2','시밍 2','플렌징 2','레이저 실링 2','시밍배출 C/V','롤 포밍','롤 포밍 가공','패킹 가이드 공급','패킹 가이드 용접1','레일 브라켓 공급','레일 브라켓 용접','패킹 가이드 용접2','바디 프레임 공급','바디 프레임 용접','Tub Assy 완료' )
            )

  UNION ALL

  SELECT "DVI","MACHINE_DIV","'Upper 로딩'","'Lower 로딩'","'Upper 브라켓 용접'","'Lower 브라켓 용접'","'U/L 댐핑시트 공급'","'U/L 가열로'","'U/L 쿨링'","'실런트 로봇'","'센터 로딩'","'센터 댐핑시트 공급'","'센터 가열로'","'센터 쿨링'","'U 밴딩'","'센터 Tub 브라켓 용접'","'Tub 가조립'","'Shuttle 1'","'시밍 1'","'플렌징 1'","'레이저 실링 1'","'Shuttle 2'","'시밍 2'","'플렌징 2'","'레이저 실링 2'","'시밍배출 C/V'","'롤 포밍'","'롤 포밍 가공'","'패킹 가이드 공급'","'패킹 가이드 용접1'","'레일 브라켓 공급'","'레일 브라켓 용접'","'패킹 가이드 용접2'","'바디 프레임 공급'","'바디 프레임 용접'","'Tub Assy 완료'" FROM
        (
          SELECT '이상감지' DVI , 'STOP' MACHINE_DIV ,
                 M.MACHINE_NAME AS MACHINE_NAME ,
                 F_GET_TODAY_STOP_RATE(M.MACHINE_CODE) AS DOWN_TIME_TERM
            FROM ICOM_MACHINE_MASTER M
        )
     PIVOT ( SUM(DOWN_TIME_TERM)
           FOR   MACHINE_NAME IN ('Upper 로딩','Lower 로딩','Upper 브라켓 용접','Lower 브라켓 용접','U/L 댐핑시트 공급','U/L 가열로','U/L 쿨링','실런트 로봇','센터 로딩','센터 댐핑시트 공급','센터 가열로','센터 쿨링','U 밴딩','센터 Tub 브라켓 용접','Tub 가조립','Shuttle 1','시밍 1','플렌징 1','레이저 실링 1','Shuttle 2','시밍 2','플렌징 2','레이저 실링 2','시밍배출 C/V','롤 포밍','롤 포밍 가공','패킹 가이드 공급','패킹 가이드 용접1','레일 브라켓 공급','레일 브라켓 용접','패킹 가이드 용접2','바디 프레임 공급','바디 프레임 용접','Tub Assy 완료' )
                )
;
--------------------------------------------------------
--  DDL for View VIEW_ALARM_DATA_ALL_PIVOT_ZKEY
--------------------------------------------------------

  CREATE OR REPLACE FORCE EDITIONABLE VIEW "INFINITY21_JSFMS"."VIEW_ALARM_DATA_ALL_PIVOT_ZKEY" ("DVI", "MACHINE_DIV", "'Upper 로딩'", "'Lower 로딩'", "'Upper 브라켓 용접'", "'Lower 브라켓 용접'", "'U/L 댐핑시트 공급'", "'U/L 가열로'", "'U/L 쿨링'", "'실런트 로봇'", "'센터 로딩'", "'센터 댐핑시트 공급'", "'센터 가열로'", "'센터 쿨링'", "'U 밴딩'", "'센터 Tub 브라켓 용접'", "'Tub 가조립'", "'Shuttle 1'", "'시밍 1'", "'플렌징 1'", "'레이저 실링 1'", "'Shuttle 2'", "'시밍 2'", "'플렌징 2'", "'레이저 실링 2'", "'시밍배출 C/V'", "'롤 포밍'", "'롤 포밍 가공'", "'패킹 가이드 공급'", "'패킹 가이드 용접1'", "'레일 브라켓 공급'", "'레일 브라켓 용접'", "'패킹 가이드 용접2'", "'바디 프레임 공급'", "'바디 프레임 용접'", "'Tub Assy 완료'") AS 
  SELECT "DVI","MACHINE_DIV","'Upper 로딩'","'Lower 로딩'","'Upper 브라켓 용접'","'Lower 브라켓 용접'","'U/L 댐핑시트 공급'","'U/L 가열로'","'U/L 쿨링'","'실런트 로봇'","'센터 로딩'","'센터 댐핑시트 공급'","'센터 가열로'","'센터 쿨링'","'U 밴딩'","'센터 Tub 브라켓 용접'","'Tub 가조립'","'Shuttle 1'","'시밍 1'","'플렌징 1'","'레이저 실링 1'","'Shuttle 2'","'시밍 2'","'플렌징 2'","'레이저 실링 2'","'시밍배출 C/V'","'롤 포밍'","'롤 포밍 가공'","'패킹 가이드 공급'","'패킹 가이드 용접1'","'레일 브라켓 공급'","'레일 브라켓 용접'","'패킹 가이드 용접2'","'바디 프레임 공급'","'바디 프레임 용접'","'Tub Assy 완료'" FROM
       ( SELECT '이상감지' DVI , MACHINE_DIV , MACHINE_NAME
            FROM VIEW_ALARM_DATA_RAW
          WHERE MACHINE_DATETIME >= TO_CHAR(SYSDATE, 'YYYYMMDD')||'073000'
            AND MACHINE_STATUS_DIV = 'ALARM'
            AND   MACHINE_STATUS_VALUE = '1'

        )
     PIVOT ( COUNT(*)
             FOR   MACHINE_NAME IN ('Upper 로딩','Lower 로딩','Upper 브라켓 용접','Lower 브라켓 용접','U/L 댐핑시트 공급','U/L 가열로','U/L 쿨링','실런트 로봇','센터 로딩','센터 댐핑시트 공급','센터 가열로','센터 쿨링','U 밴딩','센터 Tub 브라켓 용접','Tub 가조립','Shuttle 1','시밍 1','플렌징 1','레이저 실링 1','Shuttle 2','시밍 2','플렌징 2','레이저 실링 2','시밍배출 C/V','롤 포밍','롤 포밍 가공','패킹 가이드 공급','패킹 가이드 용접1','레일 브라켓 공급','레일 브라켓 용접','패킹 가이드 용접2','바디 프레임 공급','바디 프레임 용접','Tub Assy 완료' )
            )

 UNION ALL

 SELECT "DVI","MACHINE_DIV","'Upper 로딩'","'Lower 로딩'","'Upper 브라켓 용접'","'Lower 브라켓 용접'","'U/L 댐핑시트 공급'","'U/L 가열로'","'U/L 쿨링'","'실런트 로봇'","'센터 로딩'","'센터 댐핑시트 공급'","'센터 가열로'","'센터 쿨링'","'U 밴딩'","'센터 Tub 브라켓 용접'","'Tub 가조립'","'Shuttle 1'","'시밍 1'","'플렌징 1'","'레이저 실링 1'","'Shuttle 2'","'시밍 2'","'플렌징 2'","'레이저 실링 2'","'시밍배출 C/V'","'롤 포밍'","'롤 포밍 가공'","'패킹 가이드 공급'","'패킹 가이드 용접1'","'레일 브라켓 공급'","'레일 브라켓 용접'","'패킹 가이드 용접2'","'바디 프레임 공급'","'바디 프레임 용접'","'Tub Assy 완료'" FROM
        (

         select '이상감지' DVI,
                 'CT' MACHINE_DIV,
                  m.machine_name as MACHINE_NAME,
                  TRUNC(AVG(NVL((r.tag_value * r.tag_scale), 0)), 1) AS TAG_VALUE

            from (select *
                    from (SELECT X.MACHINE_CODE,
                                 PLC_DATETIME,
                                 X.TAG_VALUE,
                                 X.TAG_ADDRESS,
                                 X.PLC_CODE,
                                 T.TAG_TYPE,
                                 T.TAG_SCALE,
                                 T.TAG_UNIT,
                                 ROW_NUMBER() OVER(PARTITION BY X.MACHINE_CODE ORDER BY PLC_TIMESTAMP DESC) RN
                            FROM ICOM_RECIEVE_PLC_RAW X, ICOM_PLC_TAG_MASTER T
                           WHERE X.PLC_DATETIME >= TO_CHAR(TRUNC(SYSDATE) + 7.5/24,'yyyymmddhh24miss')
                             AND X.PLC_DATETIME <= TO_CHAR(SYSDATE, 'YYYYMMDDhh24MIss')
                             AND X.TAG_TYPE_R = 'TC' --- 컬럼 추가 했고 Trigger 에서 TAG Type 넣게 함.
                             AND X.MACHINE_CODE = T.MACHINE_CODE
                             AND X.TAG_ADDRESS = T.TAG_ADDRESS

                          )
                   where rn <= 5

                  ) r,

                 icom_machine_master m
           where m.machine_code = r.machine_code(+)
           group by machine_name

          /*SELECT '이상감지' DVI , 'CT' MACHINE_DIV , MACHINE_NAME  , TRUNC( AVG(TAG_VALUE) , 1) AS TAG_VALUE
            FROM
              (
               SELECT MACHINE_NAME , TRUNC(TAG_VALUE * TAG_SCALE ,1 ) AS TAG_VALUE  ,
                      ROW_NUMBER() OVER (PARTITION BY MACHINE_NAME ORDER BY OPERATION_DATETIME DESC) AS RN
                 FROM VIEW_CYCLETIME_DATA_RAW
                WHERE PLC_DATETIME >= TO_CHAR(SYSDATE, 'YYYYMMDD')||'073000'
               )
            WHERE RN <= 5
            GROUP BY MACHINE_NAME  */
        )

     PIVOT ( AVG(NVL(TAG_VALUE,0))
             FOR   MACHINE_NAME IN ('Upper 로딩','Lower 로딩','Upper 브라켓 용접','Lower 브라켓 용접','U/L 댐핑시트 공급','U/L 가열로','U/L 쿨링','실런트 로봇','센터 로딩','센터 댐핑시트 공급','센터 가열로','센터 쿨링','U 밴딩','센터 Tub 브라켓 용접','Tub 가조립','Shuttle 1','시밍 1','플렌징 1','레이저 실링 1','Shuttle 2','시밍 2','플렌징 2','레이저 실링 2','시밍배출 C/V','롤 포밍','롤 포밍 가공','패킹 가이드 공급','패킹 가이드 용접1','레일 브라켓 공급','레일 브라켓 용접','패킹 가이드 용접2','바디 프레임 공급','바디 프레임 용접','Tub Assy 완료' )
            )

  UNION ALL

  SELECT "DVI","MACHINE_DIV","'Upper 로딩'","'Lower 로딩'","'Upper 브라켓 용접'","'Lower 브라켓 용접'","'U/L 댐핑시트 공급'","'U/L 가열로'","'U/L 쿨링'","'실런트 로봇'","'센터 로딩'","'센터 댐핑시트 공급'","'센터 가열로'","'센터 쿨링'","'U 밴딩'","'센터 Tub 브라켓 용접'","'Tub 가조립'","'Shuttle 1'","'시밍 1'","'플렌징 1'","'레이저 실링 1'","'Shuttle 2'","'시밍 2'","'플렌징 2'","'레이저 실링 2'","'시밍배출 C/V'","'롤 포밍'","'롤 포밍 가공'","'패킹 가이드 공급'","'패킹 가이드 용접1'","'레일 브라켓 공급'","'레일 브라켓 용접'","'패킹 가이드 용접2'","'바디 프레임 공급'","'바디 프레임 용접'","'Tub Assy 완료'" FROM
        (
          SELECT '이상감지' DVI , 'STOP' MACHINE_DIV ,
                 M.MACHINE_NAME AS MACHINE_NAME ,
                 F_GET_TODAY_STOP_RATE(M.MACHINE_CODE) AS DOWN_TIME_TERM
            FROM ICOM_MACHINE_MASTER M
        )
     PIVOT ( SUM(DOWN_TIME_TERM)
           FOR   MACHINE_NAME IN ('Upper 로딩','Lower 로딩','Upper 브라켓 용접','Lower 브라켓 용접','U/L 댐핑시트 공급','U/L 가열로','U/L 쿨링','실런트 로봇','센터 로딩','센터 댐핑시트 공급','센터 가열로','센터 쿨링','U 밴딩','센터 Tub 브라켓 용접','Tub 가조립','Shuttle 1','시밍 1','플렌징 1','레이저 실링 1','Shuttle 2','시밍 2','플렌징 2','레이저 실링 2','시밍배출 C/V','롤 포밍','롤 포밍 가공','패킹 가이드 공급','패킹 가이드 용접1','레일 브라켓 공급','레일 브라켓 용접','패킹 가이드 용접2','바디 프레임 공급','바디 프레임 용접','Tub Assy 완료' )
                )
;
--------------------------------------------------------
--  DDL for View VIEW_ALARM_DATA_RAW
--------------------------------------------------------

  CREATE OR REPLACE FORCE EDITIONABLE VIEW "INFINITY21_JSFMS"."VIEW_ALARM_DATA_RAW" ("MACHINE_DIV", "MACHINE_CODE", "MACHINE_STATUS_DIV", "MACHINE_STATUS_VALUE", "MACHINE_MESSAGE", "MACHINE_DATETIME", "ALARM_DATETIME", "COMMENTS", "ENTER_DATE", "ENTER_BY", "ORGANIZATION_ID", "PLC_CODE", "TAG_ADDRESS", "TAG_NAME", "ALARM_GROUP_LVL1", "ALARM_GROUP_LVL2", "ALARM_GROUP_LVL3", "TAG_DIVISION", "TAG_TYPE", "TAG_CLASS", "MACHINE_NAME", "WORKSTAGE_CODE", "MACHINE_SEQ", "ALARM_START_DATETIME", "ALARM_END_DATETIME", "ALARM_TIME_TERM", "EQP_STATE", "CONTROL_STATE", "TAG_USE_YN") AS 
  SELECT
    icom_recieve_data_raw.machine_div,
    icom_recieve_data_raw.machine_code,
    icom_recieve_data_raw.machine_status_div,
    icom_recieve_data_raw.machine_status_value,
    icom_recieve_data_raw.machine_message,
    icom_recieve_data_raw.machine_datetime,
    to_date(substr(icom_recieve_data_raw.machine_datetime,1,14) , 'yyyymmddhh24miss') alarm_datetime ,
    icom_recieve_data_raw.comments,
    icom_recieve_data_raw.enter_date,
    icom_recieve_data_raw.enter_by,
    icom_recieve_data_raw.organization_id,
    icom_recieve_data_raw.plc_code,
    NVL( icom_recieve_data_raw.tag_address, machine_status_div) tag_address, 
    icom_plc_tag_master.tag_name,
    NVL(icom_plc_tag_master.alarm_group_lvl1, 'NN') alarm_group_lvl1 ,
    NVL(icom_plc_tag_master.alarm_group_lvl2, 'NN') alarm_group_lvl2 ,
    icom_plc_tag_master.alarm_group_lvl3,
    icom_plc_tag_master.tag_division,
    icom_plc_tag_master.tag_type,
    NVL(icom_plc_tag_master.tag_class,'ETC')    tag_class ,
    icom_machine_master.machine_name ,
    icom_machine_master.workstage_code ,
    icom_machine_master.machine_seq ,
      icom_recieve_data_raw.alarm_start_datetime ,
    icom_recieve_data_raw.alarm_end_datetime ,
    icom_recieve_data_raw.alarm_time_term,
    icom_recieve_data_raw.eqp_state,
    icom_recieve_data_raw.control_state,
    icom_plc_tag_master.tag_use_yn
    
FROM
    icom_recieve_data_raw,
    icom_plc_tag_master,
    icom_machine_master
 WHERE  icom_recieve_data_raw.plc_code = icom_plc_tag_master.plc_code(+)
  and   icom_recieve_data_raw.machine_code = icom_plc_tag_master.machine_code(+)
 and   icom_recieve_data_raw.tag_address = icom_plc_tag_master.tag_address(+)
 and   icom_recieve_data_raw.machine_code = icom_machine_master.machine_code(+)
 and   icom_recieve_data_raw.machine_status_div = 'ALARM' -- 'ALARM , STATE , OPERATION;
;
--------------------------------------------------------
--  DDL for View VIEW_ALARM_TOP5_BY_DATE
--------------------------------------------------------

  CREATE OR REPLACE FORCE EDITIONABLE VIEW "INFINITY21_JSFMS"."VIEW_ALARM_TOP5_BY_DATE" ("MACHINE_DIV", "MACHINE_MESSAGE", "MACHINE_DATETIME", "MACHINE_TIME", "RNK") AS 
  SELECT "MACHINE_DIV","MACHINE_MESSAGE","MACHINE_DATETIME","MACHINE_TIME" , "RNK"
  FROM (
         SELECT MACHINE_DIV ,MACHINE_MESSAGE , 
                TO_DATE( SUBSTR(MACHINE_DATETIME,1,14) ,'YYYY/MM/DD HH24:MI:SS' )  MACHINE_DATETIME,
                TO_CHAR(TO_DATE( SUBSTR(MACHINE_DATETIME,1,14) ,'YYYY/MM/DD HH24:MI:SS' ) , 'HH24:MI')  MACHINE_TIME,

                row_number() OVER(partition by MACHINE_DIV ORDER BY MACHINE_DATETIME DESC) AS rnk
           FROM ICOM_RECIEVE_DATA_RAW
          WHERE MACHINE_DATETIME >=TO_CHAR(trunc(sysdate) , 'yyyymmddhh24miss')
            AND MACHINE_DIV IN ( 'RMS' , 'WELD' , 'PRAICAM' , 'PIE' ) 
       )

 WHERE rnk <= 5
   and MACHINE_DATETIME >= trunc(sysdate)

 UNION ALL

 SELECT "MACHINE_DIV","MACHINE_MESSAGE","MACHINE_DATETIME","MACHINE_TIME" , "RNK"
  FROM (
         SELECT MACHINE_DIV ,'('||SUBSTR(MACHINE_CODE , -2 ,2)||') '||MACHINE_MESSAGE AS MACHINE_MESSAGE, 
                TO_DATE( SUBSTR(MACHINE_DATETIME,1,14) ,'YYYY/MM/DD HH24:MI:SS' )  MACHINE_DATETIME,
                TO_CHAR(TO_DATE( SUBSTR(MACHINE_DATETIME,1,14) ,'YYYY/MM/DD HH24:MI:SS' ) , 'HH24:MI')  MACHINE_TIME,

                row_number() OVER(partition by MACHINE_DIV ORDER BY MACHINE_DATETIME DESC) AS rnk
           FROM ICOM_RECIEVE_DATA_RAW
          WHERE MACHINE_DATETIME >= TO_CHAR(trunc(sysdate) , 'yyyymmddhh24miss')
            AND MACHINE_DIV = 'PLC'
            AND MACHINE_STATUS_DIV = 'ALARM'
       )
 WHERE rnk <= 5
   and MACHINE_DATETIME >= trunc(sysdate);

   COMMENT ON TABLE "INFINITY21_JSFMS"."VIEW_ALARM_TOP5_BY_DATE"  IS '설비알람이력중 가장최근5건조회 , 조회조건에 MACHINE_DIV 를 사용하여 개별그룹 조회'
;
--------------------------------------------------------
--  DDL for View VIEW_CYCLETIME_DATA_RAW
--------------------------------------------------------

  CREATE OR REPLACE FORCE EDITIONABLE VIEW "INFINITY21_JSFMS"."VIEW_CYCLETIME_DATA_RAW" ("PLC_CODE", "MACHINE_CODE", "PLC_DATETIME", "OPERATION_DATETIME", "COMMENTS", "TAG_ADDRESS", "TAG_VALUE", "TAG_NAME", "TAG_GROUP", "TAG_DIVISION", "TAG_TYPE", "TAG_SCALE", "TARGET_MAX_VALUE", "TAG_CLASS", "MACHINE_NAME", "WORKSTAGE_CODE", "MACHINE_SEQ", "ENTER_DATE", "ENTER_BY", "ORGANIZATION_ID") AS 
  SELECT
    ICOM_RECIEVE_PLC_RAW.PLC_CODE,
    ICOM_RECIEVE_PLC_RAW.machine_code,
    ICOM_RECIEVE_PLC_RAW.PLC_DATETIME,
    to_date(substr(ICOM_RECIEVE_PLC_RAW.PLC_DATETIME,1,14) , 'yyyymmddhh24miss') operation_datetime ,
    ICOM_RECIEVE_PLC_RAW.comments,
    ICOM_RECIEVE_PLC_RAW.tag_address,
    TO_NUMBER(ICOM_RECIEVE_PLC_RAW.tag_value) AS tag_value,
    icom_plc_tag_master.tag_name,
    icom_plc_tag_master.tag_group,
    icom_plc_tag_master.tag_division,
    icom_plc_tag_master.tag_type,
    nvl(icom_plc_tag_master.tag_scale ,1 ) tag_scale ,
    icom_plc_tag_master.target_max_value ,

    NVL(icom_plc_tag_master.tag_class,'ETC')    tag_class ,
    icom_machine_master.machine_name ,
    icom_machine_master.workstage_code ,
    icom_machine_master.machine_seq ,
    ICOM_RECIEVE_PLC_RAW.enter_date,
    ICOM_RECIEVE_PLC_RAW.enter_by,
    ICOM_RECIEVE_PLC_RAW.organization_id


FROM
    ICOM_RECIEVE_PLC_RAW,
    icom_plc_tag_master,
    icom_machine_master
 WHERE  ICOM_RECIEVE_PLC_RAW.machine_code = icom_machine_master.machine_code
 AND    ICOM_RECIEVE_PLC_RAW.machine_code = icom_plc_tag_master.machine_code
 AND    ICOM_RECIEVE_PLC_RAW.tag_address = icom_plc_tag_master.tag_address
 AND    icom_plc_tag_master.TAG_TYPE = 'TC'
;
--------------------------------------------------------
--  DDL for View VIEW_CYCLETIME_DATA_RAW_TEMP
--------------------------------------------------------

  CREATE OR REPLACE FORCE EDITIONABLE VIEW "INFINITY21_JSFMS"."VIEW_CYCLETIME_DATA_RAW_TEMP" ("PLC_CODE", "MACHINE_CODE", "PLC_DATETIME", "OPERATION_DATETIME", "COMMENTS", "TAG_ADDRESS", "TAG_VALUE", "TAG_NAME", "TAG_GROUP", "TAG_DIVISION", "TAG_TYPE", "TAG_SCALE", "TARGET_MAX_VALUE", "TAG_CLASS", "MACHINE_NAME", "WORKSTAGE_CODE", "MACHINE_SEQ", "ENTER_DATE", "ENTER_BY", "ORGANIZATION_ID") AS 
  SELECT
    ICOM_RECIEVE_PLC_RAW.PLC_CODE,
    ICOM_RECIEVE_PLC_RAW.machine_code,
    ICOM_RECIEVE_PLC_RAW.PLC_DATETIME,
    to_date(substr(ICOM_RECIEVE_PLC_RAW.PLC_DATETIME,1,14) , 'yyyymmddhh24miss') operation_datetime ,
    ICOM_RECIEVE_PLC_RAW.comments,
    ICOM_RECIEVE_PLC_RAW.tag_address,
    TO_NUMBER(ICOM_RECIEVE_PLC_RAW.tag_value) AS tag_value,
    icom_plc_tag_master.tag_name,
    icom_plc_tag_master.tag_group,
    icom_plc_tag_master.tag_division,
    icom_plc_tag_master.tag_type,
    nvl(icom_plc_tag_master.tag_scale ,1 ) tag_scale ,
    icom_plc_tag_master.target_max_value ,

    NVL(icom_plc_tag_master.tag_class,'ETC')    tag_class ,
    icom_machine_master.machine_name ,
    icom_machine_master.workstage_code ,
    icom_machine_master.machine_seq ,
    ICOM_RECIEVE_PLC_RAW.enter_date,
    ICOM_RECIEVE_PLC_RAW.enter_by,
    ICOM_RECIEVE_PLC_RAW.organization_id


FROM
    ICOM_RECIEVE_PLC_RAW,
    icom_plc_tag_master,
    icom_machine_master
 WHERE  ICOM_RECIEVE_PLC_RAW.machine_code = icom_machine_master.machine_code
 AND    ICOM_RECIEVE_PLC_RAW.machine_code = icom_plc_tag_master.machine_code
 AND    ICOM_RECIEVE_PLC_RAW.tag_address = icom_plc_tag_master.tag_address
 AND    ICOM_RECIEVE_PLC_RAW.TAG_TYPE_R = 'TC'
;
--------------------------------------------------------
--  DDL for View VIEW_DOWN_DATA_RAW
--------------------------------------------------------

  CREATE OR REPLACE FORCE EDITIONABLE VIEW "INFINITY21_JSFMS"."VIEW_DOWN_DATA_RAW" ("PLC_CODE", "MACHINE_CODE", "PLC_DATETIME", "OPERATION_DATETIME", "COMMENTS", "TAG_ADDRESS", "TAG_VALUE", "TAG_VALUE_LAST", "ENTER_DATE", "ENTER_BY", "ORGANIZATION_ID", "DOWN_START_DATETIME", "DOWN_END_DATETIME", "DOWN_TIME_TERM", "TAG_NAME", "TAG_GROUP", "TAG_DIVISION", "ALARM_GROUP_LVL1", "ALARM_GROUP_LVL2", "TAG_TYPE", "TAG_CLASS", "MACHINE_NAME", "WORKSTAGE_CODE", "MACHINE_SEQ") AS 
  SELECT
    ICOM_RECIEVE_DOWN_TIME_RAW.PLC_CODE,
    ICOM_RECIEVE_DOWN_TIME_RAW.machine_code,
    ICOM_RECIEVE_DOWN_TIME_RAW.PLC_DATETIME,
    to_date(substr(ICOM_RECIEVE_DOWN_TIME_RAW.PLC_DATETIME,1,14) , 'yyyymmddhh24miss') operation_datetime ,
    ICOM_RECIEVE_DOWN_TIME_RAW.comments,
    ICOM_RECIEVE_DOWN_TIME_RAW.tag_address, 
    TO_NUMBER(ICOM_RECIEVE_DOWN_TIME_RAW.tag_value) AS tag_value,  
    TO_NUMBER(ICOM_RECIEVE_DOWN_TIME_RAW.tag_value_last) AS tag_value_last,  
    ICOM_RECIEVE_DOWN_TIME_RAW.enter_date,
    ICOM_RECIEVE_DOWN_TIME_RAW.enter_by,
    ICOM_RECIEVE_DOWN_TIME_RAW.organization_id ,
    ICOM_RECIEVE_DOWN_TIME_RAW.DOWN_START_DATETIME ,
    ICOM_RECIEVE_DOWN_TIME_RAW.DOWN_END_DATETIME ,
    NVL(ICOM_RECIEVE_DOWN_TIME_RAW.DOWN_TIME_TERM ,0) AS DOWN_TIME_TERM ,
    
    icom_plc_tag_master.tag_name,
    icom_plc_tag_master.tag_group,
    icom_plc_tag_master.tag_division,
    icom_plc_tag_master.alarm_group_lvl1,
    icom_plc_tag_master.alarm_group_lvl2,  
    icom_plc_tag_master.tag_type,
    NVL(icom_plc_tag_master.tag_class,'ETC')    tag_class ,
    icom_machine_master.machine_name ,
    icom_machine_master.workstage_code ,
    icom_machine_master.machine_seq 

FROM
    ICOM_RECIEVE_DOWN_TIME_RAW,
    icom_plc_tag_master,
    icom_machine_master
 WHERE  ICOM_RECIEVE_DOWN_TIME_RAW.plc_code = icom_plc_tag_master.plc_code(+)
 and ICOM_RECIEVE_DOWN_TIME_RAW.machine_code = icom_plc_tag_master.machine_code(+) 
 and   ICOM_RECIEVE_DOWN_TIME_RAW.tag_address = icom_plc_tag_master.tag_address(+)
 and   ICOM_RECIEVE_DOWN_TIME_RAW.machine_code = icom_machine_master.machine_code(+)
;
--------------------------------------------------------
--  DDL for View VIEW_MACHINE_STATUS
--------------------------------------------------------

  CREATE OR REPLACE FORCE EDITIONABLE VIEW "INFINITY21_JSFMS"."VIEW_MACHINE_STATUS" ("MACHINE_CODE", "MACHINE_NAME", "MACHINE_SPEC", "MACHINE_TYPE", "MACHINE_SEQ", "EQP_STATE", "CONTROL_STATE", "ACTUAL_QTY", "CURRENT_TIME") AS 
  SELECT MACHINE_CODE,
       MACHINE_NAME,
       MACHINE_SPEC,
       MACHINE_TYPE,
       MACHINE_SEQ ,
       F_GET_BASECODE_MASTER( 'EQP_STATE' , EQP_STATE ) AS EQP_STATE ,
       F_GET_BASECODE_MASTER( 'CONTROL_STATE' , CONTROL_STATE ) AS CONTROL_STATE,
       ACTUAL_QTY ,
       TO_CHAR(SYSDATE , 'YYYY/MM/DD/ HH24:MI:SS') AS CURRENT_TIME
FROM ICOM_MACHINE_MASTER
;
--------------------------------------------------------
--  DDL for View VIEW_OPERATION_DATA_RAW
--------------------------------------------------------

  CREATE OR REPLACE FORCE EDITIONABLE VIEW "INFINITY21_JSFMS"."VIEW_OPERATION_DATA_RAW" ("PLC_CODE", "MACHINE_CODE", "PLC_DATETIME", "OPERATION_DATETIME", "COMMENTS", "TAG_ADDRESS", "TAG_VALUE", "TAG_NAME", "TAG_GROUP", "TAG_DIVISION", "TAG_TYPE", "TAG_SCALE", "TARGET_MAX_VALUE", "TAG_CLASS", "MACHINE_NAME", "WORKSTAGE_CODE", "MACHINE_SEQ", "ENTER_DATE", "ENTER_BY", "ORGANIZATION_ID") AS 
  SELECT
    ICOM_RECIEVE_PLC_RAW.PLC_CODE,
    ICOM_RECIEVE_PLC_RAW.machine_code,
    ICOM_RECIEVE_PLC_RAW.PLC_DATETIME,
    to_date(substr(ICOM_RECIEVE_PLC_RAW.PLC_DATETIME,1,14) , 'yyyymmddhh24miss') operation_datetime ,
    ICOM_RECIEVE_PLC_RAW.comments,
    ICOM_RECIEVE_PLC_RAW.tag_address, 
    TO_NUMBER(ICOM_RECIEVE_PLC_RAW.tag_value) AS tag_value,  
    icom_plc_tag_master.tag_name,
    icom_plc_tag_master.tag_group,
    icom_plc_tag_master.tag_division,
    icom_plc_tag_master.tag_type,
    nvl(icom_plc_tag_master.tag_scale ,1 ) tag_scale ,
    icom_plc_tag_master.target_max_value , 
    
    NVL(icom_plc_tag_master.tag_class,'ETC')    tag_class ,
    icom_machine_master.machine_name ,
    icom_machine_master.workstage_code ,
    icom_machine_master.machine_seq ,
    ICOM_RECIEVE_PLC_RAW.enter_date,
    ICOM_RECIEVE_PLC_RAW.enter_by,
    ICOM_RECIEVE_PLC_RAW.organization_id 
    
    
FROM
    ICOM_RECIEVE_PLC_RAW,
    icom_plc_tag_master,
    icom_machine_master
 WHERE  ICOM_RECIEVE_PLC_RAW.machine_code = icom_machine_master.machine_code(+)
 AND    ICOM_RECIEVE_PLC_RAW.machine_code = icom_plc_tag_master.machine_code(+)
 AND    ICOM_RECIEVE_PLC_RAW.tag_address = icom_plc_tag_master.tag_address(+)
;
--------------------------------------------------------
--  DDL for View VIEW_ROBOT_DATA_RAW
--------------------------------------------------------

  CREATE OR REPLACE FORCE EDITIONABLE VIEW "INFINITY21_JSFMS"."VIEW_ROBOT_DATA_RAW" ("MACHINE_DIV", "MACHINE_CODE", "MACHINE_STATUS_DIV", "MACHINE_STATUS_VALUE", "MACHINE_MESSAGE", "MACHINE_DATETIME", "ALARM_DATETIME", "COMMENTS", "ENTER_DATE", "ENTER_BY", "ORGANIZATION_ID", "PLC_CODE", "TAG_ADDRESS", "TAG_NAME", "ALARM_GROUP_LVL1", "ALARM_GROUP_LVL2", "ALARM_GROUP_LVL3", "TAG_DIVISION", "TAG_TYPE", "TAG_CLASS", "MACHINE_NAME", "WORKSTAGE_CODE", "MACHINE_SEQ", "ALARM_START_DATETIME", "ALARM_END_DATETIME", "ALARM_TIME_TERM", "SCADA_ID") AS 
  SELECT
    icom_recieve_data_raw.machine_div,
    icom_recieve_data_raw.machine_code,
    icom_recieve_data_raw.machine_status_div,
    icom_recieve_data_raw.machine_status_value,
    icom_recieve_data_raw.machine_message,
    icom_recieve_data_raw.machine_datetime,
    to_date(substr(icom_recieve_data_raw.machine_datetime,1,14) , 'yyyymmddhh24miss') alarm_datetime ,
    icom_recieve_data_raw.comments,
    icom_recieve_data_raw.enter_date,
    icom_recieve_data_raw.enter_by,
    icom_recieve_data_raw.organization_id,
    icom_recieve_data_raw.plc_code,
    NVL( icom_recieve_data_raw.tag_address, machine_status_div) tag_address, 
    icom_plc_tag_master.tag_name,
    NVL(icom_plc_tag_master.alarm_group_lvl1, 'NN') alarm_group_lvl1 ,
    NVL(icom_plc_tag_master.alarm_group_lvl2, 'NN') alarm_group_lvl2 ,
    icom_plc_tag_master.alarm_group_lvl3,
    icom_plc_tag_master.tag_division,
    icom_plc_tag_master.tag_type,
    NVL(icom_plc_tag_master.tag_class,'ETC')    tag_class ,
    icom_machine_master.machine_name ,
    icom_machine_master.workstage_code ,
    icom_machine_master.machine_seq ,
      icom_recieve_data_raw.alarm_start_datetime ,
    icom_recieve_data_raw.alarm_end_datetime ,
    icom_recieve_data_raw.alarm_time_term ,
    icom_recieve_data_raw.scada_id
    
    
FROM
    icom_recieve_data_raw,
    icom_plc_tag_master,
    icom_machine_master
 WHERE  icom_recieve_data_raw.plc_code = icom_plc_tag_master.plc_code(+)
  and   icom_recieve_data_raw.machine_code = icom_plc_tag_master.machine_code(+)
 and   icom_recieve_data_raw.tag_address = icom_plc_tag_master.tag_address(+)
 and   icom_recieve_data_raw.machine_code = icom_machine_master.machine_code(+)
 and   icom_recieve_data_raw.machine_status_div = 'ROBOT';

   COMMENT ON TABLE "INFINITY21_JSFMS"."VIEW_ROBOT_DATA_RAW"  IS '상태정보조회용뷰'
;
--------------------------------------------------------
--  DDL for View VIEW_STATE_DATA_RAW
--------------------------------------------------------

  CREATE OR REPLACE FORCE EDITIONABLE VIEW "INFINITY21_JSFMS"."VIEW_STATE_DATA_RAW" ("MACHINE_DIV", "MACHINE_CODE", "MACHINE_STATUS_DIV", "MACHINE_STATUS_VALUE", "MACHINE_MESSAGE", "MACHINE_DATETIME", "ALARM_DATETIME", "COMMENTS", "ENTER_DATE", "ENTER_BY", "ORGANIZATION_ID", "PLC_CODE", "TAG_ADDRESS", "TAG_NAME", "ALARM_GROUP_LVL1", "ALARM_GROUP_LVL2", "ALARM_GROUP_LVL3", "TAG_DIVISION", "TAG_TYPE", "TAG_CLASS", "MACHINE_NAME", "WORKSTAGE_CODE", "MACHINE_SEQ", "ALARM_START_DATETIME", "ALARM_END_DATETIME", "ALARM_TIME_TERM", "SCADA_ID") AS 
  SELECT
    icom_recieve_data_raw.machine_div,
    icom_recieve_data_raw.machine_code,
    icom_recieve_data_raw.machine_status_div,
    icom_recieve_data_raw.machine_status_value,
    icom_recieve_data_raw.machine_message,
    icom_recieve_data_raw.machine_datetime,
    to_date(substr(icom_recieve_data_raw.machine_datetime,1,14) , 'yyyymmddhh24miss') alarm_datetime ,
    icom_recieve_data_raw.comments,
    icom_recieve_data_raw.enter_date,
    icom_recieve_data_raw.enter_by,
    icom_recieve_data_raw.organization_id,
    icom_recieve_data_raw.plc_code,
    NVL( icom_recieve_data_raw.tag_address, machine_status_div) tag_address, 
    icom_plc_tag_master.tag_name,
    NVL(icom_plc_tag_master.alarm_group_lvl1, 'NN') alarm_group_lvl1 ,
    NVL(icom_plc_tag_master.alarm_group_lvl2, 'NN') alarm_group_lvl2 ,
    icom_plc_tag_master.alarm_group_lvl3,
    icom_plc_tag_master.tag_division,
    icom_plc_tag_master.tag_type,
    NVL(icom_plc_tag_master.tag_class,'ETC')    tag_class ,
    icom_machine_master.machine_name ,
    icom_machine_master.workstage_code ,
    icom_machine_master.machine_seq ,
      icom_recieve_data_raw.alarm_start_datetime ,
    icom_recieve_data_raw.alarm_end_datetime ,
    icom_recieve_data_raw.alarm_time_term ,
    icom_recieve_data_raw.scada_id
    
    
FROM
    icom_recieve_data_raw,
    icom_plc_tag_master,
    icom_machine_master
 WHERE  icom_recieve_data_raw.plc_code = icom_plc_tag_master.plc_code(+)
 and icom_recieve_data_raw.machine_code = icom_plc_tag_master.machine_code(+)
 and   icom_recieve_data_raw.tag_address = icom_plc_tag_master.tag_address(+)
 and   icom_recieve_data_raw.machine_code = icom_machine_master.machine_code(+)
 and   icom_recieve_data_raw.machine_status_div = 'STATE';

   COMMENT ON TABLE "INFINITY21_JSFMS"."VIEW_STATE_DATA_RAW"  IS '상태정보조회용뷰'
;
--------------------------------------------------------
--  DDL for View VIEW_WORKSTAGE_STATUS
--------------------------------------------------------

  CREATE OR REPLACE FORCE EDITIONABLE VIEW "INFINITY21_JSFMS"."VIEW_WORKSTAGE_STATUS" ("WORKSTAGE_CODE", "WORKSTAGE_NAME", "WORKSTAGE_DESC", "WORKSTAGE_DIVISION", "EQP_STATE", "CONTROL_STATE", "TACT_TIME_INOUT", "TACT_TIME_SETUP", "TACT_TIME_INSTEP", "TACT_TIME_OUTSTEP", "ACTUAL_QTY", "CURRENT_TIME") AS 
  SELECT WORKSTAGE_CODE,
       WORKSTAGE_NAME,
       WORKSTAGE_DESC,
       WORKSTAGE_DIVISION,
       F_GET_BASECODE_MASTER( 'EQP_STATE' , EQP_STATE ) AS EQP_STATE ,
       F_GET_BASECODE_MASTER( 'CONTROL_STATE' , CONTROL_STATE ) AS CONTROL_STATE,
       TACT_TIME_INOUT ,
       TACT_TIME_SETUP ,
       TACT_TIME_INSTEP ,
       TACT_TIME_OUTSTEP ,
       ACTUAL_QTY ,
       TO_CHAR(SYSDATE , 'YYYY/MM/DD/ HH24:MI:SS') AS CURRENT_TIME


FROM ICOM_WORKSTAGE_MASTER
;
--------------------------------------------------------
--  DDL for Index INDXICOM_MACHINE_DETAIL
--------------------------------------------------------

  CREATE UNIQUE INDEX "INFINITY21_JSFMS"."INDXICOM_MACHINE_DETAIL" ON "INFINITY21_JSFMS"."ICOM_MACHINE_DETAIL" ("MACHINE_CODE", "MACHINE_PROPERTY", "ORGANIZATION_ID") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index INDXICOM_MACHINE_MASTER
--------------------------------------------------------

  CREATE UNIQUE INDEX "INFINITY21_JSFMS"."INDXICOM_MACHINE_MASTER" ON "INFINITY21_JSFMS"."ICOM_MACHINE_MASTER" ("MACHINE_CODE", "ORGANIZATION_ID") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index INDXICOM_PLC_TAG_MASTER1
--------------------------------------------------------

  CREATE INDEX "INFINITY21_JSFMS"."INDXICOM_PLC_TAG_MASTER1" ON "INFINITY21_JSFMS"."ICOM_PLC_TAG_MASTER" ("TAG_ADDRESS") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index INDXICOM_PLC_TAG_MASTER2
--------------------------------------------------------

  CREATE INDEX "INFINITY21_JSFMS"."INDXICOM_PLC_TAG_MASTER2" ON "INFINITY21_JSFMS"."ICOM_PLC_TAG_MASTER" ("TAG_GROUP", "TAG_TYPE") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index INDXICOM_PLC_TAG_MASTER3
--------------------------------------------------------

  CREATE UNIQUE INDEX "INFINITY21_JSFMS"."INDXICOM_PLC_TAG_MASTER3" ON "INFINITY21_JSFMS"."ICOM_PLC_TAG_MASTER" ("PLC_CODE", "MACHINE_CODE", "TAG_ADDRESS") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index INDXICOM_PLC_TAG_MASTER4
--------------------------------------------------------

  CREATE INDEX "INFINITY21_JSFMS"."INDXICOM_PLC_TAG_MASTER4" ON "INFINITY21_JSFMS"."ICOM_PLC_TAG_MASTER" ("MACHINE_CODE", "TAG_ADDRESS", "TAG_TYPE") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index INDXICOM_RECIEVE_DATA_RAW1
--------------------------------------------------------

  CREATE INDEX "INFINITY21_JSFMS"."INDXICOM_RECIEVE_DATA_RAW1" ON "INFINITY21_JSFMS"."ICOM_RECIEVE_DATA_RAW" ("MACHINE_DIV", "MACHINE_CODE", "TAG_ADDRESS") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index INDXICOM_RECIEVE_DATA_RAW2
--------------------------------------------------------

  CREATE INDEX "INFINITY21_JSFMS"."INDXICOM_RECIEVE_DATA_RAW2" ON "INFINITY21_JSFMS"."ICOM_RECIEVE_DATA_RAW" ("MACHINE_DATETIME", "MACHINE_CODE") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index INDXICOM_RECIEVE_DATA_RAW3
--------------------------------------------------------

  CREATE INDEX "INFINITY21_JSFMS"."INDXICOM_RECIEVE_DATA_RAW3" ON "INFINITY21_JSFMS"."ICOM_RECIEVE_DATA_RAW" ("PLC_CODE", "MACHINE_CODE", "TAG_ADDRESS") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index INDXICOM_RECIEVE_DOWN_TIME1
--------------------------------------------------------

  CREATE INDEX "INFINITY21_JSFMS"."INDXICOM_RECIEVE_DOWN_TIME1" ON "INFINITY21_JSFMS"."ICOM_RECIEVE_DOWN_TIME_RAW" ("MACHINE_CODE", "DOWN_START_DATETIME") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index INDXICOM_RECIEVE_PLC_RAW1
--------------------------------------------------------

  CREATE INDEX "INFINITY21_JSFMS"."INDXICOM_RECIEVE_PLC_RAW1" ON "INFINITY21_JSFMS"."ICOM_RECIEVE_PLC_RAW" ("PLC_DATETIME", "MACHINE_CODE") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index INDXICOM_RECIEVE_PLC_RAW2
--------------------------------------------------------

  CREATE INDEX "INFINITY21_JSFMS"."INDXICOM_RECIEVE_PLC_RAW2" ON "INFINITY21_JSFMS"."ICOM_RECIEVE_PLC_RAW" ("TAG_ADDRESS", "MACHINE_CODE") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index INDXICOM_RECIEVE_PLC_RAW3
--------------------------------------------------------

  CREATE INDEX "INFINITY21_JSFMS"."INDXICOM_RECIEVE_PLC_RAW3" ON "INFINITY21_JSFMS"."ICOM_RECIEVE_PLC_RAW" ("MACHINE_CODE", "PLC_DATETIME") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index INDXICOM_RECIEVE_PLC_RAW4
--------------------------------------------------------

  CREATE INDEX "INFINITY21_JSFMS"."INDXICOM_RECIEVE_PLC_RAW4" ON "INFINITY21_JSFMS"."ICOM_RECIEVE_PLC_RAW" ("PLC_CODE", "MACHINE_CODE", "PLC_DATETIME") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index INDXICOM_RECIEVE_PLC_RAW5
--------------------------------------------------------

  CREATE INDEX "INFINITY21_JSFMS"."INDXICOM_RECIEVE_PLC_RAW5" ON "INFINITY21_JSFMS"."ICOM_RECIEVE_PLC_RAW" ("PLC_DATETIME", "TAG_TYPE_R") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index INDXICOM_WORKSTAGE_MSTER
--------------------------------------------------------

  CREATE UNIQUE INDEX "INFINITY21_JSFMS"."INDXICOM_WORKSTAGE_MSTER" ON "INFINITY21_JSFMS"."ICOM_WORKSTAGE_MASTER" ("WORKSTAGE_CODE", "ORGANIZATION_ID") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index PK_XSCADA_GROUP_KEY_REF
--------------------------------------------------------

  CREATE UNIQUE INDEX "INFINITY21_JSFMS"."PK_XSCADA_GROUP_KEY_REF" ON "INFINITY21_JSFMS"."XSCADA_GROUP_KEY_REF" ("GROUPIDX", "KEYIDX") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index PK_XSCADA_USER_GROUP_REF
--------------------------------------------------------

  CREATE UNIQUE INDEX "INFINITY21_JSFMS"."PK_XSCADA_USER_GROUP_REF" ON "INFINITY21_JSFMS"."XSCADA_USER_GROUP_REF" ("USERIDX", "GROUPIDX") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index PK_XSCADA_USER_KEY_REF
--------------------------------------------------------

  CREATE UNIQUE INDEX "INFINITY21_JSFMS"."PK_XSCADA_USER_KEY_REF" ON "INFINITY21_JSFMS"."XSCADA_USER_KEY_REF" ("USERIDX", "KEYIDX") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index SYS_C0020422
--------------------------------------------------------

  CREATE UNIQUE INDEX "INFINITY21_JSFMS"."SYS_C0020422" ON "INFINITY21_JSFMS"."XSCADA_SYSTEM" ("ID") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index SYS_C0020423
--------------------------------------------------------

  CREATE UNIQUE INDEX "INFINITY21_JSFMS"."SYS_C0020423" ON "INFINITY21_JSFMS"."XSCADA_SYSTEM" ("KEY") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index SYS_C0020430
--------------------------------------------------------

  CREATE UNIQUE INDEX "INFINITY21_JSFMS"."SYS_C0020430" ON "INFINITY21_JSFMS"."XSCADA_SYSTEM_LOG" ("ID") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index SYS_C0020436
--------------------------------------------------------

  CREATE UNIQUE INDEX "INFINITY21_JSFMS"."SYS_C0020436" ON "INFINITY21_JSFMS"."XSCADA_DATATAG" ("ID") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index SYS_C0020437
--------------------------------------------------------

  CREATE UNIQUE INDEX "INFINITY21_JSFMS"."SYS_C0020437" ON "INFINITY21_JSFMS"."XSCADA_DATATAG" ("NAME") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index SYS_C0020445
--------------------------------------------------------

  CREATE UNIQUE INDEX "INFINITY21_JSFMS"."SYS_C0020445" ON "INFINITY21_JSFMS"."XSCADA_DATATAG_LOG" ("ID") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index SYS_C0020456
--------------------------------------------------------

  CREATE UNIQUE INDEX "INFINITY21_JSFMS"."SYS_C0020456" ON "INFINITY21_JSFMS"."XSCADA_ALARM_LOG" ("ID") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index SYS_C0020468
--------------------------------------------------------

  CREATE UNIQUE INDEX "INFINITY21_JSFMS"."SYS_C0020468" ON "INFINITY21_JSFMS"."XSCADA_SMS_LOG" ("ID") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index SYS_C0020473
--------------------------------------------------------

  CREATE UNIQUE INDEX "INFINITY21_JSFMS"."SYS_C0020473" ON "INFINITY21_JSFMS"."XSCADA_DATA_REPOSITORY" ("KEY_") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index SYS_C0020481
--------------------------------------------------------

  CREATE UNIQUE INDEX "INFINITY21_JSFMS"."SYS_C0020481" ON "INFINITY21_JSFMS"."XSCADA_MOBILE" ("ID") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index SYS_C0020482
--------------------------------------------------------

  CREATE UNIQUE INDEX "INFINITY21_JSFMS"."SYS_C0020482" ON "INFINITY21_JSFMS"."XSCADA_MOBILE" ("NAME") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index SYS_C0020489
--------------------------------------------------------

  CREATE UNIQUE INDEX "INFINITY21_JSFMS"."SYS_C0020489" ON "INFINITY21_JSFMS"."XSCADA_SECURITY_LOG" ("IDX") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index SYS_C0020500
--------------------------------------------------------

  CREATE UNIQUE INDEX "INFINITY21_JSFMS"."SYS_C0020500" ON "INFINITY21_JSFMS"."XSCADA_USER" ("IDX") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index SYS_C0020509
--------------------------------------------------------

  CREATE UNIQUE INDEX "INFINITY21_JSFMS"."SYS_C0020509" ON "INFINITY21_JSFMS"."XSCADA_LOGIN_USER" ("SESSION_") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index SYS_C0020516
--------------------------------------------------------

  CREATE UNIQUE INDEX "INFINITY21_JSFMS"."SYS_C0020516" ON "INFINITY21_JSFMS"."XSCADA_GROUP" ("IDX") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index SYS_C0020522
--------------------------------------------------------

  CREATE UNIQUE INDEX "INFINITY21_JSFMS"."SYS_C0020522" ON "INFINITY21_JSFMS"."XSCADA_SECURITY_KEY" ("IDX") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index SYS_C0020526
--------------------------------------------------------

  CREATE UNIQUE INDEX "INFINITY21_JSFMS"."SYS_C0020526" ON "INFINITY21_JSFMS"."XSCADA_PROPERTIES" ("IDX") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index T_DASHBOARD_ITEMS_PK
--------------------------------------------------------

  CREATE UNIQUE INDEX "INFINITY21_JSFMS"."T_DASHBOARD_ITEMS_PK" ON "INFINITY21_JSFMS"."T_DASHBOARD_ITEMS" ("ITEM_IDENT") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index T_DASHBOARD_ITEM_TYPES_PK
--------------------------------------------------------

  CREATE UNIQUE INDEX "INFINITY21_JSFMS"."T_DASHBOARD_ITEM_TYPES_PK" ON "INFINITY21_JSFMS"."T_DASHBOARD_ITEM_TYPES" ("TYPE_ID") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index XPKICOM_TROUBLE_SOLVE
--------------------------------------------------------

  CREATE UNIQUE INDEX "INFINITY21_JSFMS"."XPKICOM_TROUBLE_SOLVE" ON "INFINITY21_JSFMS"."ICOM_TROUBLE_SOLVE_HIST" ("MACHINE_CODE", "TROUBLE_DATETIME", "SOLVE_ACTION_DATETIME") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index XPKISYS_BASECODE_MASTER
--------------------------------------------------------

  CREATE UNIQUE INDEX "INFINITY21_JSFMS"."XPKISYS_BASECODE_MASTER" ON "INFINITY21_JSFMS"."ISYS_BASECODE_MASTER" ("CODE_TYPE", "CODE_NAME", "ORGANIZATION_ID") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index XPKISYS_CONFIG_MASTER
--------------------------------------------------------

  CREATE UNIQUE INDEX "INFINITY21_JSFMS"."XPKISYS_CONFIG_MASTER" ON "INFINITY21_JSFMS"."ISYS_CONFIG_MASTER" ("CONFIG_NAME", "ORGANIZATION_ID") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index XSCADA_ALARM_LOG_IDX1
--------------------------------------------------------

  CREATE INDEX "INFINITY21_JSFMS"."XSCADA_ALARM_LOG_IDX1" ON "INFINITY21_JSFMS"."XSCADA_ALARM_LOG" ("OTIME") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index XSCADA_ALARM_LOG_IDX2
--------------------------------------------------------

  CREATE INDEX "INFINITY21_JSFMS"."XSCADA_ALARM_LOG_IDX2" ON "INFINITY21_JSFMS"."XSCADA_ALARM_LOG" ("NAME") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index XSCADA_DATATAG_LOG_IDX1
--------------------------------------------------------

  CREATE INDEX "INFINITY21_JSFMS"."XSCADA_DATATAG_LOG_IDX1" ON "INFINITY21_JSFMS"."XSCADA_DATATAG_LOG" ("OTIME") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index XSCADA_DATATAG_LOG_IDX2
--------------------------------------------------------

  CREATE INDEX "INFINITY21_JSFMS"."XSCADA_DATATAG_LOG_IDX2" ON "INFINITY21_JSFMS"."XSCADA_DATATAG_LOG" ("DATATAG_NAME", "DATATAG_TYPE") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index XSCADA_MOBILE_IDX1
--------------------------------------------------------

  CREATE INDEX "INFINITY21_JSFMS"."XSCADA_MOBILE_IDX1" ON "INFINITY21_JSFMS"."XSCADA_MOBILE" ("MTIME") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index XSCADA_MOBILE_IDX2
--------------------------------------------------------

  CREATE INDEX "INFINITY21_JSFMS"."XSCADA_MOBILE_IDX2" ON "INFINITY21_JSFMS"."XSCADA_MOBILE" ("TYPE") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index XSCADA_PROPERTIES_UQ
--------------------------------------------------------

  CREATE UNIQUE INDEX "INFINITY21_JSFMS"."XSCADA_PROPERTIES_UQ" ON "INFINITY21_JSFMS"."XSCADA_PROPERTIES" ("NAME") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index XSCADA_SECURITY_LOG_IDX1
--------------------------------------------------------

  CREATE INDEX "INFINITY21_JSFMS"."XSCADA_SECURITY_LOG_IDX1" ON "INFINITY21_JSFMS"."XSCADA_SECURITY_LOG" ("OTIME") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index XSCADA_SECURITY_LOG_IDX2
--------------------------------------------------------

  CREATE INDEX "INFINITY21_JSFMS"."XSCADA_SECURITY_LOG_IDX2" ON "INFINITY21_JSFMS"."XSCADA_SECURITY_LOG" ("ID") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index XSCADA_SMS_LOG_IDX1
--------------------------------------------------------

  CREATE INDEX "INFINITY21_JSFMS"."XSCADA_SMS_LOG_IDX1" ON "INFINITY21_JSFMS"."XSCADA_SMS_LOG" ("SENDING_TIME") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index XSCADA_SMS_LOG_IDX2
--------------------------------------------------------

  CREATE INDEX "INFINITY21_JSFMS"."XSCADA_SMS_LOG_IDX2" ON "INFINITY21_JSFMS"."XSCADA_SMS_LOG" ("STATUS") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index XSCADA_SMS_LOG_IDX3
--------------------------------------------------------

  CREATE INDEX "INFINITY21_JSFMS"."XSCADA_SMS_LOG_IDX3" ON "INFINITY21_JSFMS"."XSCADA_SMS_LOG" ("SENDING_TIME", "STATUS") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index XSCADA_SYSTEM_LOG_IDX1
--------------------------------------------------------

  CREATE INDEX "INFINITY21_JSFMS"."XSCADA_SYSTEM_LOG_IDX1" ON "INFINITY21_JSFMS"."XSCADA_SYSTEM_LOG" ("OTIME") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index XSCADA_SYSTEM_LOG_IDX2
--------------------------------------------------------

  CREATE INDEX "INFINITY21_JSFMS"."XSCADA_SYSTEM_LOG_IDX2" ON "INFINITY21_JSFMS"."XSCADA_SYSTEM_LOG" ("CATEGORY") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index XSCADA_SYSTEM_LOG_IDX3
--------------------------------------------------------

  CREATE INDEX "INFINITY21_JSFMS"."XSCADA_SYSTEM_LOG_IDX3" ON "INFINITY21_JSFMS"."XSCADA_SYSTEM_LOG" ("CATEGORY", "LEVEL_") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index INDXICOM_MACHINE_DETAIL
--------------------------------------------------------

  CREATE UNIQUE INDEX "INFINITY21_JSFMS"."INDXICOM_MACHINE_DETAIL" ON "INFINITY21_JSFMS"."ICOM_MACHINE_DETAIL" ("MACHINE_CODE", "MACHINE_PROPERTY", "ORGANIZATION_ID") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index INDXICOM_MACHINE_MASTER
--------------------------------------------------------

  CREATE UNIQUE INDEX "INFINITY21_JSFMS"."INDXICOM_MACHINE_MASTER" ON "INFINITY21_JSFMS"."ICOM_MACHINE_MASTER" ("MACHINE_CODE", "ORGANIZATION_ID") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index INDXICOM_PLC_TAG_MASTER2
--------------------------------------------------------

  CREATE INDEX "INFINITY21_JSFMS"."INDXICOM_PLC_TAG_MASTER2" ON "INFINITY21_JSFMS"."ICOM_PLC_TAG_MASTER" ("TAG_GROUP", "TAG_TYPE") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index INDXICOM_PLC_TAG_MASTER3
--------------------------------------------------------

  CREATE UNIQUE INDEX "INFINITY21_JSFMS"."INDXICOM_PLC_TAG_MASTER3" ON "INFINITY21_JSFMS"."ICOM_PLC_TAG_MASTER" ("PLC_CODE", "MACHINE_CODE", "TAG_ADDRESS") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index INDXICOM_PLC_TAG_MASTER4
--------------------------------------------------------

  CREATE INDEX "INFINITY21_JSFMS"."INDXICOM_PLC_TAG_MASTER4" ON "INFINITY21_JSFMS"."ICOM_PLC_TAG_MASTER" ("MACHINE_CODE", "TAG_ADDRESS", "TAG_TYPE") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index INDXICOM_PLC_TAG_MASTER1
--------------------------------------------------------

  CREATE INDEX "INFINITY21_JSFMS"."INDXICOM_PLC_TAG_MASTER1" ON "INFINITY21_JSFMS"."ICOM_PLC_TAG_MASTER" ("TAG_ADDRESS") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index INDXICOM_RECIEVE_DATA_RAW1
--------------------------------------------------------

  CREATE INDEX "INFINITY21_JSFMS"."INDXICOM_RECIEVE_DATA_RAW1" ON "INFINITY21_JSFMS"."ICOM_RECIEVE_DATA_RAW" ("MACHINE_DIV", "MACHINE_CODE", "TAG_ADDRESS") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index INDXICOM_RECIEVE_DATA_RAW2
--------------------------------------------------------

  CREATE INDEX "INFINITY21_JSFMS"."INDXICOM_RECIEVE_DATA_RAW2" ON "INFINITY21_JSFMS"."ICOM_RECIEVE_DATA_RAW" ("MACHINE_DATETIME", "MACHINE_CODE") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index INDXICOM_RECIEVE_DATA_RAW3
--------------------------------------------------------

  CREATE INDEX "INFINITY21_JSFMS"."INDXICOM_RECIEVE_DATA_RAW3" ON "INFINITY21_JSFMS"."ICOM_RECIEVE_DATA_RAW" ("PLC_CODE", "MACHINE_CODE", "TAG_ADDRESS") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index INDXICOM_RECIEVE_DOWN_TIME1
--------------------------------------------------------

  CREATE INDEX "INFINITY21_JSFMS"."INDXICOM_RECIEVE_DOWN_TIME1" ON "INFINITY21_JSFMS"."ICOM_RECIEVE_DOWN_TIME_RAW" ("MACHINE_CODE", "DOWN_START_DATETIME") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index INDXICOM_RECIEVE_PLC_RAW1
--------------------------------------------------------

  CREATE INDEX "INFINITY21_JSFMS"."INDXICOM_RECIEVE_PLC_RAW1" ON "INFINITY21_JSFMS"."ICOM_RECIEVE_PLC_RAW" ("PLC_DATETIME", "MACHINE_CODE") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index INDXICOM_RECIEVE_PLC_RAW2
--------------------------------------------------------

  CREATE INDEX "INFINITY21_JSFMS"."INDXICOM_RECIEVE_PLC_RAW2" ON "INFINITY21_JSFMS"."ICOM_RECIEVE_PLC_RAW" ("TAG_ADDRESS", "MACHINE_CODE") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index INDXICOM_RECIEVE_PLC_RAW3
--------------------------------------------------------

  CREATE INDEX "INFINITY21_JSFMS"."INDXICOM_RECIEVE_PLC_RAW3" ON "INFINITY21_JSFMS"."ICOM_RECIEVE_PLC_RAW" ("MACHINE_CODE", "PLC_DATETIME") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index INDXICOM_RECIEVE_PLC_RAW4
--------------------------------------------------------

  CREATE INDEX "INFINITY21_JSFMS"."INDXICOM_RECIEVE_PLC_RAW4" ON "INFINITY21_JSFMS"."ICOM_RECIEVE_PLC_RAW" ("PLC_CODE", "MACHINE_CODE", "PLC_DATETIME") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index INDXICOM_RECIEVE_PLC_RAW5
--------------------------------------------------------

  CREATE INDEX "INFINITY21_JSFMS"."INDXICOM_RECIEVE_PLC_RAW5" ON "INFINITY21_JSFMS"."ICOM_RECIEVE_PLC_RAW" ("PLC_DATETIME", "TAG_TYPE_R") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index XPKICOM_TROUBLE_SOLVE
--------------------------------------------------------

  CREATE UNIQUE INDEX "INFINITY21_JSFMS"."XPKICOM_TROUBLE_SOLVE" ON "INFINITY21_JSFMS"."ICOM_TROUBLE_SOLVE_HIST" ("MACHINE_CODE", "TROUBLE_DATETIME", "SOLVE_ACTION_DATETIME") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index INDXICOM_WORKSTAGE_MSTER
--------------------------------------------------------

  CREATE UNIQUE INDEX "INFINITY21_JSFMS"."INDXICOM_WORKSTAGE_MSTER" ON "INFINITY21_JSFMS"."ICOM_WORKSTAGE_MASTER" ("WORKSTAGE_CODE", "ORGANIZATION_ID") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index XPKISYS_BASECODE_MASTER
--------------------------------------------------------

  CREATE UNIQUE INDEX "INFINITY21_JSFMS"."XPKISYS_BASECODE_MASTER" ON "INFINITY21_JSFMS"."ISYS_BASECODE_MASTER" ("CODE_TYPE", "CODE_NAME", "ORGANIZATION_ID") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index XPKISYS_CONFIG_MASTER
--------------------------------------------------------

  CREATE UNIQUE INDEX "INFINITY21_JSFMS"."XPKISYS_CONFIG_MASTER" ON "INFINITY21_JSFMS"."ISYS_CONFIG_MASTER" ("CONFIG_NAME", "ORGANIZATION_ID") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index T_DASHBOARD_ITEMS_PK
--------------------------------------------------------

  CREATE UNIQUE INDEX "INFINITY21_JSFMS"."T_DASHBOARD_ITEMS_PK" ON "INFINITY21_JSFMS"."T_DASHBOARD_ITEMS" ("ITEM_IDENT") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index T_DASHBOARD_ITEM_TYPES_PK
--------------------------------------------------------

  CREATE UNIQUE INDEX "INFINITY21_JSFMS"."T_DASHBOARD_ITEM_TYPES_PK" ON "INFINITY21_JSFMS"."T_DASHBOARD_ITEM_TYPES" ("TYPE_ID") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index XSCADA_ALARM_LOG_IDX1
--------------------------------------------------------

  CREATE INDEX "INFINITY21_JSFMS"."XSCADA_ALARM_LOG_IDX1" ON "INFINITY21_JSFMS"."XSCADA_ALARM_LOG" ("OTIME") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index XSCADA_ALARM_LOG_IDX2
--------------------------------------------------------

  CREATE INDEX "INFINITY21_JSFMS"."XSCADA_ALARM_LOG_IDX2" ON "INFINITY21_JSFMS"."XSCADA_ALARM_LOG" ("NAME") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index SYS_C0020456
--------------------------------------------------------

  CREATE UNIQUE INDEX "INFINITY21_JSFMS"."SYS_C0020456" ON "INFINITY21_JSFMS"."XSCADA_ALARM_LOG" ("ID") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index SYS_C0020436
--------------------------------------------------------

  CREATE UNIQUE INDEX "INFINITY21_JSFMS"."SYS_C0020436" ON "INFINITY21_JSFMS"."XSCADA_DATATAG" ("ID") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index SYS_C0020437
--------------------------------------------------------

  CREATE UNIQUE INDEX "INFINITY21_JSFMS"."SYS_C0020437" ON "INFINITY21_JSFMS"."XSCADA_DATATAG" ("NAME") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index XSCADA_DATATAG_LOG_IDX1
--------------------------------------------------------

  CREATE INDEX "INFINITY21_JSFMS"."XSCADA_DATATAG_LOG_IDX1" ON "INFINITY21_JSFMS"."XSCADA_DATATAG_LOG" ("OTIME") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index XSCADA_DATATAG_LOG_IDX2
--------------------------------------------------------

  CREATE INDEX "INFINITY21_JSFMS"."XSCADA_DATATAG_LOG_IDX2" ON "INFINITY21_JSFMS"."XSCADA_DATATAG_LOG" ("DATATAG_NAME", "DATATAG_TYPE") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index SYS_C0020445
--------------------------------------------------------

  CREATE UNIQUE INDEX "INFINITY21_JSFMS"."SYS_C0020445" ON "INFINITY21_JSFMS"."XSCADA_DATATAG_LOG" ("ID") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index SYS_C0020473
--------------------------------------------------------

  CREATE UNIQUE INDEX "INFINITY21_JSFMS"."SYS_C0020473" ON "INFINITY21_JSFMS"."XSCADA_DATA_REPOSITORY" ("KEY_") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index SYS_C0020516
--------------------------------------------------------

  CREATE UNIQUE INDEX "INFINITY21_JSFMS"."SYS_C0020516" ON "INFINITY21_JSFMS"."XSCADA_GROUP" ("IDX") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index PK_XSCADA_GROUP_KEY_REF
--------------------------------------------------------

  CREATE UNIQUE INDEX "INFINITY21_JSFMS"."PK_XSCADA_GROUP_KEY_REF" ON "INFINITY21_JSFMS"."XSCADA_GROUP_KEY_REF" ("GROUPIDX", "KEYIDX") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index SYS_C0020509
--------------------------------------------------------

  CREATE UNIQUE INDEX "INFINITY21_JSFMS"."SYS_C0020509" ON "INFINITY21_JSFMS"."XSCADA_LOGIN_USER" ("SESSION_") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index XSCADA_MOBILE_IDX1
--------------------------------------------------------

  CREATE INDEX "INFINITY21_JSFMS"."XSCADA_MOBILE_IDX1" ON "INFINITY21_JSFMS"."XSCADA_MOBILE" ("MTIME") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index XSCADA_MOBILE_IDX2
--------------------------------------------------------

  CREATE INDEX "INFINITY21_JSFMS"."XSCADA_MOBILE_IDX2" ON "INFINITY21_JSFMS"."XSCADA_MOBILE" ("TYPE") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index SYS_C0020481
--------------------------------------------------------

  CREATE UNIQUE INDEX "INFINITY21_JSFMS"."SYS_C0020481" ON "INFINITY21_JSFMS"."XSCADA_MOBILE" ("ID") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index SYS_C0020482
--------------------------------------------------------

  CREATE UNIQUE INDEX "INFINITY21_JSFMS"."SYS_C0020482" ON "INFINITY21_JSFMS"."XSCADA_MOBILE" ("NAME") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index SYS_C0020526
--------------------------------------------------------

  CREATE UNIQUE INDEX "INFINITY21_JSFMS"."SYS_C0020526" ON "INFINITY21_JSFMS"."XSCADA_PROPERTIES" ("IDX") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index XSCADA_PROPERTIES_UQ
--------------------------------------------------------

  CREATE UNIQUE INDEX "INFINITY21_JSFMS"."XSCADA_PROPERTIES_UQ" ON "INFINITY21_JSFMS"."XSCADA_PROPERTIES" ("NAME") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index SYS_C0020522
--------------------------------------------------------

  CREATE UNIQUE INDEX "INFINITY21_JSFMS"."SYS_C0020522" ON "INFINITY21_JSFMS"."XSCADA_SECURITY_KEY" ("IDX") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index SYS_C0020489
--------------------------------------------------------

  CREATE UNIQUE INDEX "INFINITY21_JSFMS"."SYS_C0020489" ON "INFINITY21_JSFMS"."XSCADA_SECURITY_LOG" ("IDX") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index XSCADA_SECURITY_LOG_IDX1
--------------------------------------------------------

  CREATE INDEX "INFINITY21_JSFMS"."XSCADA_SECURITY_LOG_IDX1" ON "INFINITY21_JSFMS"."XSCADA_SECURITY_LOG" ("OTIME") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index XSCADA_SECURITY_LOG_IDX2
--------------------------------------------------------

  CREATE INDEX "INFINITY21_JSFMS"."XSCADA_SECURITY_LOG_IDX2" ON "INFINITY21_JSFMS"."XSCADA_SECURITY_LOG" ("ID") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index SYS_C0020468
--------------------------------------------------------

  CREATE UNIQUE INDEX "INFINITY21_JSFMS"."SYS_C0020468" ON "INFINITY21_JSFMS"."XSCADA_SMS_LOG" ("ID") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index XSCADA_SMS_LOG_IDX1
--------------------------------------------------------

  CREATE INDEX "INFINITY21_JSFMS"."XSCADA_SMS_LOG_IDX1" ON "INFINITY21_JSFMS"."XSCADA_SMS_LOG" ("SENDING_TIME") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index XSCADA_SMS_LOG_IDX2
--------------------------------------------------------

  CREATE INDEX "INFINITY21_JSFMS"."XSCADA_SMS_LOG_IDX2" ON "INFINITY21_JSFMS"."XSCADA_SMS_LOG" ("STATUS") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index XSCADA_SMS_LOG_IDX3
--------------------------------------------------------

  CREATE INDEX "INFINITY21_JSFMS"."XSCADA_SMS_LOG_IDX3" ON "INFINITY21_JSFMS"."XSCADA_SMS_LOG" ("SENDING_TIME", "STATUS") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index SYS_C0020422
--------------------------------------------------------

  CREATE UNIQUE INDEX "INFINITY21_JSFMS"."SYS_C0020422" ON "INFINITY21_JSFMS"."XSCADA_SYSTEM" ("ID") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index SYS_C0020423
--------------------------------------------------------

  CREATE UNIQUE INDEX "INFINITY21_JSFMS"."SYS_C0020423" ON "INFINITY21_JSFMS"."XSCADA_SYSTEM" ("KEY") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index SYS_C0020430
--------------------------------------------------------

  CREATE UNIQUE INDEX "INFINITY21_JSFMS"."SYS_C0020430" ON "INFINITY21_JSFMS"."XSCADA_SYSTEM_LOG" ("ID") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index XSCADA_SYSTEM_LOG_IDX1
--------------------------------------------------------

  CREATE INDEX "INFINITY21_JSFMS"."XSCADA_SYSTEM_LOG_IDX1" ON "INFINITY21_JSFMS"."XSCADA_SYSTEM_LOG" ("OTIME") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index XSCADA_SYSTEM_LOG_IDX2
--------------------------------------------------------

  CREATE INDEX "INFINITY21_JSFMS"."XSCADA_SYSTEM_LOG_IDX2" ON "INFINITY21_JSFMS"."XSCADA_SYSTEM_LOG" ("CATEGORY") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index XSCADA_SYSTEM_LOG_IDX3
--------------------------------------------------------

  CREATE INDEX "INFINITY21_JSFMS"."XSCADA_SYSTEM_LOG_IDX3" ON "INFINITY21_JSFMS"."XSCADA_SYSTEM_LOG" ("CATEGORY", "LEVEL_") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index SYS_C0020500
--------------------------------------------------------

  CREATE UNIQUE INDEX "INFINITY21_JSFMS"."SYS_C0020500" ON "INFINITY21_JSFMS"."XSCADA_USER" ("IDX") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index PK_XSCADA_USER_GROUP_REF
--------------------------------------------------------

  CREATE UNIQUE INDEX "INFINITY21_JSFMS"."PK_XSCADA_USER_GROUP_REF" ON "INFINITY21_JSFMS"."XSCADA_USER_GROUP_REF" ("USERIDX", "GROUPIDX") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Index PK_XSCADA_USER_KEY_REF
--------------------------------------------------------

  CREATE UNIQUE INDEX "INFINITY21_JSFMS"."PK_XSCADA_USER_KEY_REF" ON "INFINITY21_JSFMS"."XSCADA_USER_KEY_REF" ("USERIDX", "KEYIDX") 
  PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "USERS" ;
--------------------------------------------------------
--  DDL for Trigger TRG_ICOM_RECIEVE_DATA_INS
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE TRIGGER "INFINITY21_JSFMS"."TRG_ICOM_RECIEVE_DATA_INS" 
AFTER INSERT ON ICOM_RECIEVE_DATA_RAW 
REFERENCING OLD AS OLD NEW AS NEW 
FOR EACH ROW 

DECLARE 

DEBUG_PHASE VARCHAR2(100);
LVI_EXISTS NUMBER ;

BEGIN

--------------------------------------------------
-- PLC 를 통해서 들어온건지 P_SET_RECIEVE_DATA_RAW API 를 통해 들어온건지 판단  
--------------------------------------------------
IF :NEW.MACHINE_DIV = 'PLC' THEN 

      --------------------------------------------------
      --알람이 들어오면 설비마스터에 상태만 변경
      --조업이 종료 되는경우 PLC03 W0105 가 ON(1) 되면 다운 타임 종료 
      --PLC03 에서 강제로 W0105 로 지정됨 
      --------------------------------------------------

      IF UPPER(:NEW.MACHINE_STATUS_DIV) = 'ALARM' THEN

           IF :NEW.TAG_ADDRESS = 'W0105' AND  :NEW.MACHINE_STATUS_VALUE = '1' THEN 

                DEBUG_PHASE := 'UPDATE DOWN TIME BY ALARM' ;
                UPDATE icom_recieve_down_time_raw 
                   SET down_end_datetime = CAST(:NEW.PLC_TIMESTAMP AS DATE)  ,
                       down_time_term    = round(( CAST(:NEW.PLC_TIMESTAMP AS DATE)  - down_start_datetime ) * 24* 60 , 3) , --분으로 처리 
                       tag_value_last    = :NEW.MACHINE_STATUS_VALUE ,
                       is_fixed = 'Y'
                 WHERE machine_code = :NEW.machine_code
--                   AND down_start_datetime = ( SELECT MAX(down_start_datetime) 
--                                                 FROM icom_recieve_down_time_raw 
--                                                WHERE machine_code = :NEW.machine_code
--                                                   AND down_start_datetime <= CAST(:NEW.PLC_TIMESTAMP AS DATE)  --가장 최근 데이터만 업데이트
--                                                   AND tag_address  = :NEW.tag_address
--                                                   AND tag_value    <> :NEW.MACHINE_STATUS_VALUE 
--                                               )
--                   AND tag_address  = :NEW.tag_address
--                   AND tag_value    <> :NEW.MACHINE_STATUS_VALUE --EQP state down
                   AND down_end_datetime IS NULL
                   ;         

           ELSE
              NULL;
           END IF ; 
           --PLC 발생 마지막 알람을 저장한다
           UPDATE ICOM_MACHINE_MASTER 
              SET LAST_ALARM_TAG_ADDRESS = :NEW.TAG_ADDRESS ,
                  LAST_ALARM_DATETIME    = CAST(:NEW.PLC_TIMESTAMP AS DATE)
            WHERE MACHINE_CODE = :NEW.MACHINE_CODE ;
       --------------------------------------------------------
       ELSIF UPPER(:NEW.MACHINE_STATUS_DIV) = 'ROBOT' THEN
           --PLC 발생 마지막 알람을 저장한다
             NULL ;
      -------------------------------------------------------------------------
      -- 설비동작상태중에 상태변화에 대한 값은 알람 테이블에 저장한다( 변화값 감지후저장방식)
      -- 일반적인 상태값은 ICOM_RECIEVE_PLC_RAW 테이블에 저장 (비트태그 감지후 저장방식)
      -- 설비 동작상태 값이 들어오는 경우 
      -------------------------------------------------------------------------

      ELSIF UPPER(:NEW.MACHINE_STATUS_DIV) IN( 'STATE' , 'OPERATION' ) THEN
                    --------------------------------------
                    --설비마스터에 최종 동작모드 업데이트 
                    --------------------------------------
                        DEBUG_PHASE := 'UPDATE CONTROL STATE' ;
                        UPDATE ICOM_MACHINE_MASTER 
                           SET CONTROL_STATE = :NEW.MACHINE_STATUS_VALUE
                         WHERE MACHINE_CODE  = :NEW.MACHINE_CODE
                           AND CONTROL_STATE_TAG_ADDRESS = :NEW.TAG_ADDRESS 
                           AND NVL(CONTROL_STATE ,'0') <> :NEW.MACHINE_STATUS_VALUE --이전 상태와 다른경우만
                           ;         
                    --------------------------------------
                    --설비마스터에 최종 상태 업데이트 
                    --------------------------------------
                        DEBUG_PHASE := 'UPDATE EQP STATE' ;
                        UPDATE ICOM_MACHINE_MASTER
                           SET EQP_STATE    = :NEW.MACHINE_STATUS_VALUE
                         WHERE MACHINE_CODE = :NEW.MACHINE_CODE
                           AND EQP_STATE_TAG_ADDRESS = :NEW.TAG_ADDRESS 
                           AND NVL(EQP_STATE , '0') <> :NEW.MACHINE_STATUS_VALUE --이전 상태와 다른경우만
                           ;
                ----------------------------------------------------------------
                --설비정지시간 저장구현 로직 
                --TAG_VALUE --0:초기값--1:Idle--2:Run--3:Down(알람)--4:Skip(Pass)--5:Disconnect
                --ICOM_MACHINE_MASTER 설비관리 테이블 고정컬럼으로 
                --CONTROL_STATE_TAG_ADDRESS : 미리 TAG 주소 세팅해놓음
                --EQP_STATE_TAG_ADDRESS : 미리 TAG 주소 세팅해놓음
                --
                -- *네트워크 단절로 인한 시간은 다르면서 상태가 동일한 값이 계속 들어올 경우 방안 필요
                --
                ----------------------------------------------------------------

                      DEBUG_PHASE := 'INSERT EQP STATE' ;
                      IF :NEW.tag_type = 'ES' AND :NEW.MACHINE_STATUS_VALUE = '3' THEN --:NEW.MACHINE_STATUS_VALUE IN ( '0' , '1' , '2' , '3' , '4' , '5' ) THEN  

                         ------------------------------------------------
                         -- 동일한 값존재 여부 파악후 처리
                         -- 이미 동일한 값이 존재 하면 입력하지 않고 버림.
                         --
                         ------------------------------------------------
                         BEGIN
                                SELECT COUNT(*) 
                                  INTO LVI_EXISTS
                                  FROM icom_recieve_down_time_raw
                                 WHERE machine_code = :NEW.machine_code
                                   AND down_start_datetime = (  SELECT MAX(down_start_datetime) 
                                                                  FROM icom_recieve_down_time_raw 
                                                                 WHERE machine_code = :NEW.machine_code
                                                                   AND down_start_datetime <= CAST(:NEW.PLC_TIMESTAMP AS DATE)  --가장 최근 데이터만 업데이트
                                                                   AND tag_address  = :NEW.tag_address
                                                                   AND tag_value    = :NEW.MACHINE_STATUS_VALUE
                                                                   AND is_fixed = 'N'
                                                               )
                                   AND tag_address  = :NEW.tag_address
                                   AND tag_value    = :NEW.MACHINE_STATUS_VALUE 
                                   AND is_fixed = 'N' ;

                            EXCEPTION WHEN NO_DATA_FOUND THEN 
                                 LVI_EXISTS := 0 ;
                            END ;

                         ------------------------------------------------
                         --
                         ------------------------------------------------
                         IF    LVI_EXISTS > 0 THEN 
                              NULL;
                         ELSE

                                 INSERT INTO icom_recieve_down_time_raw (
                                        plc_code,machine_code,plc_datetime,tag_address,
                                        tag_value,down_start_datetime,down_end_datetime,
                                        down_time_term,comments,
                                        enter_date,enter_by,last_modify_date,last_modify_by,
                                        organization_id,is_fixed
                                    ) VALUES (
                                        :NEW.plc_code,:NEW.machine_code,:NEW.MACHINE_DATETIME,:NEW.tag_address,
                                        :NEW.MACHINE_STATUS_VALUE,
                                        CAST(:NEW.PLC_TIMESTAMP AS DATE) , --stop_start_datetime,
                                        NULL ,      --stop_end_datetime,
                                        0 ,         --stop_time_term,
                                        NULL ,      --comments,
                                        sysdate ,   --enter_date,
                                        'PLC RAW TRIGGER' , --enter_by,
                                        sysdate ,   --last_modify_date,
                                        'PLC RAW TRIGGER',  --last_modify_by,
                                        1, --organization_id
                                        'N' --is_fixed
                                    );
                            END IF ; --IF EXISTS

                        END IF ; --IF :NEW.tag_type = 'ES' AND :NEW.MACHINE_STATUS_VALUE IN ( '0' , '1' , '2' , '3' , '4' , '5' )

                        ------------------------------------------------------------------------
                        --가장 최근 DOWN 상태인 데이터에 정지시간 계산후 업데이트  
                        --:NEW.tag_value 값이 0, 1 , 2 면 설비가 동작된것으로 판단한다
                        ------------------------------------------------------------------------
                        IF :NEW.tag_type = 'ES' AND :NEW.MACHINE_STATUS_VALUE IN ( '0' , '1' , '2' )  THEN -- :NEW.MACHINE_STATUS_VALUE IN ( '0' , '1' , '2' , '3' , '4' , '5'  ) THEN
                           ---------------------------------------------------------------------
                           --만약 설비정지후 재가동이 되었을경우 데이터를 놓치면 
                           --정지상태로 남아있던 데이터가 존해하지만 , 그중 최근것만 시간을 계산해서 처리
                           --나머지 놓친 데이터는 계속 정지시작 시간만 가지고 있으므로 처리방안 마련
                           ---------------------------------------------------------------------
                                DEBUG_PHASE := 'UPDATE DOWN TIME' ;
                                UPDATE icom_recieve_down_time_raw 
                                   SET down_end_datetime = CAST(:NEW.PLC_TIMESTAMP AS DATE)  ,
                                       down_time_term    = round(( CAST(:NEW.PLC_TIMESTAMP AS DATE)  - down_start_datetime ) * 24* 60 , 3) , --분으로 처리 
                                       tag_value_last    = :NEW.MACHINE_STATUS_VALUE ,
                                       is_fixed = 'Y'
                                 WHERE machine_code = :NEW.machine_code
                                   AND down_start_datetime = ( SELECT MAX(down_start_datetime) 
                                                                 FROM icom_recieve_down_time_raw 
                                                                WHERE machine_code = :NEW.machine_code
                                                                   AND down_start_datetime <= CAST(:NEW.PLC_TIMESTAMP AS DATE)  --가장 최근 데이터만 업데이트
                                                                   AND tag_address  = :NEW.tag_address
                                                                   AND tag_value    <> :NEW.MACHINE_STATUS_VALUE 
                                                               )
                                   AND tag_address  = :NEW.tag_address
                                   AND tag_value    <> :NEW.MACHINE_STATUS_VALUE --EQP state down
                                   AND down_end_datetime IS NULL
                                   ;
                        END IF ;         

            END IF ;--IF ALARM

END IF ; --IF PLC

EXCEPTION WHEN OTHERS THEN 
     NULL ;

 -- 스카다에서 에러 발생시 데이터 누락되지 않도록 일단 널 처리     
 --  RAISE_APPLICATION_ERROR( -20002 , ' TRG_ICOM_RECIEVE_DATA_INS TRIGGER SQLCODE='||TO_CHAR(SQLCODE)||' DEBUG='||DEBUG_PHASE||' DATE='||:NEW.MACHINE_DATETIME||' TAG='||:NEW.tag_address||' VALUE='||:NEW.MACHINE_STATUS_VALUE ||' MACHINE='||:NEW.machine_code||' '||SQLERRM ) ;
END;

/
ALTER TRIGGER "INFINITY21_JSFMS"."TRG_ICOM_RECIEVE_DATA_INS" ENABLE;
--------------------------------------------------------
--  DDL for Trigger TRG_ICOM_RECIEVE_PLC_INS
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE TRIGGER "INFINITY21_JSFMS"."TRG_ICOM_RECIEVE_PLC_INS" 
  BEFORE INSERT ON ICOM_RECIEVE_PLC_RAW
  REFERENCING OLD AS OLD NEW AS NEW
  FOR EACH ROW
------------------------------------------------------
  --
  ------------------------------------------------------
DECLARE
  DEBUG_PHASE VARCHAR2(50);
  --pragma autonomous_transaction; --사용여부 나중에 판단
  lvs_tag_type varchar2(20);
BEGIN
  /*2022.10.07 추가 zKey*/
  begin
    select t.tag_type
      into lvs_tag_type
      from icom_plc_tag_master t
     where t.machine_code = :new.machine_code
       and t.tag_address = :new.tag_address;
  exception
    when others then
      lvs_tag_type := 'ERR';
  end;

  :new.tag_type_r := lvs_tag_type;
  /*2022.10.07 여기까지  zKey*/
  NULL;
  --    --------------------------------------
  --    --설비마스터에 최종 동작모드 업데이트 
  --    --------------------------------------
  --        DEBUG_PHASE := 'UPDATE CONTROL STATE' ;
  --        UPDATE ICOM_MACHINE_MASTER 
  --           SET CONTROL_STATE = :NEW.TAG_VALUE
  --         WHERE MACHINE_CODE  = :NEW.MACHINE_CODE
  --           AND CONTROL_STATE_TAG_ADDRESS = :NEW.TAG_ADDRESS 
  --           AND NVL(CONTROL_STATE ,'0') <> :NEW.TAG_VALUE --이전 상태와 다른경우만
  --           ;         
  --    --------------------------------------
  --    --설비마스터에 최종 상태 업데이트 
  --    --------------------------------------
  --        DEBUG_PHASE := 'UPDATE EQP STATE' ;
  --        UPDATE ICOM_MACHINE_MASTER
  --           SET EQP_STATE    = :NEW.TAG_VALUE
  --         WHERE MACHINE_CODE = :NEW.MACHINE_CODE
  --           AND EQP_STATE_TAG_ADDRESS = :NEW.TAG_ADDRESS 
  --           AND NVL(EQP_STATE , '0') <> :NEW.TAG_VALUE --이전 상태와 다른경우만
  --           ;
  ----------------------------------------------------------------------------
  ----설비정지시간 저장구현 로직 
  ----TAG_VALUE --0:초기값--1:Idle--2:Run--3:Down(알람)--4:Skip(Pass)--5:Disconnect
  ----ICOM_MACHINE_MASTER 설비관리 테이블 고정컬럼으로 
  ----CONTROL_STATE_TAG_ADDRESS : 미리 TAG 주소 세팅해놓음
  ----EQP_STATE_TAG_ADDRESS : 미리 TAG 주소 세팅해놓음
  ----해당주송
  ----------------------------------------------------------------------------
  --  
  --      DEBUG_PHASE := 'INSERT EQP STATE' ;
  --      IF :NEW.tag_type = 'ES' AND :NEW.tag_value IN ( '0' , '1' , '2' , '3' , '4' , '5' ) THEN  
  --         INSERT INTO icom_recieve_down_time_raw (
  --                plc_code,
  --                machine_code,
  --                plc_datetime,
  --                tag_address,
  --                tag_value,
  --                
  --                down_start_datetime,
  --                down_end_datetime,
  --                down_time_term,
  --                comments,
  --                enter_date,
  --                enter_by,
  --                last_modify_date,
  --                last_modify_by,
  --                organization_id,
  --                is_fixed
  --            ) VALUES (
  --                :NEW.plc_code,
  --                :NEW.machine_code,
  --                :NEW.plc_datetime,
  --                :NEW.tag_address,
  --                :NEW.tag_value,
  --                
  --                CAST(:NEW.PLC_TIMESTAMP AS DATE) ,  --                TO_DATE(substr(:NEW.plc_datetime,1,14)) , --stop_start_datetime,
  --                NULL ,      --stop_end_datetime,
  --                
  --                0 ,         --stop_time_term,
  --                NULL ,      --comments,
  --                sysdate ,   --enter_date,
  --                'PLC RAW TRIGGER' , --enter_by,
  --                sysdate ,   --last_modify_date,
  --                'PLC RAW TRIGGER',  --last_modify_by,
  --                1, --organization_id
  --                'N'
  --            );
  --        END IF ;
  --        
  --        ------------------------------------------------------------------------
  --        --가장 최근 DOWN 상태인 데이터에 정지시간 계산후 업데이트    (네트워크오류제외) 
  --        --:NEW.tag_value 값이 3 이 아니면 설비가 동작된것으로 판단한다
  --        ------------------------------------------------------------------------
  --        IF :NEW.tag_type = 'ES' AND :NEW.tag_value IN ( '0' , '1' , '2' , '4' ) THEN
  --        
  --           ---------------------------------------------------------------------
  --           --만약 설비정지후 재가동이 되었을경우 데이터를 놓치면 
  --           --정지상태로 남아있던 데이터가 존해하지만 , 그중 최근것만 시간을 계산해서 처리
  --           --나머지 놓친 데이터는 계속 정지시작 시간만 가지고 있으므로 처리방안 마련
  --           ---------------------------------------------------------------------
  --                DEBUG_PHASE := 'UPDATE DOWN TIME' ;
  --                UPDATE icom_recieve_down_time_raw 
  --                   SET down_end_datetime = CAST(:NEW.PLC_TIMESTAMP AS DATE)  ,
  --                       down_time_term    = round(( CAST(:NEW.PLC_TIMESTAMP AS DATE)  - down_start_datetime ) * 24* 60 , 3) ,
  --                       tag_value_last    = :NEW.tag_value ,
  --                       is_fixed = 'Y'
  --                   --   down_end_datetime = TO_DATE(substr(:NEW.plc_datetime,1,14)) ,
  --                   --   down_time_term    = ( TO_DATE(substr(:NEW.plc_datetime,1,14)) - down_start_datetime ) * 24* 60 
  --                 WHERE machine_code = :NEW.machine_code
  --                   AND tag_address  = :NEW.tag_address
  --                   AND tag_value    = '3' --EQP state down
  --                   AND down_start_datetime = ( SELECT MAX(down_start_datetime) 
  --                                                 FROM icom_recieve_down_time_raw 
  --                                                WHERE machine_code = :NEW.machine_code
  --                                                   AND tag_address  = :NEW.tag_address
  --                                                   AND tag_value    = '3' 
  --                                                   AND down_start_datetime <= CAST(:NEW.PLC_TIMESTAMP AS DATE)  --r가장 최근 데이터만 업데이트
  --                                               )
  --                   --AND down_start_datetime <= CAST(:NEW.PLC_TIMESTAMP AS DATE)  
  --                   AND down_end_datetime IS NULL
  --                   ;
  --        END IF ; 

EXCEPTION
  WHEN OTHERS THEN
    NULL;
    ps_job_errorlog(88,
                    1,
                    'TRG_ICOM_RECIEVE_PLC_INS',
                    'TRG_ICOM_RECIEVE_PLC_INS',
                    substr(SQLERRM, 1, 400),
                    'TRG');

  --RAISE_APPLICATION_ERROR( -20002 , ' TRG_ICOM_RECIEVE_PLC_INS TRIGGER SQLCODE='||TO_CHAR(SQLCODE)||' DEBUG='||DEBUG_PHASE||' DATE='||:NEW.plc_datetime||' TAG='||:NEW.tag_address||' VALUE='||:NEW.tag_value ||' MACHINE='||:NEW.machine_code||' '||SQLERRM ) ;
END;


/
ALTER TRIGGER "INFINITY21_JSFMS"."TRG_ICOM_RECIEVE_PLC_INS" ENABLE;
--------------------------------------------------------
--  DDL for Trigger TRG_XSCADA_DATATAG_LOG_INS
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE TRIGGER "INFINITY21_JSFMS"."TRG_XSCADA_DATATAG_LOG_INS" 
AFTER INSERT ON XSCADA_DATATAG_LOG 
REFERENCING OLD AS OLD NEW AS NEW 
FOR EACH ROW 

--------------------------------------------------------------------------------
-- 
-- 20220624 : 유혁수 생성 ( 스카다에서 입력시 속도저하 고려할것 )
-- 알람 및 상태 데이터가 스카다를 통해 입력됨
-- 본 트리거에서는 로그데어터 추출후 데이터 변환 및 DB 전송 ( 변환 작업만 진행 )
-- F_GET_ALARM_MSG_BY_ADDRESS(plc_code , machine_code , tag_address) : 리턴값 없을시 '*' 반환 (알람마스터에서 추출)
-- F_GET_MACHINE_CODE_BY_ADDRESS( plc_code , tag_address): 리턴값 없을시 '*' 반환 (태그마스터에서 추출)
--
-- REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 1 ) PLC
-- REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 2 ) ALARM
-- REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 3 ) MACHINE CODE
-- REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 4 ) TAG ADDRESS
-- 데이터 형식 . 로 구분 DATATAG_NAME : PLC02.Alarm.KRCWO12EMOM316.M801 
--------------------------------------------------------------------------------
DECLARE 

   LVS_RETURN VARCHAR2(10) ;   
   PHASE VARCHAR2(50) ;
   LVI_EXISTS NUMBER ;
   -- pragma autonomous_transaction; --사용여부 나중에 판단
BEGIN

 -------------------------------------------------------------------------------
 -- 태그가 수정되어 있지 않아서 임시로 처리  2개짜리 태그값으로 올라온경우 
 -- BIT 데이터의 경우 불완전한 상태로 올라옴 (개선필요)
 -- 데이터 형식 : PLC02.KRCWO12EMOM316 ,  PLC02.KRCWO12EMOM316_E (자이솜 개선필요) 
 -------------------------------------------------------------------------------
   IF REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 3 ) = '' OR REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 3 ) IS NULL THEN 
              PHASE := 'OPERATION INSERT 2 TAG' ;    
                     -- PLC bit 발생 데이터만 입력
                     INSERT INTO icom_recieve_bit_raw (
                        plc_code ,
                        machine_code, --설비코드
                        tag_address,
                        tag_value,
                        machine_datetime, --알람발생시간 문자형식
                        plc_timestamp ,
                        comments, --설명
                        enter_date, --생성일자 SYSDATE
                        enter_by, --스카다 ID 번호남김
                        organization_id --조직 무조건 1
                    )
                    SELECT  
                           REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 1 ) ,
                           REPLACE( UPPER(REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 2 )) , '-E' , '')  AS machine_code ,
                           UPPER(REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 2 ))  AS machine_status_div, --Alram / Operation
                           DECODE( SUBSTR( UPPER(REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 2 )) , -2 , 2 )   , '_E' , 1 , 2 ) AS machine_status_value  , --1 이 알람발생 2 가 해제 Off 를 2 로 변경
                           TO_CHAR(CAST(:NEW.CTIME AS DATE) , 'YYYYMMDDHH24MISS' ),
                           systimestamp ,
                           '' AS comments,
                           SYSDATE ,
                           :NEW.ID||'-TRIGGER',
                           1
                    FROM   DUAL ; 
--   -----------------------------------------------------------------------------    
--   -- 태그가 수정되어 있지 않아서 임시로 처리  
--   -- 3개짜리 태그값(설비코드가 제외된) 으로 올라온경우 ( 개발초기 임시로 사용함 ) 혹시몰라서 남겨둠 
--   -- 정상적인 태그는 4 개짜리
--   -----------------------------------------------------------------------------
--   ELSIF REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 4 ) = '' OR REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 4 ) IS NULL THEN 
--         PHASE := 'OPERATION INSERT 3 TAG' ;
--         
--         --알람 발생 
--         IF UPPER(REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 2 )) ='ALARM' AND UPPER(:NEW.VALUE_STR) = 'ON' THEN 
--
--                     INSERT INTO icom_recieve_data_raw (
--                        machine_div, --영역구분
--                        machine_code, --설비코드
--                        machine_status_div, --ALARM / OPERATION 구분
--                        machine_status_value, --상태값
--                        machine_message, --알람메시지: 스카다가 제공못하므로 디비에서 추출
--                        machine_datetime, --알람발생시간 문자형식 
--                        comments, --설명
--                        enter_date, --생성일자 SYSDATE
--                        enter_by, --스카다 ID 번호남김
--                        organization_id, --조직 무조건 1
--                        plc_code,    --대상 PLC번호
--                        tag_address, --TAG ADDRESS 를 알람코드로 사용
--                        ALARM_START_DATETIME, --알람발생시간 DATETIME 형식
--                        ALARM_END_DATETIME ,  --PLC EQP STATE 가 RUN 으로 바뀌면 모든 알람해제 일자업데이트
--                        ALARM_TIME_TERM       --PLC EQP STATE 가 RUN 으로 바뀌면 알람발생-종료 시간 업데이트
--                    )
--                    
--                    SELECT  
--                           'PLC' , --고정문자 
--                           --REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 3 ) , --machine code 설비코드
--                           F_GET_MACHINE_CODE_BY_ADDRESS( REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 1 )  , REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 3 ) ) AS machine_code ,
--                           UPPER(REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 2 ))  AS machine_status_div, --Alram / Operation
--                           DECODE( UPPER(:NEW.VALUE_STR) , 'OFF' , 2 , 1 ) AS machine_status_value  , --1 이 알람발생 2 가 해제 Off 를 2 로 변경
--                           F_GET_ALARM_MSG_BY_ADDRESS(REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 1 ) , '%' , REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 3 ) ) AS machine_message ,
--                           TO_CHAR(CAST(:NEW.CTIME AS DATE) , 'YYYYMMDDHH24MISS' ),
--                           '' AS comments,
--                           SYSDATE ,
--                           :NEW.ID||'-TRIGGER',
--                           1,
--                           REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 1 ) ,
--                           REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 3 ) ,
--                           CAST(:NEW.CTIME AS DATE) ,
--                           DECODE( UPPER(:NEW.VALUE_STR) , 'OFF' , CAST(:NEW.CTIME AS DATE) , NULL ) ,
--                           0
--                    FROM   DUAL ;
--            --------------------------------------------------------------------        
--            --알람 OFF 태그는 저장하지 않고 상태만 바꿈
--            --------------------------------------------------------------------
--            ELSIF UPPER(REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 2 )) ='ALARM' AND UPPER(:NEW.VALUE_STR) = 'OFF' THEN
--               -------------------------------------------------
--               --알람 해제가 들어오면 이전 알람에 시간을 업데이트 한다
--               -------------------------------------------------
--                UPDATE icom_recieve_data_raw 
--                   SET ALARM_END_DATETIME    = CAST(:NEW.CTIME AS DATE) , --알람 해제시간 
--                       ALARM_TIME_TERM       = (CAST(:NEW.CTIME AS DATE) - ALARM_START_DATETIME ) * 24 * 60 * 60--발생경과시간 초단위
--                 WHERE MACHINE_DIV           = 'PLC'
--                   AND MACHINE_CODE          =  F_GET_MACHINE_CODE_BY_ADDRESS( REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 1 )  , REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 3 ) ) --REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 3 ) --설비코드 
--                   AND MACHINE_STATUS_DIV    = UPPER(REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 2 )) --ALARM
--                   AND TAG_ADDRESS           = REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 3 ) --TAG ADDRESS
--                   AND ALARM_START_DATETIME <= CAST(:NEW.CTIME AS DATE) --알람발생시작시간 
--                   AND MACHINE_STATUS_VALUE  = '1' --알람 발생후 해제 안된거
--                   ;           
--            --기타 상황 일단 고려 안함 로그 남길지 말지.         
--            ELSIF UPPER(REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 2 )) ='OPERATION' THEN
--                  NULL ;
--            END IF ;
   -----------------------------------------------------------------------------
   -- 4개짜리 태그 정상적인 상황
   -- 문제점 : 네트워크가 단절되었다가 다시 붙으면 스카다가 무조건 최종 상태값을 다시 보내고 있음
   -- 알람이 발생하지 않았어도 OFF 상태의 값을 다시보내옴( 상태가 변하지 않았는데 필요없는 데이터)
   -- 마지각 알람 상태가 OFF 인데 OFF 가올라왔는지 체크해서 버리는 작업을 해야함(불필요한 사족)
   -- 알람과 동작상태 동작모드 가 같이 올라옴 태그 두번째 항목으로 판단 ALARM , OPERATION 
   -----------------------------------------------------------------------------
   ELSE
          --알람 인경우 
          PHASE := 'OPERATION INSERT 4 TAG' ;
          IF UPPER(REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 2 )) ='ALARM'
             AND UPPER(:NEW.VALUE_STR) IN( 'ON' , '1' )  THEN 

                     ----------------------------------------------------------
                     --해당태그의 마지막 상태값과 동일하면 
                     --등록하지 않고 버린다.(네트워크오류로 인한 중복 발송으로 간주함)
                     --이미 발생되어 있으면서 해결안된 알람이 있는지 체크해서 중복
                     --으로 알람건수로 세지 않도록함
                     ----------------------------------------------------------
                     BEGIN 
                         SELECT 1
                           INTO LVI_EXISTS
                           FROM icom_recieve_data_raw
                          WHERE MACHINE_DIV = 'PLC'
                            AND MACHINE_CODE = REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 3 ) 
                            AND TAG_ADDRESS = REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 4 )
                            AND MACHINE_STATUS_VALUE = 1
                            AND MACHINE_DATETIME = (
                                                        SELECT MAX(MACHINE_DATETIME) FROM icom_recieve_data_raw
                                                         WHERE MACHINE_DIV = 'PLC'
                                                           AND MACHINE_CODE = REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 3 ) 
                                                           AND TAG_ADDRESS = REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 4 )
                                                           AND MACHINE_STATUS_VALUE = 1
                                                           AND MACHINE_DATETIME <= TO_CHAR(CAST(:NEW.CTIME AS DATE) , 'YYYYMMDDHH24MISS' )
                                                           AND IS_FIXED = 'N'
                                                    )  
                            AND IS_FIXED = 'N'
                            ;
                     EXCEPTION WHEN NO_DATA_FOUND THEN 
                           LVI_EXISTS := 0 ;
                     END ;

                     IF LVI_EXISTS > 0 THEN 
                         NULL ;
                     ELSE
                                     -- PLC 알람이 발생
                                     INSERT INTO icom_recieve_data_raw (
                                        machine_div, --영역구분
                                        machine_code, --설비코드
                                        machine_status_div, --ALARM / OPERATION 구분
                                        machine_status_value, --상태값
                                        machine_message, --알람메시지: 스카다가 제공못하므로 디비에서 추출
                                        machine_datetime, --알람발생시간 문자형식 
                                        comments, --설명
                                        enter_date, --생성일자 SYSDATE
                                        enter_by, --스카다 ID 번호남김
                                        organization_id, --조직 무조건 1
                                        plc_code,    --대상 PLC번호
                                        tag_address, --TAG ADDRESS 를 알람코드로 사용
                                        ALARM_START_DATETIME, --알람발생시간 DATETIME 형식
                                        ALARM_END_DATETIME ,  --PLC EQP STATE 가 RUN 으로 바뀌면 모든 알람해제 일자업데이트
                                        ALARM_TIME_TERM,       --PLC EQP STATE 가 RUN 으로 바뀌면 알람발생-종료 시간 업데이트
                                        TAG_TYPE ,
                                        PLC_TIMESTAMP ,
                                        IS_FIXED,
                                        SCADA_ID,
                                        EQP_STATE ,
                                        CONTROL_STATE
                                    )
                                    SELECT  
                                           'PLC' , --고정문자 
                                           REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 3 ) , --machine code 설비코드
                                           --F_GET_MACHINE_CODE_BY_ADDRESS( REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 1 )  , REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 4 ) ) AS machine_code ,
                                           UPPER(REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 2 ))  AS machine_status_div, --Alram / Operation
                                           DECODE( UPPER(:NEW.VALUE_STR) , 'OFF' , 2 , '0' , 2 ,  1 ) AS machine_status_value  , --1 이 알람발생 2 가 해제 Off 를 2 로 변경
                                           F_GET_ALARM_MSG_BY_ADDRESS(REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 1 ) , '%' , REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 4 ) ) AS machine_message ,
                                           TO_CHAR(CAST(:NEW.CTIME AS DATE) , 'YYYYMMDDHH24MISS' ),
                                           :NEW.DATATAG_NAME AS comments,
                                           SYSDATE ,
                                           'TRIGGER',
                                           1,
                                           REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 1 ) ,
                                           REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 4 ) ,
                                           CAST(:NEW.CTIME AS DATE),
                                           DECODE( UPPER(:NEW.VALUE_STR) , 'OFF' , CAST(:NEW.CTIME AS DATE) , '0' , CAST(:NEW.CTIME AS DATE) , NULL ) ,
                                           0 ,
                                           NULL ,
                                           :NEW.CTIME ,
                                           'N', --알람데이터는 미해결된 상태로 처리 
                                           :NEW.ID,
                                           EQP_STATE ,
                                           CONTROL_STATE
                                    FROM ICOM_MACHINE_MASTER 
                                   WHERE MACHINE_CODE = REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 3 ) ;
                      END IF ; -- LVI_EXISTS        
            --------------------------------------------------------------------        
            --알람 OFF 태그는 저장하지 않고 상태만 바꿈
            --알람 ON 없이 OFF 가 발생 하지 않고 , OFF 만 발생하더라도 알람 건수와
            --알람 발생건수로 간주 하지 않음
            --네트워크 단절로 인한 스카다 최신 상태값 스캔 로직에 의해 OFF 데이터가 한꺼번에 들어올수 있음 
            --------------------------------------------------------------------
         ELSIF UPPER(REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 2 )) ='ALARM' AND UPPER(:NEW.VALUE_STR) IN ( 'OFF' , '0') THEN 
               -------------------------------------------------
               --알람 해제가 들어오면 이전 알람에 시간을 업데이트 한다
               --알람이 해제되었지만 MACHINE_STATUS_DIV 는 1 로 남겨둔다
               --알람발생 조회에서 알람발생 구분조건으로 1 을 사용
               -------------------------------------------------
                UPDATE icom_recieve_data_raw 
                   SET ALARM_END_DATETIME    = CAST(:NEW.CTIME AS DATE) , --알람 해제시간 
                       ALARM_TIME_TERM       = (CAST(:NEW.CTIME AS DATE) - ALARM_START_DATETIME ) * 24 * 60 ,  --발생경과시간 분단위
                       COMMENTS = :NEW.DATATAG_NAME ,
                       IS_FIXED = 'Y' 
                 WHERE MACHINE_DIV           = 'PLC'
                   AND MACHINE_CODE          = REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 3 ) --설비코드 
                   AND MACHINE_STATUS_DIV    = UPPER(REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 2 )) --ALARM
                   AND TAG_ADDRESS           = REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 4 ) --TAG ADDRESS
                   AND ALARM_START_DATETIME <= CAST(:NEW.CTIME AS DATE) --알람발생시작시간 
                   AND MACHINE_STATUS_VALUE  = '1' --알람 발생후 해제 안된거
                   AND IS_FIXED = 'N'
                   ;           
         -----------------------------------------------------------------------          
         --동작 데이터가 들어온 경우           
        -- 0,1,2,3,4,5 가 들어옴 0=초기화,1=IDLE,2= RUN,3=DOWN,4=SKIP,5=DISCONNECT
         -----------------------------------------------------------------------
         ELSIF UPPER(REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 2 )) IN( 'STATE' , 'OPERATION' , 'ROBOT' ) THEN 

                     -- PLC 알람 발생 데이터만 입력
                     INSERT INTO icom_recieve_data_raw (
                        machine_div, --영역구분
                        machine_code, --설비코드
                        machine_status_div, --ALARM / OPERATION 구분
                        machine_status_value, --상태값
                        machine_message, --알람메시지: 스카다가 제공못하므로 디비에서 추출
                        machine_datetime, --알람발생시간 문자형식 
                        comments, --설명
                        enter_date, --생성일자 SYSDATE
                        enter_by, --스카다 ID 번호남김
                        organization_id, --조직 무조건 1
                        plc_code,    --대상 PLC번호
                        tag_address, --TAG ADDRESS 를 알람코드로 사용
                        ALARM_START_DATETIME, --알람발생시간 DATETIME 형식
                        ALARM_END_DATETIME ,  --PLC EQP STATE 가 RUN 으로 바뀌면 모든 알람해제 일자업데이트
                        ALARM_TIME_TERM ,     --PLC EQP STATE 가 RUN 으로 바뀌면 알람발생-종료 시간 업데이트
                        TAG_TYPE ,
                        PLC_TIMESTAMP,
                        IS_FIXED,
                        SCADA_ID,
                        EQP_STATE ,
                        CONTROL_STATE
                    )
                    SELECT  
                           'PLC' , --고정문자 
                           REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 3 ) , --machine code 설비코드
                           --F_GET_MACHINE_CODE_BY_ADDRESS( REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 1 )  , REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 4 ) ) AS machine_code ,
                           UPPER(REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 2 ))  AS machine_status_div, --Alram / Operation
                           UPPER(:NEW.VALUE_STR) AS machine_status_value  , --1 이 알람발생 2 가 해제 Off 를 2 로 변경
                           F_GET_ALARM_MSG_BY_ADDRESS(REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 1 ) , '%' , REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 4 ) ) AS machine_message ,
                           TO_CHAR(CAST(:NEW.CTIME AS DATE) , 'YYYYMMDDHH24MISS' ), --문자열 형식 날짜로 보관
                           :NEW.DATATAG_NAME AS comments, --스카다 데이터 보관
                           SYSDATE ,
                           :NEW.ID||'-TRIGGER', --스카다 ID 키값 사용
                           1,
                           REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 1 ) , --PLC 
                           REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 4 ) , --TAG ADDRESS
                           NULL ,  --알람이 아니므로 널 처리
                           NULL ,  --알람이 아니므로 널 처리 
                           0 ,     --ALARM_TIME_TERM
                           DECODE( EQP_STATE_TAG_ADDRESS , REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 4 )  , 'ES' , NULL ) ,--설비상태 주소와 동일할 경우 다음트리거에서 설비정지 테이블로 데이터 저장 
                           :NEW.CTIME ,
                           'Y' , --동작데이터는 발샐즉시 해결된 상태로 처리 
                           :NEW.ID,
                           EQP_STATE ,
                           CONTROL_STATE
                    FROM   ICOM_MACHINE_MASTER 
                   WHERE MACHINE_CODE = REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 3 ) ;        

--        -----------------------------------------------------------------------   
--        -- 스카다 개선전 임시로 적용
--        --동작 데이터가 들어온 경우           
--        -- 0,1,2,3,4,5 가 들어옴 0=초기화,1=IDLE,2= RUN,3=DOWN,4=SKIP,5=DISCONNECT
--         -----------------------------------------------------------------------
--         ELSIF UPPER(REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 2 )) ='ALARM' 
--         AND UPPER(:NEW.VALUE_STR) IN ( '0','1', '2' ,'3' , '4','5' ) 
--         AND REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 4 ) LIKE 'W0_0_' THEN 
--     
--                      -- PLC 알람 발생 데이터만 입력
--                     INSERT INTO icom_recieve_data_raw (
--                        machine_div, --영역구분
--                        machine_code, --설비코드
--                        machine_status_div, --ALARM / OPERATION 구분
--                        machine_status_value, --상태값
--                        machine_message, --알람메시지: 스카다가 제공못하므로 디비에서 추출
--                        machine_datetime, --알람발생시간 문자형식 
--                        comments, --설명
--                        enter_date, --생성일자 SYSDATE
--                        enter_by, --스카다 ID 번호남김
--                        organization_id, --조직 무조건 1
--                        plc_code,    --대상 PLC번호
--                        tag_address, --TAG ADDRESS 를 알람코드로 사용
--                        ALARM_START_DATETIME, --알람발생시간 DATETIME 형식
--                        ALARM_END_DATETIME ,  --PLC EQP STATE 가 RUN 으로 바뀌면 모든 알람해제 일자업데이트
--                        ALARM_TIME_TERM ,     --PLC EQP STATE 가 RUN 으로 바뀌면 알람발생-종료 시간 업데이트
--                        TAG_TYPE ,
--                        PLC_TIMESTAMP,
--                        IS_FIXED
--                    )
--                    SELECT  
--                           'PLC' , --고정문자 
--                           REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 3 ) , --machine code 설비코드
--                           --F_GET_MACHINE_CODE_BY_ADDRESS( REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 1 )  , REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 4 ) ) AS machine_code ,
--                           'STATE' ,--UPPER(REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 2 ))  AS machine_status_div, --Alram / Operation
--                           UPPER(:NEW.VALUE_STR) AS machine_status_value  , --1 이 알람발생 2 가 해제 Off 를 2 로 변경
--                           F_GET_ALARM_MSG_BY_ADDRESS(REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 1 ) , '%' , REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 4 ) ) AS machine_message ,
--                           TO_CHAR(CAST(:NEW.CTIME AS DATE) , 'YYYYMMDDHH24MISS' ), --문자열 형식 날짜로 보관
--                           :NEW.DATATAG_NAME AS comments, --스카다 데이터 보관
--                           SYSDATE ,
--                           :NEW.ID||'-TRIGGER', --스카다 ID 키값 사용
--                           1,
--                           REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 1 ) , --PLC 
--                           REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 4 ) , --TAG ADDRESS
--                           NULL ,  --알람이 아니므로 널 처리
--                           NULL ,  --알람이 아니므로 널 처리 
--                           0 ,     --ALARM_TIME_TERM
--                           DECODE( EQP_STATE_TAG_ADDRESS , REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 4 )  , 'ES' , NULL ) ,--설비상태 주소와 동일할 경우 다음트리거에서 설비정지 테이블로 데이터 저장 
--                           :NEW.CTIME ,
--                           'Y'--동작데이터는 발샐즉시 해결된 상태로 처리 
--                    FROM   ICOM_MACHINE_MASTER 
--                   WHERE MACHINE_CODE = REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 3 ) ;                     
--                   
--                   
            END IF ;
    END IF ;
--------------------------------------------------------------------------------
-- 설비 마스터에 마지막상태 저장 
-- 데드락을 일으켜서 막음 YHS 20221019
--------------------------------------------------------------------------------
--IF UPPER(REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 2 )) ='ALARM' THEN  
--
--    UPDATE ICOM_MACHINE_MASTER 
--    SET LAST_ALARM_DATETIME = CAST(:NEW.CTIME AS DATE) , LAST_ALARM_TAG_ADDRESS = REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 4 )
--    WHERE MACHINE_CODE =  REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 3 ) ;
--    
--ELSIF UPPER(REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 2 )) ='STATE' THEN
--
--    UPDATE ICOM_MACHINE_MASTER 
--    SET LAST_STATE_DATETIME = CAST(:NEW.CTIME AS DATE) , LAST_ALARM_TAG_ADDRESS = REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 4 )
--    WHERE MACHINE_CODE =  REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 3 ) ;
--    
--ELSIF UPPER(REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 2 )) ='OPERATION' THEN
--
--    UPDATE ICOM_MACHINE_MASTER 
--    SET LAST_OPERATION_DATETIME = CAST(:NEW.CTIME AS DATE) , LAST_ALARM_TAG_ADDRESS = REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 4 )
--    WHERE MACHINE_CODE =  REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 3 ) ;
--END IF ;

EXCEPTION WHEN OTHERS THEN 
      ps_job_errorlog(77,1,'TRG_XSCADA_DATATAG_LOG_INS','TRG_XSCADA_DATATAG_LOG_INS',substr(SQLERRM,1,400),'TRG') ; 
      NULL;
     --RAISE_APPLICATION_ERROR( -20001 , 'TRG_XSCADA_DATATAG_LOG_INS TRIGGER ERROR PHASE='||PHASE||' DATA='||:NEW.DATATAG_NAME||' '||SQLERRM );
END;

/
ALTER TRIGGER "INFINITY21_JSFMS"."TRG_XSCADA_DATATAG_LOG_INS" ENABLE;
--------------------------------------------------------
--  DDL for Trigger TRG_XSCADA_OPERATION_INS
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE TRIGGER "INFINITY21_JSFMS"."TRG_XSCADA_OPERATION_INS" 
AFTER INSERT ON XSCADA_OPERATION 
REFERENCING OLD AS OLD NEW AS NEW 
FOR EACH ROW 

-------------------------------------------------------------------
-- 20220624 : 유혁수 생성 ( 스카다에서 입력시 속도저하 고려할것 )
-- 로그추출후 데이터 변환전송 ( 변환 작업만 진행 )
-- F_GET_ALARM_MSG_BY_ADDRESS() : 리턴값 없을시 '*' 반환 (알람마스터에서 추출)
-- F_GET_MACHINE_CODE_BY_ADDRESS: 리턴값 없을시 '*' 반환 (태그마스터에서 추출)
--
-- REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 1 ) PLC
-- REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 2 ) ALARM
-- REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 3 ) MACHINE CODE
-- REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 4 ) TAG ADDRESS
-- NAME DATA 형식 PLC01.Operation.KRCWO12ELOA101.W0100
--
-- 설비관리 테이블에 EQP_STATE_TAG_ADDRESS 선행등록필수
-------------------------------------------------------------------
DECLARE 
      LVS_RETURN VARCHAR2(10) ; --미사용
    --  pragma autonomous_transaction; --사용여부 나중에 판단
BEGIN
            ------------------------------------------------------------
            --PLC 동작 데이터만 입력
            --icom_recieve_plc_raw 테이블에서 트리거 또 있음.
            ------------------------------------------------------------
            INSERT INTO icom_recieve_plc_raw (
                    plc_code,     --PLC 코드
                    machine_code, --설비코드
                    plc_datetime, --발생일자
                    tag_address,  --태그주소
                    tag_value,    --태그값( 숫자와 문자가 혼합)
                    tag_data_type,--데이터 타입 
                    comments,     --주석
                    enter_date,   --등록일자(DB기준)
                    enter_by,     --등록자
                    organization_id, --조직 무조건 1
                    tag_type,     --알람,소모품실적,이상감지,작동모드,소모품목표,설비상태,검사인자,생산수량,생산정보,진입/배출,(안착/완료)
                    plc_timestamp --timestamp 형식 일자 
                ) 

                SELECT 
                        REGEXP_SUBSTR( :NEW.NAME  , '[^.]+' , 1 , 1 ) ,  --    plc_code
                        REGEXP_SUBSTR( :NEW.NAME  , '[^.]+' , 1 , 3 )  , --   설비코드  F_GET_MACHINE_CODE_BY_ADDRESS( REGEXP_SUBSTR( :NEW.NAME  , '[^.]+' , 1 , 1 )  , REGEXP_SUBSTR( :NEW.NAME  , '[^.]+' , 1 , 4 ) ), --machine_code,
                        TO_CHAR(:NEW.TIME , 'YYYYMMDDHH24MISSFF' ),     --plc_datetime
                        REGEXP_SUBSTR( :NEW.NAME  , '[^.]+' , 1 , 4 ) , --tag_address
                        :NEW.VALUE , --tag_value ( 스케일 고려여부 나중에 반영 )
                        'W',--:NEW.DATATAG_TYPE WORD 형태 데이터 주소
                        '', --COMMNETS
                        SYSDATE , --enter_date
                        'OPERATION TRIGGER', --enter_by
                        1 ,--organization_id  
                        DECODE( EQP_STATE_TAG_ADDRESS , REGEXP_SUBSTR( :NEW.NAME  , '[^.]+' , 1 , 4 )  , 'ES' , NULL ), --설비상태 주소와 동일할 경우 다음트리거에서 설비정지 테이블로 데이터 저장 
                        :NEW.TIME
                FROM ICOM_MACHINE_MASTER
               WHERE MACHINE_CODE = REGEXP_SUBSTR( :NEW.NAME  , '[^.]+' , 1 , 3 ) ;

--------------------------------------------------------------------------------
-- 설비 마스터에 마지막상태 저장 
-- 
--------------------------------------------------------------------------------
IF UPPER(REGEXP_SUBSTR( :NEW.NAME  , '[^.]+' , 1 , 2 )) ='ALARM' THEN  

    UPDATE ICOM_MACHINE_MASTER 
    SET LAST_ALARM_DATETIME = CAST(:NEW.TIME AS DATE) , LAST_ALARM_TAG_ADDRESS = REGEXP_SUBSTR( :NEW.NAME  , '[^.]+' , 1 , 4 )
    WHERE MACHINE_CODE =  REGEXP_SUBSTR( :NEW.NAME  , '[^.]+' , 1 , 3 ) ;

ELSIF UPPER(REGEXP_SUBSTR( :NEW.NAME  , '[^.]+' , 1 , 2 )) ='STATE' THEN

    UPDATE ICOM_MACHINE_MASTER 
    SET LAST_STATE_DATETIME = CAST(:NEW.TIME AS DATE) , LAST_ALARM_TAG_ADDRESS = REGEXP_SUBSTR( :NEW.NAME  , '[^.]+' , 1 , 4 )
    WHERE MACHINE_CODE =  REGEXP_SUBSTR( :NEW.NAME  , '[^.]+' , 1 , 3 ) ;

ELSIF UPPER(REGEXP_SUBSTR( :NEW.NAME  , '[^.]+' , 1 , 2 )) ='OPERATION' THEN

    UPDATE ICOM_MACHINE_MASTER 
    SET LAST_OPERATION_DATETIME = CAST(:NEW.TIME AS DATE) , LAST_ALARM_TAG_ADDRESS = REGEXP_SUBSTR( :NEW.NAME  , '[^.]+' , 1 , 4 )
    WHERE MACHINE_CODE =  REGEXP_SUBSTR( :NEW.NAME  , '[^.]+' , 1 , 3 ) ;
END IF ;

EXCEPTION WHEN OTHERS THEN 
     ps_job_errorlog(99,1,'TRG_XSCADA_OPERATION_INS','TRG_XSCADA_OPERATION_INS',substr(SQLERRM,1,400),'TRG') ; 

     RAISE_APPLICATION_ERROR( -20001 , 'TRIGGER ERROR=>'||SQLERRM );
     ROLLBACK;
END;


/
ALTER TRIGGER "INFINITY21_JSFMS"."TRG_XSCADA_OPERATION_INS" ENABLE;
--------------------------------------------------------
--  DDL for Trigger TRG_ICOM_RECIEVE_DATA_INS
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE TRIGGER "INFINITY21_JSFMS"."TRG_ICOM_RECIEVE_DATA_INS" 
AFTER INSERT ON ICOM_RECIEVE_DATA_RAW 
REFERENCING OLD AS OLD NEW AS NEW 
FOR EACH ROW 

DECLARE 

DEBUG_PHASE VARCHAR2(100);
LVI_EXISTS NUMBER ;

BEGIN

--------------------------------------------------
-- PLC 를 통해서 들어온건지 P_SET_RECIEVE_DATA_RAW API 를 통해 들어온건지 판단  
--------------------------------------------------
IF :NEW.MACHINE_DIV = 'PLC' THEN 

      --------------------------------------------------
      --알람이 들어오면 설비마스터에 상태만 변경
      --조업이 종료 되는경우 PLC03 W0105 가 ON(1) 되면 다운 타임 종료 
      --PLC03 에서 강제로 W0105 로 지정됨 
      --------------------------------------------------

      IF UPPER(:NEW.MACHINE_STATUS_DIV) = 'ALARM' THEN

           IF :NEW.TAG_ADDRESS = 'W0105' AND  :NEW.MACHINE_STATUS_VALUE = '1' THEN 

                DEBUG_PHASE := 'UPDATE DOWN TIME BY ALARM' ;
                UPDATE icom_recieve_down_time_raw 
                   SET down_end_datetime = CAST(:NEW.PLC_TIMESTAMP AS DATE)  ,
                       down_time_term    = round(( CAST(:NEW.PLC_TIMESTAMP AS DATE)  - down_start_datetime ) * 24* 60 , 3) , --분으로 처리 
                       tag_value_last    = :NEW.MACHINE_STATUS_VALUE ,
                       is_fixed = 'Y'
                 WHERE machine_code = :NEW.machine_code
--                   AND down_start_datetime = ( SELECT MAX(down_start_datetime) 
--                                                 FROM icom_recieve_down_time_raw 
--                                                WHERE machine_code = :NEW.machine_code
--                                                   AND down_start_datetime <= CAST(:NEW.PLC_TIMESTAMP AS DATE)  --가장 최근 데이터만 업데이트
--                                                   AND tag_address  = :NEW.tag_address
--                                                   AND tag_value    <> :NEW.MACHINE_STATUS_VALUE 
--                                               )
--                   AND tag_address  = :NEW.tag_address
--                   AND tag_value    <> :NEW.MACHINE_STATUS_VALUE --EQP state down
                   AND down_end_datetime IS NULL
                   ;         

           ELSE
              NULL;
           END IF ; 
           --PLC 발생 마지막 알람을 저장한다
           UPDATE ICOM_MACHINE_MASTER 
              SET LAST_ALARM_TAG_ADDRESS = :NEW.TAG_ADDRESS ,
                  LAST_ALARM_DATETIME    = CAST(:NEW.PLC_TIMESTAMP AS DATE)
            WHERE MACHINE_CODE = :NEW.MACHINE_CODE ;
       --------------------------------------------------------
       ELSIF UPPER(:NEW.MACHINE_STATUS_DIV) = 'ROBOT' THEN
           --PLC 발생 마지막 알람을 저장한다
             NULL ;
      -------------------------------------------------------------------------
      -- 설비동작상태중에 상태변화에 대한 값은 알람 테이블에 저장한다( 변화값 감지후저장방식)
      -- 일반적인 상태값은 ICOM_RECIEVE_PLC_RAW 테이블에 저장 (비트태그 감지후 저장방식)
      -- 설비 동작상태 값이 들어오는 경우 
      -------------------------------------------------------------------------

      ELSIF UPPER(:NEW.MACHINE_STATUS_DIV) IN( 'STATE' , 'OPERATION' ) THEN
                    --------------------------------------
                    --설비마스터에 최종 동작모드 업데이트 
                    --------------------------------------
                        DEBUG_PHASE := 'UPDATE CONTROL STATE' ;
                        UPDATE ICOM_MACHINE_MASTER 
                           SET CONTROL_STATE = :NEW.MACHINE_STATUS_VALUE
                         WHERE MACHINE_CODE  = :NEW.MACHINE_CODE
                           AND CONTROL_STATE_TAG_ADDRESS = :NEW.TAG_ADDRESS 
                           AND NVL(CONTROL_STATE ,'0') <> :NEW.MACHINE_STATUS_VALUE --이전 상태와 다른경우만
                           ;         
                    --------------------------------------
                    --설비마스터에 최종 상태 업데이트 
                    --------------------------------------
                        DEBUG_PHASE := 'UPDATE EQP STATE' ;
                        UPDATE ICOM_MACHINE_MASTER
                           SET EQP_STATE    = :NEW.MACHINE_STATUS_VALUE
                         WHERE MACHINE_CODE = :NEW.MACHINE_CODE
                           AND EQP_STATE_TAG_ADDRESS = :NEW.TAG_ADDRESS 
                           AND NVL(EQP_STATE , '0') <> :NEW.MACHINE_STATUS_VALUE --이전 상태와 다른경우만
                           ;
                ----------------------------------------------------------------
                --설비정지시간 저장구현 로직 
                --TAG_VALUE --0:초기값--1:Idle--2:Run--3:Down(알람)--4:Skip(Pass)--5:Disconnect
                --ICOM_MACHINE_MASTER 설비관리 테이블 고정컬럼으로 
                --CONTROL_STATE_TAG_ADDRESS : 미리 TAG 주소 세팅해놓음
                --EQP_STATE_TAG_ADDRESS : 미리 TAG 주소 세팅해놓음
                --
                -- *네트워크 단절로 인한 시간은 다르면서 상태가 동일한 값이 계속 들어올 경우 방안 필요
                --
                ----------------------------------------------------------------

                      DEBUG_PHASE := 'INSERT EQP STATE' ;
                      IF :NEW.tag_type = 'ES' AND :NEW.MACHINE_STATUS_VALUE = '3' THEN --:NEW.MACHINE_STATUS_VALUE IN ( '0' , '1' , '2' , '3' , '4' , '5' ) THEN  

                         ------------------------------------------------
                         -- 동일한 값존재 여부 파악후 처리
                         -- 이미 동일한 값이 존재 하면 입력하지 않고 버림.
                         --
                         ------------------------------------------------
                         BEGIN
                                SELECT COUNT(*) 
                                  INTO LVI_EXISTS
                                  FROM icom_recieve_down_time_raw
                                 WHERE machine_code = :NEW.machine_code
                                   AND down_start_datetime = (  SELECT MAX(down_start_datetime) 
                                                                  FROM icom_recieve_down_time_raw 
                                                                 WHERE machine_code = :NEW.machine_code
                                                                   AND down_start_datetime <= CAST(:NEW.PLC_TIMESTAMP AS DATE)  --가장 최근 데이터만 업데이트
                                                                   AND tag_address  = :NEW.tag_address
                                                                   AND tag_value    = :NEW.MACHINE_STATUS_VALUE
                                                                   AND is_fixed = 'N'
                                                               )
                                   AND tag_address  = :NEW.tag_address
                                   AND tag_value    = :NEW.MACHINE_STATUS_VALUE 
                                   AND is_fixed = 'N' ;

                            EXCEPTION WHEN NO_DATA_FOUND THEN 
                                 LVI_EXISTS := 0 ;
                            END ;

                         ------------------------------------------------
                         --
                         ------------------------------------------------
                         IF    LVI_EXISTS > 0 THEN 
                              NULL;
                         ELSE

                                 INSERT INTO icom_recieve_down_time_raw (
                                        plc_code,machine_code,plc_datetime,tag_address,
                                        tag_value,down_start_datetime,down_end_datetime,
                                        down_time_term,comments,
                                        enter_date,enter_by,last_modify_date,last_modify_by,
                                        organization_id,is_fixed
                                    ) VALUES (
                                        :NEW.plc_code,:NEW.machine_code,:NEW.MACHINE_DATETIME,:NEW.tag_address,
                                        :NEW.MACHINE_STATUS_VALUE,
                                        CAST(:NEW.PLC_TIMESTAMP AS DATE) , --stop_start_datetime,
                                        NULL ,      --stop_end_datetime,
                                        0 ,         --stop_time_term,
                                        NULL ,      --comments,
                                        sysdate ,   --enter_date,
                                        'PLC RAW TRIGGER' , --enter_by,
                                        sysdate ,   --last_modify_date,
                                        'PLC RAW TRIGGER',  --last_modify_by,
                                        1, --organization_id
                                        'N' --is_fixed
                                    );
                            END IF ; --IF EXISTS

                        END IF ; --IF :NEW.tag_type = 'ES' AND :NEW.MACHINE_STATUS_VALUE IN ( '0' , '1' , '2' , '3' , '4' , '5' )

                        ------------------------------------------------------------------------
                        --가장 최근 DOWN 상태인 데이터에 정지시간 계산후 업데이트  
                        --:NEW.tag_value 값이 0, 1 , 2 면 설비가 동작된것으로 판단한다
                        ------------------------------------------------------------------------
                        IF :NEW.tag_type = 'ES' AND :NEW.MACHINE_STATUS_VALUE IN ( '0' , '1' , '2' )  THEN -- :NEW.MACHINE_STATUS_VALUE IN ( '0' , '1' , '2' , '3' , '4' , '5'  ) THEN
                           ---------------------------------------------------------------------
                           --만약 설비정지후 재가동이 되었을경우 데이터를 놓치면 
                           --정지상태로 남아있던 데이터가 존해하지만 , 그중 최근것만 시간을 계산해서 처리
                           --나머지 놓친 데이터는 계속 정지시작 시간만 가지고 있으므로 처리방안 마련
                           ---------------------------------------------------------------------
                                DEBUG_PHASE := 'UPDATE DOWN TIME' ;
                                UPDATE icom_recieve_down_time_raw 
                                   SET down_end_datetime = CAST(:NEW.PLC_TIMESTAMP AS DATE)  ,
                                       down_time_term    = round(( CAST(:NEW.PLC_TIMESTAMP AS DATE)  - down_start_datetime ) * 24* 60 , 3) , --분으로 처리 
                                       tag_value_last    = :NEW.MACHINE_STATUS_VALUE ,
                                       is_fixed = 'Y'
                                 WHERE machine_code = :NEW.machine_code
                                   AND down_start_datetime = ( SELECT MAX(down_start_datetime) 
                                                                 FROM icom_recieve_down_time_raw 
                                                                WHERE machine_code = :NEW.machine_code
                                                                   AND down_start_datetime <= CAST(:NEW.PLC_TIMESTAMP AS DATE)  --가장 최근 데이터만 업데이트
                                                                   AND tag_address  = :NEW.tag_address
                                                                   AND tag_value    <> :NEW.MACHINE_STATUS_VALUE 
                                                               )
                                   AND tag_address  = :NEW.tag_address
                                   AND tag_value    <> :NEW.MACHINE_STATUS_VALUE --EQP state down
                                   AND down_end_datetime IS NULL
                                   ;
                        END IF ;         

            END IF ;--IF ALARM

END IF ; --IF PLC

EXCEPTION WHEN OTHERS THEN 
     NULL ;

 -- 스카다에서 에러 발생시 데이터 누락되지 않도록 일단 널 처리     
 --  RAISE_APPLICATION_ERROR( -20002 , ' TRG_ICOM_RECIEVE_DATA_INS TRIGGER SQLCODE='||TO_CHAR(SQLCODE)||' DEBUG='||DEBUG_PHASE||' DATE='||:NEW.MACHINE_DATETIME||' TAG='||:NEW.tag_address||' VALUE='||:NEW.MACHINE_STATUS_VALUE ||' MACHINE='||:NEW.machine_code||' '||SQLERRM ) ;
END;

/
ALTER TRIGGER "INFINITY21_JSFMS"."TRG_ICOM_RECIEVE_DATA_INS" ENABLE;
--------------------------------------------------------
--  DDL for Trigger TRG_ICOM_RECIEVE_PLC_INS
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE TRIGGER "INFINITY21_JSFMS"."TRG_ICOM_RECIEVE_PLC_INS" 
  BEFORE INSERT ON ICOM_RECIEVE_PLC_RAW
  REFERENCING OLD AS OLD NEW AS NEW
  FOR EACH ROW
------------------------------------------------------
  --
  ------------------------------------------------------
DECLARE
  DEBUG_PHASE VARCHAR2(50);
  --pragma autonomous_transaction; --사용여부 나중에 판단
  lvs_tag_type varchar2(20);
BEGIN
  /*2022.10.07 추가 zKey*/
  begin
    select t.tag_type
      into lvs_tag_type
      from icom_plc_tag_master t
     where t.machine_code = :new.machine_code
       and t.tag_address = :new.tag_address;
  exception
    when others then
      lvs_tag_type := 'ERR';
  end;

  :new.tag_type_r := lvs_tag_type;
  /*2022.10.07 여기까지  zKey*/
  NULL;
  --    --------------------------------------
  --    --설비마스터에 최종 동작모드 업데이트 
  --    --------------------------------------
  --        DEBUG_PHASE := 'UPDATE CONTROL STATE' ;
  --        UPDATE ICOM_MACHINE_MASTER 
  --           SET CONTROL_STATE = :NEW.TAG_VALUE
  --         WHERE MACHINE_CODE  = :NEW.MACHINE_CODE
  --           AND CONTROL_STATE_TAG_ADDRESS = :NEW.TAG_ADDRESS 
  --           AND NVL(CONTROL_STATE ,'0') <> :NEW.TAG_VALUE --이전 상태와 다른경우만
  --           ;         
  --    --------------------------------------
  --    --설비마스터에 최종 상태 업데이트 
  --    --------------------------------------
  --        DEBUG_PHASE := 'UPDATE EQP STATE' ;
  --        UPDATE ICOM_MACHINE_MASTER
  --           SET EQP_STATE    = :NEW.TAG_VALUE
  --         WHERE MACHINE_CODE = :NEW.MACHINE_CODE
  --           AND EQP_STATE_TAG_ADDRESS = :NEW.TAG_ADDRESS 
  --           AND NVL(EQP_STATE , '0') <> :NEW.TAG_VALUE --이전 상태와 다른경우만
  --           ;
  ----------------------------------------------------------------------------
  ----설비정지시간 저장구현 로직 
  ----TAG_VALUE --0:초기값--1:Idle--2:Run--3:Down(알람)--4:Skip(Pass)--5:Disconnect
  ----ICOM_MACHINE_MASTER 설비관리 테이블 고정컬럼으로 
  ----CONTROL_STATE_TAG_ADDRESS : 미리 TAG 주소 세팅해놓음
  ----EQP_STATE_TAG_ADDRESS : 미리 TAG 주소 세팅해놓음
  ----해당주송
  ----------------------------------------------------------------------------
  --  
  --      DEBUG_PHASE := 'INSERT EQP STATE' ;
  --      IF :NEW.tag_type = 'ES' AND :NEW.tag_value IN ( '0' , '1' , '2' , '3' , '4' , '5' ) THEN  
  --         INSERT INTO icom_recieve_down_time_raw (
  --                plc_code,
  --                machine_code,
  --                plc_datetime,
  --                tag_address,
  --                tag_value,
  --                
  --                down_start_datetime,
  --                down_end_datetime,
  --                down_time_term,
  --                comments,
  --                enter_date,
  --                enter_by,
  --                last_modify_date,
  --                last_modify_by,
  --                organization_id,
  --                is_fixed
  --            ) VALUES (
  --                :NEW.plc_code,
  --                :NEW.machine_code,
  --                :NEW.plc_datetime,
  --                :NEW.tag_address,
  --                :NEW.tag_value,
  --                
  --                CAST(:NEW.PLC_TIMESTAMP AS DATE) ,  --                TO_DATE(substr(:NEW.plc_datetime,1,14)) , --stop_start_datetime,
  --                NULL ,      --stop_end_datetime,
  --                
  --                0 ,         --stop_time_term,
  --                NULL ,      --comments,
  --                sysdate ,   --enter_date,
  --                'PLC RAW TRIGGER' , --enter_by,
  --                sysdate ,   --last_modify_date,
  --                'PLC RAW TRIGGER',  --last_modify_by,
  --                1, --organization_id
  --                'N'
  --            );
  --        END IF ;
  --        
  --        ------------------------------------------------------------------------
  --        --가장 최근 DOWN 상태인 데이터에 정지시간 계산후 업데이트    (네트워크오류제외) 
  --        --:NEW.tag_value 값이 3 이 아니면 설비가 동작된것으로 판단한다
  --        ------------------------------------------------------------------------
  --        IF :NEW.tag_type = 'ES' AND :NEW.tag_value IN ( '0' , '1' , '2' , '4' ) THEN
  --        
  --           ---------------------------------------------------------------------
  --           --만약 설비정지후 재가동이 되었을경우 데이터를 놓치면 
  --           --정지상태로 남아있던 데이터가 존해하지만 , 그중 최근것만 시간을 계산해서 처리
  --           --나머지 놓친 데이터는 계속 정지시작 시간만 가지고 있으므로 처리방안 마련
  --           ---------------------------------------------------------------------
  --                DEBUG_PHASE := 'UPDATE DOWN TIME' ;
  --                UPDATE icom_recieve_down_time_raw 
  --                   SET down_end_datetime = CAST(:NEW.PLC_TIMESTAMP AS DATE)  ,
  --                       down_time_term    = round(( CAST(:NEW.PLC_TIMESTAMP AS DATE)  - down_start_datetime ) * 24* 60 , 3) ,
  --                       tag_value_last    = :NEW.tag_value ,
  --                       is_fixed = 'Y'
  --                   --   down_end_datetime = TO_DATE(substr(:NEW.plc_datetime,1,14)) ,
  --                   --   down_time_term    = ( TO_DATE(substr(:NEW.plc_datetime,1,14)) - down_start_datetime ) * 24* 60 
  --                 WHERE machine_code = :NEW.machine_code
  --                   AND tag_address  = :NEW.tag_address
  --                   AND tag_value    = '3' --EQP state down
  --                   AND down_start_datetime = ( SELECT MAX(down_start_datetime) 
  --                                                 FROM icom_recieve_down_time_raw 
  --                                                WHERE machine_code = :NEW.machine_code
  --                                                   AND tag_address  = :NEW.tag_address
  --                                                   AND tag_value    = '3' 
  --                                                   AND down_start_datetime <= CAST(:NEW.PLC_TIMESTAMP AS DATE)  --r가장 최근 데이터만 업데이트
  --                                               )
  --                   --AND down_start_datetime <= CAST(:NEW.PLC_TIMESTAMP AS DATE)  
  --                   AND down_end_datetime IS NULL
  --                   ;
  --        END IF ; 

EXCEPTION
  WHEN OTHERS THEN
    NULL;
    ps_job_errorlog(88,
                    1,
                    'TRG_ICOM_RECIEVE_PLC_INS',
                    'TRG_ICOM_RECIEVE_PLC_INS',
                    substr(SQLERRM, 1, 400),
                    'TRG');

  --RAISE_APPLICATION_ERROR( -20002 , ' TRG_ICOM_RECIEVE_PLC_INS TRIGGER SQLCODE='||TO_CHAR(SQLCODE)||' DEBUG='||DEBUG_PHASE||' DATE='||:NEW.plc_datetime||' TAG='||:NEW.tag_address||' VALUE='||:NEW.tag_value ||' MACHINE='||:NEW.machine_code||' '||SQLERRM ) ;
END;


/
ALTER TRIGGER "INFINITY21_JSFMS"."TRG_ICOM_RECIEVE_PLC_INS" ENABLE;
--------------------------------------------------------
--  DDL for Trigger TRG_XSCADA_DATATAG_LOG_INS
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE TRIGGER "INFINITY21_JSFMS"."TRG_XSCADA_DATATAG_LOG_INS" 
AFTER INSERT ON XSCADA_DATATAG_LOG 
REFERENCING OLD AS OLD NEW AS NEW 
FOR EACH ROW 

--------------------------------------------------------------------------------
-- 
-- 20220624 : 유혁수 생성 ( 스카다에서 입력시 속도저하 고려할것 )
-- 알람 및 상태 데이터가 스카다를 통해 입력됨
-- 본 트리거에서는 로그데어터 추출후 데이터 변환 및 DB 전송 ( 변환 작업만 진행 )
-- F_GET_ALARM_MSG_BY_ADDRESS(plc_code , machine_code , tag_address) : 리턴값 없을시 '*' 반환 (알람마스터에서 추출)
-- F_GET_MACHINE_CODE_BY_ADDRESS( plc_code , tag_address): 리턴값 없을시 '*' 반환 (태그마스터에서 추출)
--
-- REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 1 ) PLC
-- REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 2 ) ALARM
-- REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 3 ) MACHINE CODE
-- REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 4 ) TAG ADDRESS
-- 데이터 형식 . 로 구분 DATATAG_NAME : PLC02.Alarm.KRCWO12EMOM316.M801 
--------------------------------------------------------------------------------
DECLARE 

   LVS_RETURN VARCHAR2(10) ;   
   PHASE VARCHAR2(50) ;
   LVI_EXISTS NUMBER ;
   -- pragma autonomous_transaction; --사용여부 나중에 판단
BEGIN

 -------------------------------------------------------------------------------
 -- 태그가 수정되어 있지 않아서 임시로 처리  2개짜리 태그값으로 올라온경우 
 -- BIT 데이터의 경우 불완전한 상태로 올라옴 (개선필요)
 -- 데이터 형식 : PLC02.KRCWO12EMOM316 ,  PLC02.KRCWO12EMOM316_E (자이솜 개선필요) 
 -------------------------------------------------------------------------------
   IF REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 3 ) = '' OR REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 3 ) IS NULL THEN 
              PHASE := 'OPERATION INSERT 2 TAG' ;    
                     -- PLC bit 발생 데이터만 입력
                     INSERT INTO icom_recieve_bit_raw (
                        plc_code ,
                        machine_code, --설비코드
                        tag_address,
                        tag_value,
                        machine_datetime, --알람발생시간 문자형식
                        plc_timestamp ,
                        comments, --설명
                        enter_date, --생성일자 SYSDATE
                        enter_by, --스카다 ID 번호남김
                        organization_id --조직 무조건 1
                    )
                    SELECT  
                           REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 1 ) ,
                           REPLACE( UPPER(REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 2 )) , '-E' , '')  AS machine_code ,
                           UPPER(REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 2 ))  AS machine_status_div, --Alram / Operation
                           DECODE( SUBSTR( UPPER(REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 2 )) , -2 , 2 )   , '_E' , 1 , 2 ) AS machine_status_value  , --1 이 알람발생 2 가 해제 Off 를 2 로 변경
                           TO_CHAR(CAST(:NEW.CTIME AS DATE) , 'YYYYMMDDHH24MISS' ),
                           systimestamp ,
                           '' AS comments,
                           SYSDATE ,
                           :NEW.ID||'-TRIGGER',
                           1
                    FROM   DUAL ; 
--   -----------------------------------------------------------------------------    
--   -- 태그가 수정되어 있지 않아서 임시로 처리  
--   -- 3개짜리 태그값(설비코드가 제외된) 으로 올라온경우 ( 개발초기 임시로 사용함 ) 혹시몰라서 남겨둠 
--   -- 정상적인 태그는 4 개짜리
--   -----------------------------------------------------------------------------
--   ELSIF REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 4 ) = '' OR REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 4 ) IS NULL THEN 
--         PHASE := 'OPERATION INSERT 3 TAG' ;
--         
--         --알람 발생 
--         IF UPPER(REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 2 )) ='ALARM' AND UPPER(:NEW.VALUE_STR) = 'ON' THEN 
--
--                     INSERT INTO icom_recieve_data_raw (
--                        machine_div, --영역구분
--                        machine_code, --설비코드
--                        machine_status_div, --ALARM / OPERATION 구분
--                        machine_status_value, --상태값
--                        machine_message, --알람메시지: 스카다가 제공못하므로 디비에서 추출
--                        machine_datetime, --알람발생시간 문자형식 
--                        comments, --설명
--                        enter_date, --생성일자 SYSDATE
--                        enter_by, --스카다 ID 번호남김
--                        organization_id, --조직 무조건 1
--                        plc_code,    --대상 PLC번호
--                        tag_address, --TAG ADDRESS 를 알람코드로 사용
--                        ALARM_START_DATETIME, --알람발생시간 DATETIME 형식
--                        ALARM_END_DATETIME ,  --PLC EQP STATE 가 RUN 으로 바뀌면 모든 알람해제 일자업데이트
--                        ALARM_TIME_TERM       --PLC EQP STATE 가 RUN 으로 바뀌면 알람발생-종료 시간 업데이트
--                    )
--                    
--                    SELECT  
--                           'PLC' , --고정문자 
--                           --REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 3 ) , --machine code 설비코드
--                           F_GET_MACHINE_CODE_BY_ADDRESS( REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 1 )  , REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 3 ) ) AS machine_code ,
--                           UPPER(REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 2 ))  AS machine_status_div, --Alram / Operation
--                           DECODE( UPPER(:NEW.VALUE_STR) , 'OFF' , 2 , 1 ) AS machine_status_value  , --1 이 알람발생 2 가 해제 Off 를 2 로 변경
--                           F_GET_ALARM_MSG_BY_ADDRESS(REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 1 ) , '%' , REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 3 ) ) AS machine_message ,
--                           TO_CHAR(CAST(:NEW.CTIME AS DATE) , 'YYYYMMDDHH24MISS' ),
--                           '' AS comments,
--                           SYSDATE ,
--                           :NEW.ID||'-TRIGGER',
--                           1,
--                           REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 1 ) ,
--                           REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 3 ) ,
--                           CAST(:NEW.CTIME AS DATE) ,
--                           DECODE( UPPER(:NEW.VALUE_STR) , 'OFF' , CAST(:NEW.CTIME AS DATE) , NULL ) ,
--                           0
--                    FROM   DUAL ;
--            --------------------------------------------------------------------        
--            --알람 OFF 태그는 저장하지 않고 상태만 바꿈
--            --------------------------------------------------------------------
--            ELSIF UPPER(REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 2 )) ='ALARM' AND UPPER(:NEW.VALUE_STR) = 'OFF' THEN
--               -------------------------------------------------
--               --알람 해제가 들어오면 이전 알람에 시간을 업데이트 한다
--               -------------------------------------------------
--                UPDATE icom_recieve_data_raw 
--                   SET ALARM_END_DATETIME    = CAST(:NEW.CTIME AS DATE) , --알람 해제시간 
--                       ALARM_TIME_TERM       = (CAST(:NEW.CTIME AS DATE) - ALARM_START_DATETIME ) * 24 * 60 * 60--발생경과시간 초단위
--                 WHERE MACHINE_DIV           = 'PLC'
--                   AND MACHINE_CODE          =  F_GET_MACHINE_CODE_BY_ADDRESS( REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 1 )  , REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 3 ) ) --REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 3 ) --설비코드 
--                   AND MACHINE_STATUS_DIV    = UPPER(REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 2 )) --ALARM
--                   AND TAG_ADDRESS           = REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 3 ) --TAG ADDRESS
--                   AND ALARM_START_DATETIME <= CAST(:NEW.CTIME AS DATE) --알람발생시작시간 
--                   AND MACHINE_STATUS_VALUE  = '1' --알람 발생후 해제 안된거
--                   ;           
--            --기타 상황 일단 고려 안함 로그 남길지 말지.         
--            ELSIF UPPER(REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 2 )) ='OPERATION' THEN
--                  NULL ;
--            END IF ;
   -----------------------------------------------------------------------------
   -- 4개짜리 태그 정상적인 상황
   -- 문제점 : 네트워크가 단절되었다가 다시 붙으면 스카다가 무조건 최종 상태값을 다시 보내고 있음
   -- 알람이 발생하지 않았어도 OFF 상태의 값을 다시보내옴( 상태가 변하지 않았는데 필요없는 데이터)
   -- 마지각 알람 상태가 OFF 인데 OFF 가올라왔는지 체크해서 버리는 작업을 해야함(불필요한 사족)
   -- 알람과 동작상태 동작모드 가 같이 올라옴 태그 두번째 항목으로 판단 ALARM , OPERATION 
   -----------------------------------------------------------------------------
   ELSE
          --알람 인경우 
          PHASE := 'OPERATION INSERT 4 TAG' ;
          IF UPPER(REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 2 )) ='ALARM'
             AND UPPER(:NEW.VALUE_STR) IN( 'ON' , '1' )  THEN 

                     ----------------------------------------------------------
                     --해당태그의 마지막 상태값과 동일하면 
                     --등록하지 않고 버린다.(네트워크오류로 인한 중복 발송으로 간주함)
                     --이미 발생되어 있으면서 해결안된 알람이 있는지 체크해서 중복
                     --으로 알람건수로 세지 않도록함
                     ----------------------------------------------------------
                     BEGIN 
                         SELECT 1
                           INTO LVI_EXISTS
                           FROM icom_recieve_data_raw
                          WHERE MACHINE_DIV = 'PLC'
                            AND MACHINE_CODE = REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 3 ) 
                            AND TAG_ADDRESS = REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 4 )
                            AND MACHINE_STATUS_VALUE = 1
                            AND MACHINE_DATETIME = (
                                                        SELECT MAX(MACHINE_DATETIME) FROM icom_recieve_data_raw
                                                         WHERE MACHINE_DIV = 'PLC'
                                                           AND MACHINE_CODE = REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 3 ) 
                                                           AND TAG_ADDRESS = REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 4 )
                                                           AND MACHINE_STATUS_VALUE = 1
                                                           AND MACHINE_DATETIME <= TO_CHAR(CAST(:NEW.CTIME AS DATE) , 'YYYYMMDDHH24MISS' )
                                                           AND IS_FIXED = 'N'
                                                    )  
                            AND IS_FIXED = 'N'
                            ;
                     EXCEPTION WHEN NO_DATA_FOUND THEN 
                           LVI_EXISTS := 0 ;
                     END ;

                     IF LVI_EXISTS > 0 THEN 
                         NULL ;
                     ELSE
                                     -- PLC 알람이 발생
                                     INSERT INTO icom_recieve_data_raw (
                                        machine_div, --영역구분
                                        machine_code, --설비코드
                                        machine_status_div, --ALARM / OPERATION 구분
                                        machine_status_value, --상태값
                                        machine_message, --알람메시지: 스카다가 제공못하므로 디비에서 추출
                                        machine_datetime, --알람발생시간 문자형식 
                                        comments, --설명
                                        enter_date, --생성일자 SYSDATE
                                        enter_by, --스카다 ID 번호남김
                                        organization_id, --조직 무조건 1
                                        plc_code,    --대상 PLC번호
                                        tag_address, --TAG ADDRESS 를 알람코드로 사용
                                        ALARM_START_DATETIME, --알람발생시간 DATETIME 형식
                                        ALARM_END_DATETIME ,  --PLC EQP STATE 가 RUN 으로 바뀌면 모든 알람해제 일자업데이트
                                        ALARM_TIME_TERM,       --PLC EQP STATE 가 RUN 으로 바뀌면 알람발생-종료 시간 업데이트
                                        TAG_TYPE ,
                                        PLC_TIMESTAMP ,
                                        IS_FIXED,
                                        SCADA_ID,
                                        EQP_STATE ,
                                        CONTROL_STATE
                                    )
                                    SELECT  
                                           'PLC' , --고정문자 
                                           REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 3 ) , --machine code 설비코드
                                           --F_GET_MACHINE_CODE_BY_ADDRESS( REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 1 )  , REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 4 ) ) AS machine_code ,
                                           UPPER(REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 2 ))  AS machine_status_div, --Alram / Operation
                                           DECODE( UPPER(:NEW.VALUE_STR) , 'OFF' , 2 , '0' , 2 ,  1 ) AS machine_status_value  , --1 이 알람발생 2 가 해제 Off 를 2 로 변경
                                           F_GET_ALARM_MSG_BY_ADDRESS(REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 1 ) , '%' , REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 4 ) ) AS machine_message ,
                                           TO_CHAR(CAST(:NEW.CTIME AS DATE) , 'YYYYMMDDHH24MISS' ),
                                           :NEW.DATATAG_NAME AS comments,
                                           SYSDATE ,
                                           'TRIGGER',
                                           1,
                                           REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 1 ) ,
                                           REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 4 ) ,
                                           CAST(:NEW.CTIME AS DATE),
                                           DECODE( UPPER(:NEW.VALUE_STR) , 'OFF' , CAST(:NEW.CTIME AS DATE) , '0' , CAST(:NEW.CTIME AS DATE) , NULL ) ,
                                           0 ,
                                           NULL ,
                                           :NEW.CTIME ,
                                           'N', --알람데이터는 미해결된 상태로 처리 
                                           :NEW.ID,
                                           EQP_STATE ,
                                           CONTROL_STATE
                                    FROM ICOM_MACHINE_MASTER 
                                   WHERE MACHINE_CODE = REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 3 ) ;
                      END IF ; -- LVI_EXISTS        
            --------------------------------------------------------------------        
            --알람 OFF 태그는 저장하지 않고 상태만 바꿈
            --알람 ON 없이 OFF 가 발생 하지 않고 , OFF 만 발생하더라도 알람 건수와
            --알람 발생건수로 간주 하지 않음
            --네트워크 단절로 인한 스카다 최신 상태값 스캔 로직에 의해 OFF 데이터가 한꺼번에 들어올수 있음 
            --------------------------------------------------------------------
         ELSIF UPPER(REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 2 )) ='ALARM' AND UPPER(:NEW.VALUE_STR) IN ( 'OFF' , '0') THEN 
               -------------------------------------------------
               --알람 해제가 들어오면 이전 알람에 시간을 업데이트 한다
               --알람이 해제되었지만 MACHINE_STATUS_DIV 는 1 로 남겨둔다
               --알람발생 조회에서 알람발생 구분조건으로 1 을 사용
               -------------------------------------------------
                UPDATE icom_recieve_data_raw 
                   SET ALARM_END_DATETIME    = CAST(:NEW.CTIME AS DATE) , --알람 해제시간 
                       ALARM_TIME_TERM       = (CAST(:NEW.CTIME AS DATE) - ALARM_START_DATETIME ) * 24 * 60 ,  --발생경과시간 분단위
                       COMMENTS = :NEW.DATATAG_NAME ,
                       IS_FIXED = 'Y' 
                 WHERE MACHINE_DIV           = 'PLC'
                   AND MACHINE_CODE          = REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 3 ) --설비코드 
                   AND MACHINE_STATUS_DIV    = UPPER(REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 2 )) --ALARM
                   AND TAG_ADDRESS           = REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 4 ) --TAG ADDRESS
                   AND ALARM_START_DATETIME <= CAST(:NEW.CTIME AS DATE) --알람발생시작시간 
                   AND MACHINE_STATUS_VALUE  = '1' --알람 발생후 해제 안된거
                   AND IS_FIXED = 'N'
                   ;           
         -----------------------------------------------------------------------          
         --동작 데이터가 들어온 경우           
        -- 0,1,2,3,4,5 가 들어옴 0=초기화,1=IDLE,2= RUN,3=DOWN,4=SKIP,5=DISCONNECT
         -----------------------------------------------------------------------
         ELSIF UPPER(REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 2 )) IN( 'STATE' , 'OPERATION' , 'ROBOT' ) THEN 

                     -- PLC 알람 발생 데이터만 입력
                     INSERT INTO icom_recieve_data_raw (
                        machine_div, --영역구분
                        machine_code, --설비코드
                        machine_status_div, --ALARM / OPERATION 구분
                        machine_status_value, --상태값
                        machine_message, --알람메시지: 스카다가 제공못하므로 디비에서 추출
                        machine_datetime, --알람발생시간 문자형식 
                        comments, --설명
                        enter_date, --생성일자 SYSDATE
                        enter_by, --스카다 ID 번호남김
                        organization_id, --조직 무조건 1
                        plc_code,    --대상 PLC번호
                        tag_address, --TAG ADDRESS 를 알람코드로 사용
                        ALARM_START_DATETIME, --알람발생시간 DATETIME 형식
                        ALARM_END_DATETIME ,  --PLC EQP STATE 가 RUN 으로 바뀌면 모든 알람해제 일자업데이트
                        ALARM_TIME_TERM ,     --PLC EQP STATE 가 RUN 으로 바뀌면 알람발생-종료 시간 업데이트
                        TAG_TYPE ,
                        PLC_TIMESTAMP,
                        IS_FIXED,
                        SCADA_ID,
                        EQP_STATE ,
                        CONTROL_STATE
                    )
                    SELECT  
                           'PLC' , --고정문자 
                           REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 3 ) , --machine code 설비코드
                           --F_GET_MACHINE_CODE_BY_ADDRESS( REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 1 )  , REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 4 ) ) AS machine_code ,
                           UPPER(REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 2 ))  AS machine_status_div, --Alram / Operation
                           UPPER(:NEW.VALUE_STR) AS machine_status_value  , --1 이 알람발생 2 가 해제 Off 를 2 로 변경
                           F_GET_ALARM_MSG_BY_ADDRESS(REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 1 ) , '%' , REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 4 ) ) AS machine_message ,
                           TO_CHAR(CAST(:NEW.CTIME AS DATE) , 'YYYYMMDDHH24MISS' ), --문자열 형식 날짜로 보관
                           :NEW.DATATAG_NAME AS comments, --스카다 데이터 보관
                           SYSDATE ,
                           :NEW.ID||'-TRIGGER', --스카다 ID 키값 사용
                           1,
                           REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 1 ) , --PLC 
                           REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 4 ) , --TAG ADDRESS
                           NULL ,  --알람이 아니므로 널 처리
                           NULL ,  --알람이 아니므로 널 처리 
                           0 ,     --ALARM_TIME_TERM
                           DECODE( EQP_STATE_TAG_ADDRESS , REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 4 )  , 'ES' , NULL ) ,--설비상태 주소와 동일할 경우 다음트리거에서 설비정지 테이블로 데이터 저장 
                           :NEW.CTIME ,
                           'Y' , --동작데이터는 발샐즉시 해결된 상태로 처리 
                           :NEW.ID,
                           EQP_STATE ,
                           CONTROL_STATE
                    FROM   ICOM_MACHINE_MASTER 
                   WHERE MACHINE_CODE = REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 3 ) ;        

--        -----------------------------------------------------------------------   
--        -- 스카다 개선전 임시로 적용
--        --동작 데이터가 들어온 경우           
--        -- 0,1,2,3,4,5 가 들어옴 0=초기화,1=IDLE,2= RUN,3=DOWN,4=SKIP,5=DISCONNECT
--         -----------------------------------------------------------------------
--         ELSIF UPPER(REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 2 )) ='ALARM' 
--         AND UPPER(:NEW.VALUE_STR) IN ( '0','1', '2' ,'3' , '4','5' ) 
--         AND REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 4 ) LIKE 'W0_0_' THEN 
--     
--                      -- PLC 알람 발생 데이터만 입력
--                     INSERT INTO icom_recieve_data_raw (
--                        machine_div, --영역구분
--                        machine_code, --설비코드
--                        machine_status_div, --ALARM / OPERATION 구분
--                        machine_status_value, --상태값
--                        machine_message, --알람메시지: 스카다가 제공못하므로 디비에서 추출
--                        machine_datetime, --알람발생시간 문자형식 
--                        comments, --설명
--                        enter_date, --생성일자 SYSDATE
--                        enter_by, --스카다 ID 번호남김
--                        organization_id, --조직 무조건 1
--                        plc_code,    --대상 PLC번호
--                        tag_address, --TAG ADDRESS 를 알람코드로 사용
--                        ALARM_START_DATETIME, --알람발생시간 DATETIME 형식
--                        ALARM_END_DATETIME ,  --PLC EQP STATE 가 RUN 으로 바뀌면 모든 알람해제 일자업데이트
--                        ALARM_TIME_TERM ,     --PLC EQP STATE 가 RUN 으로 바뀌면 알람발생-종료 시간 업데이트
--                        TAG_TYPE ,
--                        PLC_TIMESTAMP,
--                        IS_FIXED
--                    )
--                    SELECT  
--                           'PLC' , --고정문자 
--                           REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 3 ) , --machine code 설비코드
--                           --F_GET_MACHINE_CODE_BY_ADDRESS( REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 1 )  , REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 4 ) ) AS machine_code ,
--                           'STATE' ,--UPPER(REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 2 ))  AS machine_status_div, --Alram / Operation
--                           UPPER(:NEW.VALUE_STR) AS machine_status_value  , --1 이 알람발생 2 가 해제 Off 를 2 로 변경
--                           F_GET_ALARM_MSG_BY_ADDRESS(REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 1 ) , '%' , REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 4 ) ) AS machine_message ,
--                           TO_CHAR(CAST(:NEW.CTIME AS DATE) , 'YYYYMMDDHH24MISS' ), --문자열 형식 날짜로 보관
--                           :NEW.DATATAG_NAME AS comments, --스카다 데이터 보관
--                           SYSDATE ,
--                           :NEW.ID||'-TRIGGER', --스카다 ID 키값 사용
--                           1,
--                           REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 1 ) , --PLC 
--                           REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 4 ) , --TAG ADDRESS
--                           NULL ,  --알람이 아니므로 널 처리
--                           NULL ,  --알람이 아니므로 널 처리 
--                           0 ,     --ALARM_TIME_TERM
--                           DECODE( EQP_STATE_TAG_ADDRESS , REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 4 )  , 'ES' , NULL ) ,--설비상태 주소와 동일할 경우 다음트리거에서 설비정지 테이블로 데이터 저장 
--                           :NEW.CTIME ,
--                           'Y'--동작데이터는 발샐즉시 해결된 상태로 처리 
--                    FROM   ICOM_MACHINE_MASTER 
--                   WHERE MACHINE_CODE = REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 3 ) ;                     
--                   
--                   
            END IF ;
    END IF ;
--------------------------------------------------------------------------------
-- 설비 마스터에 마지막상태 저장 
-- 데드락을 일으켜서 막음 YHS 20221019
--------------------------------------------------------------------------------
--IF UPPER(REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 2 )) ='ALARM' THEN  
--
--    UPDATE ICOM_MACHINE_MASTER 
--    SET LAST_ALARM_DATETIME = CAST(:NEW.CTIME AS DATE) , LAST_ALARM_TAG_ADDRESS = REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 4 )
--    WHERE MACHINE_CODE =  REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 3 ) ;
--    
--ELSIF UPPER(REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 2 )) ='STATE' THEN
--
--    UPDATE ICOM_MACHINE_MASTER 
--    SET LAST_STATE_DATETIME = CAST(:NEW.CTIME AS DATE) , LAST_ALARM_TAG_ADDRESS = REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 4 )
--    WHERE MACHINE_CODE =  REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 3 ) ;
--    
--ELSIF UPPER(REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 2 )) ='OPERATION' THEN
--
--    UPDATE ICOM_MACHINE_MASTER 
--    SET LAST_OPERATION_DATETIME = CAST(:NEW.CTIME AS DATE) , LAST_ALARM_TAG_ADDRESS = REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 4 )
--    WHERE MACHINE_CODE =  REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 3 ) ;
--END IF ;

EXCEPTION WHEN OTHERS THEN 
      ps_job_errorlog(77,1,'TRG_XSCADA_DATATAG_LOG_INS','TRG_XSCADA_DATATAG_LOG_INS',substr(SQLERRM,1,400),'TRG') ; 
      NULL;
     --RAISE_APPLICATION_ERROR( -20001 , 'TRG_XSCADA_DATATAG_LOG_INS TRIGGER ERROR PHASE='||PHASE||' DATA='||:NEW.DATATAG_NAME||' '||SQLERRM );
END;

/
ALTER TRIGGER "INFINITY21_JSFMS"."TRG_XSCADA_DATATAG_LOG_INS" ENABLE;
--------------------------------------------------------
--  DDL for Trigger TRG_XSCADA_OPERATION_INS
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE TRIGGER "INFINITY21_JSFMS"."TRG_XSCADA_OPERATION_INS" 
AFTER INSERT ON XSCADA_OPERATION 
REFERENCING OLD AS OLD NEW AS NEW 
FOR EACH ROW 

-------------------------------------------------------------------
-- 20220624 : 유혁수 생성 ( 스카다에서 입력시 속도저하 고려할것 )
-- 로그추출후 데이터 변환전송 ( 변환 작업만 진행 )
-- F_GET_ALARM_MSG_BY_ADDRESS() : 리턴값 없을시 '*' 반환 (알람마스터에서 추출)
-- F_GET_MACHINE_CODE_BY_ADDRESS: 리턴값 없을시 '*' 반환 (태그마스터에서 추출)
--
-- REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 1 ) PLC
-- REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 2 ) ALARM
-- REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 3 ) MACHINE CODE
-- REGEXP_SUBSTR( :NEW.DATATAG_NAME  , '[^.]+' , 1 , 4 ) TAG ADDRESS
-- NAME DATA 형식 PLC01.Operation.KRCWO12ELOA101.W0100
--
-- 설비관리 테이블에 EQP_STATE_TAG_ADDRESS 선행등록필수
-------------------------------------------------------------------
DECLARE 
      LVS_RETURN VARCHAR2(10) ; --미사용
    --  pragma autonomous_transaction; --사용여부 나중에 판단
BEGIN
            ------------------------------------------------------------
            --PLC 동작 데이터만 입력
            --icom_recieve_plc_raw 테이블에서 트리거 또 있음.
            ------------------------------------------------------------
            INSERT INTO icom_recieve_plc_raw (
                    plc_code,     --PLC 코드
                    machine_code, --설비코드
                    plc_datetime, --발생일자
                    tag_address,  --태그주소
                    tag_value,    --태그값( 숫자와 문자가 혼합)
                    tag_data_type,--데이터 타입 
                    comments,     --주석
                    enter_date,   --등록일자(DB기준)
                    enter_by,     --등록자
                    organization_id, --조직 무조건 1
                    tag_type,     --알람,소모품실적,이상감지,작동모드,소모품목표,설비상태,검사인자,생산수량,생산정보,진입/배출,(안착/완료)
                    plc_timestamp --timestamp 형식 일자 
                ) 

                SELECT 
                        REGEXP_SUBSTR( :NEW.NAME  , '[^.]+' , 1 , 1 ) ,  --    plc_code
                        REGEXP_SUBSTR( :NEW.NAME  , '[^.]+' , 1 , 3 )  , --   설비코드  F_GET_MACHINE_CODE_BY_ADDRESS( REGEXP_SUBSTR( :NEW.NAME  , '[^.]+' , 1 , 1 )  , REGEXP_SUBSTR( :NEW.NAME  , '[^.]+' , 1 , 4 ) ), --machine_code,
                        TO_CHAR(:NEW.TIME , 'YYYYMMDDHH24MISSFF' ),     --plc_datetime
                        REGEXP_SUBSTR( :NEW.NAME  , '[^.]+' , 1 , 4 ) , --tag_address
                        :NEW.VALUE , --tag_value ( 스케일 고려여부 나중에 반영 )
                        'W',--:NEW.DATATAG_TYPE WORD 형태 데이터 주소
                        '', --COMMNETS
                        SYSDATE , --enter_date
                        'OPERATION TRIGGER', --enter_by
                        1 ,--organization_id  
                        DECODE( EQP_STATE_TAG_ADDRESS , REGEXP_SUBSTR( :NEW.NAME  , '[^.]+' , 1 , 4 )  , 'ES' , NULL ), --설비상태 주소와 동일할 경우 다음트리거에서 설비정지 테이블로 데이터 저장 
                        :NEW.TIME
                FROM ICOM_MACHINE_MASTER
               WHERE MACHINE_CODE = REGEXP_SUBSTR( :NEW.NAME  , '[^.]+' , 1 , 3 ) ;

--------------------------------------------------------------------------------
-- 설비 마스터에 마지막상태 저장 
-- 
--------------------------------------------------------------------------------
IF UPPER(REGEXP_SUBSTR( :NEW.NAME  , '[^.]+' , 1 , 2 )) ='ALARM' THEN  

    UPDATE ICOM_MACHINE_MASTER 
    SET LAST_ALARM_DATETIME = CAST(:NEW.TIME AS DATE) , LAST_ALARM_TAG_ADDRESS = REGEXP_SUBSTR( :NEW.NAME  , '[^.]+' , 1 , 4 )
    WHERE MACHINE_CODE =  REGEXP_SUBSTR( :NEW.NAME  , '[^.]+' , 1 , 3 ) ;

ELSIF UPPER(REGEXP_SUBSTR( :NEW.NAME  , '[^.]+' , 1 , 2 )) ='STATE' THEN

    UPDATE ICOM_MACHINE_MASTER 
    SET LAST_STATE_DATETIME = CAST(:NEW.TIME AS DATE) , LAST_ALARM_TAG_ADDRESS = REGEXP_SUBSTR( :NEW.NAME  , '[^.]+' , 1 , 4 )
    WHERE MACHINE_CODE =  REGEXP_SUBSTR( :NEW.NAME  , '[^.]+' , 1 , 3 ) ;

ELSIF UPPER(REGEXP_SUBSTR( :NEW.NAME  , '[^.]+' , 1 , 2 )) ='OPERATION' THEN

    UPDATE ICOM_MACHINE_MASTER 
    SET LAST_OPERATION_DATETIME = CAST(:NEW.TIME AS DATE) , LAST_ALARM_TAG_ADDRESS = REGEXP_SUBSTR( :NEW.NAME  , '[^.]+' , 1 , 4 )
    WHERE MACHINE_CODE =  REGEXP_SUBSTR( :NEW.NAME  , '[^.]+' , 1 , 3 ) ;
END IF ;

EXCEPTION WHEN OTHERS THEN 
     ps_job_errorlog(99,1,'TRG_XSCADA_OPERATION_INS','TRG_XSCADA_OPERATION_INS',substr(SQLERRM,1,400),'TRG') ; 

     RAISE_APPLICATION_ERROR( -20001 , 'TRIGGER ERROR=>'||SQLERRM );
     ROLLBACK;
END;


/
ALTER TRIGGER "INFINITY21_JSFMS"."TRG_XSCADA_OPERATION_INS" ENABLE;
--------------------------------------------------------
--  DDL for Procedure PROC_DELETE_ICOM_BATCH
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "INFINITY21_JSFMS"."PROC_DELETE_ICOM_BATCH" IS
  v_rows_deleted NUMBER := 0;
  v_total_deleted NUMBER := 0;
  v_batch NUMBER := 0;
BEGIN
  LOOP
    DELETE FROM ICOM_RECIEVE_DATA_RAW
     WHERE MACHINE_DATETIME <= '20250901000000'
       AND ROWNUM <= 1000;

    v_rows_deleted := SQL%ROWCOUNT;
    v_total_deleted := v_total_deleted + v_rows_deleted;
    v_batch := v_batch + 1;

    COMMIT;

    DBMS_OUTPUT.PUT_LINE('[' || v_batch || '회차] ' ||
                         v_rows_deleted || '건 삭제 완료. 누적: ' || v_total_deleted);

    EXIT WHEN v_rows_deleted = 0;
  END LOOP;

  DBMS_OUTPUT.PUT_LINE('삭제 종료. 총 ' || v_total_deleted || '건 삭제.');
EXCEPTION
  WHEN OTHERS THEN
    ROLLBACK;
    DBMS_OUTPUT.PUT_LINE('오류 발생: ' || SQLERRM);
END;

/
--------------------------------------------------------
--  DDL for Procedure PROC_DELETE_ICOM_BY_DAY
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "INFINITY21_JSFMS"."PROC_DELETE_ICOM_BY_DAY" (
    p_start_yyyymmdd IN VARCHAR2 DEFAULT '20210101000000',  -- 포함 시작(YYYYMMDD)
    p_end_yyyymmdd   IN VARCHAR2 DEFAULT '20250101000000',  -- 미포함 끝(YYYYMMDD)
    p_batch_size     IN PLS_INTEGER DEFAULT 100       -- 배치 삭제 건수
) IS
    v_start_date   DATE := TO_DATE(p_start_yyyymmdd, 'YYYYMMDDhh24miss'); -- 포함
    v_end_date     DATE := TO_DATE(p_end_yyyymmdd,   'YYYYMMDDhh24miss'); -- 미포함
    v_curr_date    DATE;
    v_next_date    DATE;

    v_day_from_key VARCHAR2(14);
    v_day_to_key   VARCHAR2(14);

    v_rows_deleted NUMBER := 0;
    v_total_deleted NUMBER := 0;
    v_batch NUMBER := 0;
BEGIN
    IF v_start_date >= v_end_date THEN
        RAISE_APPLICATION_ERROR(-20001, '시작일은 종료일보다 이전이어야 합니다.');
    END IF;

    v_curr_date := v_start_date;

    WHILE v_curr_date < v_end_date LOOP
        v_next_date := v_curr_date + 1;

        -- 날짜 키(접두 문자열) 생성: 'YYYYMMDD'
        v_day_from_key := TO_CHAR(v_curr_date, 'YYYYMMDDhh24miss');
        v_day_to_key   := TO_CHAR(v_next_date, 'YYYYMMDDhh24miss');

        -- 하루치 대상에 대해 배치 반복 삭제
        LOOP
            DELETE FROM ICOM_RECIEVE_DATA_RAW
             WHERE ROWID IN (
                   SELECT ROWID
                     FROM ICOM_RECIEVE_DATA_RAW
                    WHERE MACHINE_DATETIME >= v_day_from_key   -- 인덱스 사용 가능한 범위 조건
                      AND MACHINE_DATETIME <  v_day_to_key     -- (다음날 0시 직전까지)
             --         AND ROWNUM <= p_batch_size
             );

            v_rows_deleted := SQL%ROWCOUNT;
            v_total_deleted := v_total_deleted + v_rows_deleted;
            v_batch := v_batch + 1;

            COMMIT;

            DBMS_OUTPUT.PUT_LINE(
              '[' || v_batch || '회차] ' ||
              TO_CHAR(v_curr_date, 'YYYY-MM-DD') || ' 대상 ' ||
              v_rows_deleted || '건 삭제 (111누적 ' || v_total_deleted || ')'
            );

            EXIT WHEN v_batch = 1000; -- 하루치가 소진되면 다음 날로
        END LOOP;

        v_curr_date := v_next_date; -- 다음 날
    END LOOP;

    DBMS_OUTPUT.PUT_LINE('삭제 종료. 총 ' || v_total_deleted || '건 삭제.');
EXCEPTION
    WHEN OTHERS THEN
        ROLLBACK;
        DBMS_OUTPUT.PUT_LINE('오류 발생: ' || SQLERRM);
        RAISE;
END;

/
--------------------------------------------------------
--  DDL for Procedure PS_JOB_ERRORLOG
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "INFINITY21_JSFMS"."PS_JOB_ERRORLOG" ( p_work_no NUMBER
                          ,p_organization_id  NUMBER
                          ,p_process_name     VARCHAR2
                          ,p_process_object   VARCHAR2
                          ,p_remark           VARCHAR2
                          ,p_work_man         VARCHAR2)
    /******************************************************************************/
    /* Object Name  : worklog_start                                               */
    /* Description  : Work시작시 Log생성                                          */
    /* Parameter                                                                  */
    /*     Input   : p_organization_code                                          */
    /*               p_process_name                                               */
    /*               p_process_object                                             */
    /*               p_process_group                                              */
    /*               p_paramenter                                                 */
    /*               p_user                                                       */
    /*     Output  : p_work_no                                                    */
    /*                                                                            */
    /* Program History                                                            */
    /*----------------------------------------------------------------------------*/
    /*   Date    In Charge          Description                                   */
    /*----------------------------------------------------------------------------*/
    /******************************************************************************/
    IS
        v_work_man    VARCHAR2(25);
        PRAGMA AUTONOMOUS_TRANSACTION;

    BEGIN

        v_work_man  := 'Logger';

        INSERT INTO tb_adm_batchjoberrorlog
            (batch_job_seq
            ,organization_id
            ,batch_job_process_name
            ,batch_job_object_name
            ,batch_job_status_code
            ,batch_job_remark
            ,worked_by
            ,log_date
            )
        VALUES
            (p_work_no
            ,p_organization_id
            ,p_process_name
            ,p_process_object
            ,'Error'
            ,p_remark
            ,v_work_man
            ,sysdate
            );

        COMMIT;
    EXCEPTION
        WHEN OTHERS THEN
            ROLLBACK;

    END ps_job_errorlog;

/
--------------------------------------------------------
--  DDL for Procedure P_GEN_WORK_CAPA_CALENDAR
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "INFINITY21_JSFMS"."P_GEN_WORK_CAPA_CALENDAR" 
(
  P_DATESET IN DATE 
, P_MACHINE_CODE IN VARCHAR2 
, P_PLAN_START_DATETIME IN DATE
, P_PLAN_END_DATETIME IN DATE
, P_PLAN_TIME IN NUMBER 
, P_PLAN_REST_TIME IN NUMBER
, P_MANAGE_REST_TIME IN NUMBER 
, P_SHIFT_CODE IN VARCHAR2
, P_OUT OUT VARCHAR2
) AS 
BEGIN

DELETE FROM icom_work_capa_calendar WHERE PLAN_DATE = P_DATESET
AND MACHINE_CODE LIKE P_MACHINE_CODE ;

INSERT INTO icom_work_capa_calendar (
    plan_date,
    machine_code,
    plan_start_time,
    plan_end_time,
    plan_time,
    plan_rest_time,
    manage_rest_time,
    load_time,
    shift_code,
    enter_date,
    enter_by,
    last_modify_date,
    last_modify_by,
    organization_id
    )
SELECT  P_DATESET  ,
        machine_code,
        P_PLAN_START_DATETIME,
        P_PLAN_END_DATETIME,
        P_PLAN_TIME plan_time,
        P_PLAN_REST_TIME plan_rest_time,
        P_MANAGE_REST_TIME manage_rest_time,
        P_PLAN_TIME - ( P_PLAN_REST_TIME + P_MANAGE_REST_TIME ) load_time,
        P_SHIFT_CODE shift_code,
        SYSDATE enter_date,
        'SYSTEM' enter_by,
        SYSDATE last_modify_date,
        'SYSTEM' last_modify_by,
        1 organization_id
 FROM ICOM_MACHINE_MASTER 
 WHERE MACHINE_CODE LIKE P_MACHINE_CODE ;
 COMMIT ;

 P_OUT :='OK' ;
 RETURN ;
 EXCEPTION WHEN OTHERS THEN 
   P_OUT :='NG' ;
   RETURN ;
END P_GEN_WORK_CAPA_CALENDAR;

/
--------------------------------------------------------
--  DDL for Procedure P_SET_RECIEVE_DATA_RAW
--------------------------------------------------------
set define off;

  CREATE OR REPLACE EDITIONABLE PROCEDURE "INFINITY21_JSFMS"."P_SET_RECIEVE_DATA_RAW" 
(
  P_MACHINE_DIV IN VARCHAR2 
, P_MACHINE_CODE IN VARCHAR2 
, P_MACHINE_STATUS_DIV IN VARCHAR2 
, P_MACHINE_STATUS_VALUE IN VARCHAR2 
, P_MACHINE_MESSAGE IN VARCHAR2 
, P_MACHINE_DATETIME IN VARCHAR2 
, P_RESULT OUT VARCHAR2 
, P_RESULT_MESSAGE OUT VARCHAR2 
) AS 

LVS_ERROR_MESSAGE VARCHAR2(1000) ;
BEGIN

IF P_MACHINE_MESSAGE IS NULL OR P_MACHINE_DATETIME IS NULL THEN 
           P_RESULT  := 'NG' ;
           P_RESULT_MESSAGE := 'PARAMETOR VALUE MISSING';
           RETURN ;        
END IF ;

     IF P_MACHINE_STATUS_VALUE = '1' THEN 

              INSERT INTO icom_recieve_data_raw (
                machine_div,
                machine_code,
                machine_status_div,
                machine_status_value,
                machine_message,
                machine_datetime,
                comments,
                enter_date,
                enter_by,
                organization_id,
                PLC_CODE ,
                TAG_ADDRESS ,
                ALARM_START_DATETIME ,
                ALARM_END_DATETIME ,
                ALARM_TIME_TERM ,
                PLC_TIMESTAMP ,
                TAG_TYPE ,
                IS_FIXED
            ) VALUES (
                P_MACHINE_DIV,
                P_MACHINE_CODE,
                P_MACHINE_STATUS_DIV,
                P_MACHINE_STATUS_VALUE,
                P_MACHINE_MESSAGE,
                P_MACHINE_DATETIME,
                '',
                SYSDATE,
                'PROCEDURE',
                1 ,
                P_MACHINE_DIV ,
                NULL , --PLC 에서 올라온게 아니면 주소 없음
                TO_DATE( SUBSTR(P_MACHINE_DATETIME ,1,14), 'YYYYMMDDHH24MISS') ,
                NULL ,
                0 ,
                current_timestamp ,
                NULL,
                'N'
            );

        ELSIF P_MACHINE_STATUS_VALUE = '2' THEN 
           --알람 해제가 들어오면 이전 알람에 시간을 업데이트 한다
            UPDATE icom_recieve_data_raw 
               SET ALARM_END_DATETIME    = TO_DATE( SUBSTR(P_machine_datetime ,1,14), 'YYYYMMDDHH24MISS') ,
                   ALARM_TIME_TERM       = (TO_DATE( SUBSTR(P_machine_datetime ,1,14), 'YYYYMMDDHH24MISS') - ALARM_START_DATETIME ) * 24 * 60 , --방생경과시간 분단위
                   IS_FIXED = 'Y'
             WHERE MACHINE_DIV           = P_MACHINE_DIV
               AND MACHINE_CODE          = P_MACHINE_CODE
               AND MACHINE_STATUS_DIV    = P_MACHINE_STATUS_DIV
               AND MACHINE_STATUS_VALUE  = '1' --알람 발생후 해제 안된거
               AND MACHINE_MESSAGE       = P_MACHINE_MESSAGE
               AND ALARM_START_DATETIME <= TO_DATE( SUBSTR(P_MACHINE_DATETIME ,1,14), 'YYYYMMDDHH24MISS') 
               AND IS_FIXED = 'N'
               ;
         ELSE
             NULL ;
        END IF ;
 -------------------------------------------------------------------------------
 --
-------------------------------------------------------------------------------
          COMMIT ;
            P_RESULT  := 'PASS' ;
            RETURN ;

        EXCEPTION 
             WHEN DUP_VAL_ON_INDEX THEN

                P_RESULT  := 'PASS' ;
                RETURN ;    

             WHEN OTHERS THEN 
                LVS_ERROR_MESSAGE := SUBSTR(SQLERRM , 1, 1000) ;
                ROLLBACK;
                P_RESULT  := 'NG' ;
                RETURN ;        
END P_SET_RECIEVE_DATA_RAW;

/
--------------------------------------------------------
--  DDL for Package PKG_DASHBOARD_ITEM_DATA
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE PACKAGE "INFINITY21_JSFMS"."PKG_DASHBOARD_ITEM_DATA" AS   
    -------------------------------------------------------------------------------------------------------------------------------------------------
    -- Section 1: Get Data/Config of Dashboard Items
    -------------------------------------------------------------------------------------------------------------------------------------------------
    -- used in get_dashboard to get config for each item
    FUNCTION GET_ITEM_CONFIG (
        P_IN_IN_ITEM_IDENT   NUMBER,
        P_IN_TYPE_ID         VARCHAR2,
        P_IN_ATTRIBUTE_01    VARCHAR2 := NULL,
        P_IN_ATTRIBUTE_02    VARCHAR2 := NULL,
        P_IN_ATTRIBUTE_03    VARCHAR2 := NULL,
        P_IN_ATTRIBUTE_04    VARCHAR2 := NULL,
        P_IN_ATTRIBUTE_05    VARCHAR2 := NULL
    ) RETURN BLOB;

    -- used in get_dashboard to get data for each item
    FUNCTION GET_ITEM_DATA (
        P_IN_IN_ITEM_IDENT   NUMBER,
        P_IN_TYPE_ID         VARCHAR2,
        P_IN_LOADING_MODE    VARCHAR2 := 'S',
        P_IN_ATTRIBUTE_01    VARCHAR2 := NULL,
        P_IN_ATTRIBUTE_02    VARCHAR2 := NULL,
        P_IN_ATTRIBUTE_03    VARCHAR2 := NULL,
        P_IN_ATTRIBUTE_04    VARCHAR2 := NULL,
        P_IN_ATTRIBUTE_05    VARCHAR2 := NULL
    ) RETURN BLOB;
END;
CREATE OR REPLACE EDITIONABLE PACKAGE BODY "PKG_DASHBOARD_ITEM_DATA" AS   
    -------------------------------------------------------------------------------------------------------------------------------------------------
    -- Section 1: internal functions that created item data and config for item types
    -------------------------------------------------------------------------------------------------------------------------------------------------
    --------------------------------------------------------------------------------------------------------------------
    -- Calendar
    --------------------------------------------------------------------------------------------------------------------
    FUNCTION GET_CALENDAR_ITEM_CONFIG RETURN BLOB AS
        VR_BLOB BLOB := EMPTY_BLOB();
    BEGIN
        SELECT
            JSON_OBJECT (
                 /* optional - set how many events are shown without submenu per day [number] */
                'eventLimitPerDay' VALUE 2,
                /* optional -  set type of the calendar view. Possible Types are dayGridMonth: Month view displays 
                the current month?s days, and usually a few days of the previous and next months, in a table-like format, 
                dayGridWeek: A DayGrid view is a view with one or more columns, each representing a day, 
                timeGridWeek: A TimeGrid view displays one-or-more horizontal days as well as an axis of time and listWeek,
                listMonth, listDay: A list view displays events in a simple vertical list for a specific interval of time [string] */
                'viewType' VALUE 'dayGridMonth',
                /* optional - Set if time is shown or only date [boolean]*/
                'displayTime' VALUE 'true' FORMAT JSON,
                /* optional - Use 12 hours or 24 hours. [boolean] */
                'hours12' VALUE 'false' FORMAT JSON,
                /* optional - Set time of scroll position for timeGridWeek [string] */
                'timeGridStartTime' VALUE '06:00:00'
            RETURNING BLOB )
        INTO VR_BLOB
        FROM
            DUAL;
        RETURN VR_BLOB;
    EXCEPTION
        WHEN OTHERS THEN
            RETURN VR_BLOB;
    END;

    FUNCTION GET_CALENDAR_ITEM_DATA RETURN BLOB AS
        VR_BLOB BLOB := EMPTY_BLOB();
    BEGIN
        SELECT
            JSON_ARRAYAGG(
                JSON_OBJECT(
                /* required - set title for the calendar event [string] */
                'title' VALUE 'Event ' || ROWNUM,
                /* required - set start ts [date] */
                'start' VALUE TRUNC(SYSDATE,'MM') + ROWNUM + ROUND(DBMS_RANDOM.VALUE(1,20)) / 24,
                /* required - set end ts [date] */
                'end' VALUE TRUNC(SYSDATE,'MM') + ROWNUM + ROUND(DBMS_RANDOM.VALUE(21,23)) / 24,
                /* optional - set event color [string] */
                'color' VALUE 'hsl(' || MOD(ROWNUM * 23,350) || ', 79%, 45%)',
                /* optional -  set color of the event text [string] */
                'textColor' VALUE 'white',
                /* optional -  add an url when click on the event [string] */
                'link' VALUE 'https://linktr.ee/ronny.weiss',
                /* optional - set target for the link 
                    _blank - URL is loaded into a new window, or tab. This is default
                    _parent - URL is loaded into the parent frame
                    _self - URL replaces the current page
                    _top - URL replaces any framesets that may be loaded
                    name - The name of the window (Note: the name does not specify the title of the new window)
                */ 
                'linkTarget' VALUE '_blank',
                /* optional -  add details that are shown in tooltip [string] */
                'details' VALUE 'Here are details for event ' || ROWNUM
            RETURNING BLOB)
        RETURNING BLOB)
        INTO VR_BLOB
        FROM
            DUAL
        CONNECT BY
            ROWNUM <= 30;
        RETURN VR_BLOB;
    EXCEPTION
        WHEN OTHERS THEN
            RETURN VR_BLOB;
    END;

    --------------------------------------------------------------------------------------------------------------------
    -- Map
    --------------------------------------------------------------------------------------------------------------------
    FUNCTION GET_MAP_ITEM_CONFIG(P_IN_TOUR_ENABLED NUMBER := NULL) RETURN BLOB AS
        VR_BLOB BLOB := EMPTY_BLOB();
    BEGIN
        SELECT
            JSON_OBJECT(
               /* optional - enable or disable tour [sqlbool (1,0)] */
               'tourEnabled' VALUE NVL(P_IN_TOUR_ENABLED,1),
               /* optional - enable or disable shadow effects for tour [sqlbool (1,0)] */
               'tourShadowEffect' VALUE 1,
               /* optional - set speed of tour [number] */
               'tourSpeed' VALUE 7,
               /* optional - set start rotation of tour [number] */
               'tourStart' VALUE -30,
               /* optional - set direction of tour (left, right) [string] */
               'tourDirection' VALUE 'right',
               /* optional - set default radius of circles [number] */
               'circlesRadius' VALUE NULL,
               /* optional - set default color of circles [number] */
               'circlesColor' VALUE NULL,
               /* optional - set default opacity of circles [number] */
               'circlesOpacity' VALUE NULL,
               /* optional - set default opacity on hover of circles [number] */
               'circlesOpacityHover' VALUE NULL,
               /* optional - set default longitude center of map [number] */
               'mapCenterLongitude' VALUE 0,
               /* optional - set default latitude center of map [number] */
               'mapCenterLatitude' VALUE 0,
               /* optional - enable or disable zoom for map [sqlbool (1,0)] */
               'mapZoomEnabled' VALUE 1,
               /* optional - set default zoom of map [number] */
               'mapInitialZoom' VALUE 1,
               /* optional - set default color of map [string] */
               'mapColor' VALUE DECODE(NVL(P_IN_TOUR_ENABLED,1),1,'black',NULL),
               /* optional - set default color for strokes of map [string] */
               'mapStroke' VALUE DECODE(NVL(P_IN_TOUR_ENABLED,1),1,'white',NULL),
               /* optional - set default width of strokes of map [string] */
               'mapStrokeWidth' VALUE '0.5px',
               /* optional - enable or disable shadow effects for map [sqlbool (1,0)] */
               'mapShadows' VALUE 1
           RETURNING BLOB)
        INTO VR_BLOB
        FROM
            DUAL;
        RETURN VR_BLOB;
    EXCEPTION
        WHEN OTHERS THEN
            RETURN VR_BLOB;
    END;

    FUNCTION GET_MAP_ITEM_DATA RETURN BLOB AS
        VR_BLOB BLOB := EMPTY_BLOB();
    BEGIN
        SELECT
            JSON_ARRAYAGG(
                JSON_OBJECT(
                    /* optional - set radius of circle [number] */
                    'radius' VALUE ROUND(DBMS_RANDOM.VALUE(8,15)),
                    /* optional - set latitude of circle [number] */
                    'latitude' VALUE ROUND(DBMS_RANDOM.VALUE(-60,60)),
                    /* optional - set longitude of circle [number] */
                    'longitude' VALUE ROUND(DBMS_RANDOM.VALUE(-120,120)),
                    /* optional - set color of circle [string] */
                    'color' VALUE 'hsl('||MOD(ROWNUM*23,200)||',55%,60%)',
                    /* optional - add content of tooltip when hover the circle [string] */
                    'tooltip' VALUE 'This is tooltip ' || ROWNUM,
                    /* optional -  add an url when click on the circle [string] */
                    'link' VALUE 'https://linktr.ee/ronny.weiss',
                    /* optional - set target for the link 
                        _blank - URL is loaded into a new window, or tab. This is default
                        _parent - URL is loaded into the parent frame
                        _self - URL replaces the current page
                        _top - URL replaces any framesets that may be loaded
                        name - The name of the window (Note: the name does not specify the title of the new window)
                    */ 
                    'linkTarget' VALUE '_blank'
                RETURNING BLOB)
            RETURNING BLOB)
        INTO VR_BLOB
        FROM
            DUAL CONNECT BY ROWNUM <= 40;
        RETURN VR_BLOB;
    EXCEPTION
        WHEN OTHERS THEN
            RETURN VR_BLOB;
    END;

    --------------------------------------------------------------------------------------------------------------------
    -- Table
    --------------------------------------------------------------------------------------------------------------------
    FUNCTION GET_TABLE_ITEM_DATA RETURN BLOB AS
        VR_BLOB BLOB := EMPTY_BLOB();
    BEGIN
        SELECT
            JSON_OBJECT ( 
                'header' VALUE (SELECT JSON_ARRAYAGG(
                    JSON_OBJECT(
                        /* required - header text [string] */
                        'text' VALUE 'Col ' || ROWNUM,
                        /* optional - header background color [string] */
                        'background' VALUE NULL,
                        /* optional - header text align (left, center, right) [string] */
                        'textAlign' VALUE 'center',
                        /* optional - header font color [string] */
                        'color' VALUE NULL,
                        /* optional - header border style [string] */
                        'border' VALUE NULL
                    RETURNING BLOB)
                RETURNING BLOB) FROM DUAL CONNECT BY ROWNUM <=3),
                'data' VALUE (SELECT
                    JSON_ARRAYAGG(
                        JSON_ARRAY(
                            JSON_OBJECT(
                                /* required - cell text [string] */
                                'text' VALUE ROWNUM,
                                /* optional - cell background color [string] */
                                'background' VALUE null,
                                /* optional - cell text align (left, center, right) [string] */
                                'textAlign' VALUE 'center',
                                /* optional - cell font color [string] */
                                'color' VALUE null,
                                /* optional - cell border style [string] */
                                'border' VALUE null 
                            RETURNING BLOB),
                            JSON_OBJECT(
                                /* required - cell text [string] */
                                'text' VALUE 'This is the text of row ' || ROWNUM,
                                /* optional - cell background color [string] */
                                'background' VALUE null,
                                /* optional - cell text align (left, center, right) [string] */
                                'textAlign' VALUE 'center',
                                /* optional - cell font color [string] */
                                'color' VALUE null,
                                /* optional - cell border style [string] */
                                'border' VALUE null 
                            RETURNING BLOB),
                            JSON_OBJECT(
                                /* required - cell text [string] */
                                'text' VALUE 'This is the text of row ' || ROWNUM,
                                /* optional - cell background color [string] */
                                'background' VALUE null,
                                /* optional - cell text align (left, center, right) [string] */
                                'textAlign' VALUE 'center',
                                /* optional - cell font color [string] */
                                'color' VALUE null,
                                /* optional - cell border style [string] */
                                'border' VALUE null 
                            RETURNING BLOB)
                        RETURNING BLOB)
                    RETURNING BLOB) FROM DUAL CONNECT BY ROWNUM <= 8) 
               RETURNING BLOB)  
            INTO VR_BLOB
            FROM DUAL CONNECT BY ROWNUM <= 13;
        RETURN VR_BLOB;
    EXCEPTION
        WHEN OTHERS THEN
            RETURN VR_BLOB;
    END;

    --------------------------------------------------------------------------------------------------------------------
    -- Clock
    --------------------------------------------------------------------------------------------------------------------
    FUNCTION GET_CLOCK_ITEM_CONFIG RETURN BLOB AS
        VR_BLOB BLOB := EMPTY_BLOB();
    BEGIN
        SELECT
            JSON_OBJECT(
               /* optional - color of the first label e.g. #ff0000 [string] */
               'labelColor' VALUE NULL,
               /* optional - color of the second label e.g. #ff0000 [string] */
               'labelColor2' VALUE NULL,
               /* optional - color of the hours label e.g. #ff0000 [string] */
               'hourLabelColor' VALUE NULL,
               /* optional - color of the hourly ticks e.g. #ff0000 [string] */
               'hourTickColor' VALUE NULL,
               /* optional - color of the seconds ticks e.g. #ff0000 [string] */
               'secondTickColor' VALUE NULL,
               /* optional - color of the hands e.g. #ff0000 [string] */
               'handColor' VALUE NULL,
               /* optional - enable label for seconds [sqlbool (1,0)] */
               'secondLabel' VALUE 0,
               /* optional - circle outer width [number] */
               'circleWidth' VALUE NULL,
               /* optional - circle fill color [string] */
               'circleFillColor' VALUE 'hsl(' || MOD(ROUND(DBMS_RANDOM.VALUE(1,8)) * 32,220) || ', 80%, 70%)',
               /* optional - circle stroke color*/
               'circleColor' VALUE NULL,
               /* optional - hands cover size [number]*/
               'handsCoverSize' VALUE NULL,
               /* optional - hands cover fill color [string] */
               'handCoverFillColor' VALUE NULL,
               /* optional - hands cover stroke color [string] */
               'handCoverStrokeColor' VALUE NULL,
               /* optional - hands color [string] */
               'handColor' VALUE NULL
           RETURNING BLOB)
        INTO VR_BLOB
        FROM
            DUAL;
        RETURN VR_BLOB;
    EXCEPTION
        WHEN OTHERS THEN
            RETURN VR_BLOB;
    END;

    FUNCTION GET_CLOCK_ITEM_DATA RETURN BLOB AS
        VR_BLOB BLOB := EMPTY_BLOB();
    BEGIN
        SELECT
            JSON_OBJECT(
            /* optional - set time of the clock, when omit client time is used [date]*/
            'startDate' VALUE SYSDATE,
            /* optional - set label at the top of the clock [string]*/
            'label' VALUE NULL,
            /* optional - set label at the bottom of the clock [string]*/
            'label2' VALUE NULL
            RETURNING BLOB)
        INTO VR_BLOB
        FROM
            DUAL;
        RETURN VR_BLOB;
    EXCEPTION
        WHEN OTHERS THEN
            RETURN VR_BLOB;
    END;

    --------------------------------------------------------------------------------------------------------------------
    -- Charts
    --------------------------------------------------------------------------------------------------------------------
    FUNCTION GET_CHART_ITEM_CONFIG(P_IN_CHART_TYPE VARCHAR2 := NULL) RETURN BLOB AS
        VR_BLOB BLOB := EMPTY_BLOB();
    BEGIN
        SELECT
            JSON_OBJECT(
               /* optional - set position of axis labels avail. values are inner1, inner2, inner3, outer1, outer2, outer2 */
               'axisLabelPosition' VALUE NULL,
               /* optional - set background of chart grid */
               'background' VALUE NULL,
               /* optional - set chart title */
               'chartTitle' VALUE NULL,
               /* optional - Set min value for gauge chart [number] */
               'gaugeMin' VALUE NULL,
               /* optional - Set max value for gauge chart [number] */
               'gaugeMax' VALUE NULL,
               /* optional - Set type of the gauge (single, multi) [string] */
               'gaugeType' VALUE 'single',
               /* optional - Set width of the gauge [number] */
               'gaugeWidth' VALUE NULL,
               /* optional - Set min width of the gauge arcs [number] */
               'gaugeArcMinWidth' VALUE NULL,
               /* optional - Set if gauge is full circled [sqlbool (1,0)] */
               'gaugeFullCircle' VALUE 0,
               /* optional - Set title in the center of the gauge */
               'gaugeTitle' VALUE NULL,
               /* optional - Set length of transitions [number] */
               'transitionDuration' VALUE NULL,
               /* optional - Set Charts should show absolute values e.g. pie, gauge and donut [sqlbool (1,0)] */
               'showAbsoluteValues' VALUE 0,
               /* optional - Add x grid lines [sqlbool (1,0)] */
               'gridX' VALUE 0,
               /* optional - Add y grid lines [sqlbool (1,0)] */
               'gridY' VALUE 0,
               /* optional - Bottom padding (height) of the x axis [number] */
               'xAxisHeight' VALUE 0,
               /* optional - Add legend to chart [sqlbool (1,0)] */
               'legendShow' VALUE DECODE(P_IN_CHART_TYPE,'gauge',0,1),
               /* optional - Change the position of legend. avail. values are: bottom, right and inset are supported */
               'legendPosition' VALUE DECODE(P_IN_CHART_TYPE,'pie','right','bottom'),
			   /* optional - Set step type for step and area step charts available options are: step, step-after, step-before */
			   'lineStep' VALUE 'step',
               /* optional - Padding on the bottom of chart [number] */
               'paddingBottom' VALUE NULL,
               /* optional - Padding on the left of chart [number] */
               'paddingLeft' VALUE NULL,
               /* optional - Padding on the right of chart [number] */
               'paddingRight' VALUE NULL,
               /* optional - Padding on the top of chart [number] */
               'paddingTop' VALUE NULL,
               /* optional - Rotate y and x axis [sqlbool (1,0)] */
               'rotateAxis' VALUE 0,
               /* optional - Show or hide labels on each data points [sqlbool (1,0)] */
               'showDataLabels' VALUE 0,
               /* optional - Whether to show each point in line [sqlbool (1,0)] */
               'showDataPoints' VALUE 1,
               /* optional - Cut tick text after num of characters [number] */
               'tickCutAfter' VALUE 30,
               /* optional - set threshold ratio to show or hide labels for pie, donut and gauge charts */
               'threshold' VALUE 0.05,
               /* optional - Show or hide tooltip [sqlbool (1,0)] */
               'tooltipShow' VALUE 1,
               /* optional - Set if tooltip is grouped or not for the data points [sqlbool (1,0)] */
               'tooltipGrouped' VALUE 1,
               /* optional - Set if x axis is shown [sqlbool (1,0)] */
               'xShow' VALUE NULL,
               /* optional - Label of the x axis [string] */
               'xLabel' VALUE 'X Axis',
               /* optional - Set type of x axis. avail types are indexed own index is generated, 
               category x values are taken from data set, timeseries dates are taken from data 
               set x.timeFormat has to be set [string] */
               'xType' VALUE 'category',
               /* optional - Set max length of tick text [number] */
               'xTickCutAfter' VALUE NULL,
               /* optional - Set max number of ticks [number] */
               'xTickMaxNumber' VALUE NULL,
               /* optional - Set rotation of ticks [number] */
               'xTickRotation' VALUE NULL,
               /* optional - Set if x tick labels hould auto rotate depending on length and size of chart [sqlbool (1,0)] */
               'xTickAutoRotate' VALUE 1,
               /* optional - Set if ticks are shown single or multiline [sqlbool (1,0)] */
               'xTickMultiline' VALUE NULL,
               /* optional - Set time format of time series x axis default is ts iso, if you want to change it then you have to use 
               JavaScript notation e.g. %Y-%m-%dT%H:%M:%S, when change this format you have to make TO_CHAR in x Value of chart data [string] */
               'xTimeFormat' VALUE NULL,
               /* optional - Set time format of x axis ticks when using time series - in JavaScript notation e.g. "%m-%d %H:%M" [string] */
               'xTickTimeFormat' VALUE NULL,
               /* if true ticks will be positioned according to x value of the data points, if false ticks will be positioned nicely to have same intervals [sqlbool (1,0)] */
               'xTickFit' VALUE 1,
               /* optional - Label of the y axis [string] */
               'yLabel' VALUE 'Y Axis',
               /* optional - Set max range the y axis [number] */
               'yMax' VALUE NULL,
               /* optional - Set min range the y axis [number] */
               'yMin' VALUE NULL,
               /* optional - Enable or disable log scale of y [sqlbool (1,0)] */
               'yLog' VALUE 0,
               /* optional - Add unit to y [string] */
               'yUnit' VALUE NULL,
               /* optional - Set max tick number [string] */
               'yTickMaxNumber' VALUE NULL,
               /* optional - Label of the y2 axis [string] */
               'y2Label' VALUE 'Y2 Axis',
               /* optional - Set max range the y2 axis [number] */
               'y2Max' VALUE NULL,
               /* optional - Set min range the y2 axis [number] */
               'y2Min' VALUE NULL,
               /* optional - Enable or disable log scale of y2 [sqlbool (1,0)] */
               'y2Log' VALUE 0,
               /* optional - Add unit to y2 [string] */
               'y2Unit' VALUE NULL,
               /* optional - Set max tick number [string] */
               'y2TickMaxNumber' VALUE NULL,
               /* optional - Enable or disable zoom [sqlbool (1,0)] */
               'zoomEnabled' VALUE 1,
               /* optional - Set zoom type of chart (subchart, scroll, drag) [string] */
               'zoomType' VALUE 'scroll',
               /* optional - Set if y axis should rescale on zoom [sqlbool (1,0)] */
               'zoomRescale' VALUE 0
        RETURNING BLOB)
        INTO VR_BLOB
        FROM
            DUAL;
        RETURN VR_BLOB;
    EXCEPTION
        WHEN OTHERS THEN
            RETURN VR_BLOB;
    END;

    FUNCTION GET_CHART_ITEM_DATA(P_IN_CHART_TYPE VARCHAR2 := NULL) RETURN BLOB AS
        VR_BLOB BLOB := EMPTY_BLOB();
    BEGIN
        SELECT 
            JSON_ARRAYAGG(
                JSON_OBJECT(
                   /* required - ID that references the series [alphanum] */
                   'seriesID' VALUE 'Series ' || SERIES_ID,
                   /* optional - ID that references the group [alphanum] */
                   'groupID' VALUE 1,
                   /* optional - label of the series [string] */
                   'label' VALUE 'Series ' || SERIES_ID,
                   /* required - set if series is y or y2 axis (y, y2) [string] */
                   'yAxis' VALUE 'y',
                   /* required - type of the chart (bar, line, area, area-spline, bubble, donut, gauge, pie, radar, scatter, spline, step, area-step) [string] */
                   'type' VALUE NVL(P_IN_CHART_TYPE,'area-spline'), 
                   /* optional - link when point of series is clicked [string] */
                   'link' VALUE 'https://linktr.ee/ronny.weiss',
                    /* optional - set target for the link 
                        _blank - URL is loaded into a new window, or tab. This is default
                        _parent - URL is loaded into the parent frame
                        _self - URL replaces the current page
                        _top - URL replaces any framesets that may be loaded
                        name - The name of the window (Note: the name does not specify the title of the new window)
                    */ 
                    'linkTarget' VALUE '_blank',
                   /* optional - color of series e.g #ff0000 [string] */
                   'color' VALUE NULL,
                   /* required - data for x axis [depends on x axis type - number, string, date]*/
                   'x' VALUE X,
                   /* required - data for y axis [number] */
                   'y' VALUE Y * SERIES_ID,
                   /* optional - set a custom tooltip [string] */
                   'tooltip' VALUE NULL
                RETURNING BLOB)
            RETURNING BLOB)
            INTO VR_BLOB
        FROM 
            (
                SELECT
                    'Val ' || ROWNUM AS X,
                    ROUND(
                        DBMS_RANDOM.VALUE(
                            1,
                            100
                        )
                    ) AS Y
                FROM
                    DUAL
                CONNECT BY
                    ROWNUM <= 30
            )
            JOIN (
                SELECT
                    ROWNUM AS SERIES_ID
                FROM
                    DUAL
                CONNECT BY
                    ROWNUM <= 4
            ) SERIES
            ON 1 = 1;
        RETURN VR_BLOB;
    EXCEPTION
        WHEN OTHERS THEN
            RETURN VR_BLOB;
    END;

    --------------------------------------------------------------------------------------------------------------------
    -- Badge
    --------------------------------------------------------------------------------------------------------------------
    FUNCTION GET_BADGE_ITEM_DATA RETURN BLOB AS
        VR_BLOB BLOB := EMPTY_BLOB();
        BEGIN 
             SELECT
                JSON_OBJECT(
                    /* optional - title of the badge [string] */
                   'title' VALUE DECODE(ROUND(DBMS_RANDOM.VALUE(1,4)),1,'Berlin',2,'New York',3,'Hong Kong','Dresden'),
                   /* optional - title color of the badge [string] */
                   'titleColor' VALUE NULL,
                   /* optional - icon of the badge [string] */
                   'icon' VALUE 'fa-sun-o',
                   /* optional - icon color of the badge [string] */
                   'iconColor' VALUE NULL,
                   /* optional - value that is shown [string] */
                   'value' VALUE ROUND(DBMS_RANDOM.VALUE(-10,30))||' °C',
                   /* optional - value color of the badge [string] */
                   'valueColor' VALUE NULL,
                   /* optional - link on click [string] */
                   'link' VALUE 'https://linktr.ee/ronny.weiss',
                    /* optional - set target for the link 
                        _blank - URL is loaded into a new window, or tab. This is default
                        _parent - URL is loaded into the parent frame
                        _self - URL replaces the current page
                        _top - URL replaces any framesets that may be loaded
                        name - The name of the window (Note: the name does not specify the title of the new window)
                    */ 
                    'linkTarget' VALUE '_blank'
                RETURNING BLOB)
                INTO VR_BLOB
            FROM
                DUAL;
              RETURN VR_BLOB;
        EXCEPTION
            WHEN OTHERS THEN
                RETURN VR_BLOB;
        END;

    --------------------------------------------------------------------------------------------------------------------
    -- Card
    --------------------------------------------------------------------------------------------------------------------
    FUNCTION GET_CARD_ITEM_DATA RETURN BLOB AS
        VR_BLOB BLOB := EMPTY_BLOB();
        BEGIN 
             SELECT
                JSON_OBJECT(
                   /* optional - icon of the card [string] */
                   'icon' VALUE DECODE(
                                    ROUND(DBMS_RANDOM.VALUE(1,2)),
                                    1,
                                    'fa-apex',
                                    'https://raw.githubusercontent.com/RonnyWeiss/APEX-Advent-Calendar/master/img/thumb/0' || ROUND(DBMS_RANDOM.VALUE(1,9)) || '.jpg'
                                ),
                   /* optional - set text instead on an icon */
                   'iconText' VALUE NULL,
                   /* optional - icon color of the card [string] */
                   'iconColor' VALUE 'white',
                   /* optional - background color of the card [string] */
                   'iconBackColor' VALUE NULL,
                   /* optional - value that is shown [string] */
                   'value' VALUE ROUND(DBMS_RANDOM.VALUE(80,90))||' %',
                   /* optional - small value below value that is shown [string] */
                   'valueSmall' VALUE 'This is a smaller Text',
                   /* optional - footer text [string] */
                   'footer' VALUE 'This is a Dashboard KPI Card.',
                   /* optional - link on click [string] */
                   'link' VALUE 'https://linktr.ee/ronny.weiss',
                    /* optional - set target for the link 
                        _blank - URL is loaded into a new window, or tab. This is default
                        _parent - URL is loaded into the parent frame
                        _self - URL replaces the current page
                        _top - URL replaces any framesets that may be loaded
                        name - The name of the window (Note: the name does not specify the title of the new window)
                    */ 
                    'linkTarget' VALUE '_blank'
                RETURNING BLOB)
                INTO VR_BLOB
            FROM
                DUAL;
              RETURN VR_BLOB;
        EXCEPTION
            WHEN OTHERS THEN
                RETURN VR_BLOB;
        END;

    --------------------------------------------------------------------------------------------------------------------
    -- List
    --------------------------------------------------------------------------------------------------------------------
    FUNCTION GET_LIST_ITEM_DATA RETURN BLOB AS
        VR_BLOB BLOB := EMPTY_BLOB();
        BEGIN 
             SELECT
                JSON_ARRAYAGG(
                    JSON_OBJECT(
                        /* optional - title of the list item [string] */
                        'title' VALUE 'List item ' || ROWNUM,
                        /* optional - group list items with group id [string] */
                        'group' VALUE NULL,
                        /* optional - font-color of the group [string] */
                        'groupColor' VALUE 'inerhit',
                        /* optional - color of the group [string] */
                        'groupBackColor' VALUE NULL,
                        /* optional - text of the list item [string] */
                        'text' VALUE 'This is a list item (Font-APEX or images)',
                        /* optional - icon of the card [string] */
                        'icon' VALUE 'fa-apex',
                        /* optional - set text instead of an icon [string] */
                        'iconText' VALUE NULL,
                        /* optional - icon color of the card [string] */
                        'iconColor' VALUE 'white',
                        /* optional - background color of the card [string] */
                        'iconBackColor' VALUE NULL,
                        /* optional - link when click on list item [string] */
                        'link' VALUE 'https://linktr.ee/ronny.weiss',
                        /* optional - set target for the link 
                            _blank - URL is loaded into a new window, or tab. This is default
                            _parent - URL is loaded into the parent frame
                            _self - URL replaces the current page
                            _top - URL replaces any framesets that may be loaded
                            name - The name of the window (Note: the name does not specify the title of the new window)
                        */ 
                        'linkTarget' VALUE '_blank'
                    RETURNING BLOB) 
                RETURNING BLOB)
                INTO VR_BLOB
            FROM
                DUAL
            CONNECT BY
                ROWNUM <= 6;
              RETURN VR_BLOB;
        EXCEPTION
            WHEN OTHERS THEN
                RETURN VR_BLOB;
        END;

    --------------------------------------------------------------------------------------------------------------------
    -- Short Note
    --------------------------------------------------------------------------------------------------------------------
    FUNCTION GET_NOTE_ITEM_DATA(P_IN_IN_ITEM_IDENT NUMBER) RETURN BLOB AS
        VR_BLOB BLOB := EMPTY_BLOB();
    BEGIN
        SELECT
            JSON_OBJECT ( 
                 /* optional - value of the note editor [string] */
                'text' VALUE ATTRIBUTE_01_C RETURNING BLOB )
        INTO VR_BLOB
        FROM
            T_DASHBOARD_ITEMS
        WHERE ITEM_IDENT = P_IN_IN_ITEM_IDENT;
        RETURN VR_BLOB;
    EXCEPTION
        WHEN OTHERS THEN
            RETURN VR_BLOB;
    END;

    --------------------------------------------------------------------------------------------------------------------
    -- HTML
    --------------------------------------------------------------------------------------------------------------------
    FUNCTION GET_HTML_ITEM_DATA(P_IN_SAMPLE_TYPE VARCHAR2 := NULL) RETURN BLOB AS
        VR_BLOB BLOB := EMPTY_BLOB();
    BEGIN
        CASE 
            WHEN P_IN_SAMPLE_TYPE = 'iframe' THEN
                SELECT
                    JSON_ARRAY(
                        JSON_OBJECT(
                            /* required - html for the frame [string] */
                            'html' VALUE '<iframe style="width:100%;border:none;height:290px" src="https://www.youtube.com/embed/vqz8c4ZP3Wg"></iframe>',
                            /* required - set duration after next slide is loaded [number] */
                            'duration' VALUE 20
                        RETURNING BLOB),
                        JSON_OBJECT(
                            /* required - html for the frame [string] */
                            'html' VALUE '<iframe style="width:100%;border:none;height:290px" src="https://www.youtube.com/embed/o2hOoQmy1CU"></iframe>',
                            /* required - set duration after next slide is loaded [number] */
                            'duration' VALUE 20
                        RETURNING BLOB)
                    RETURNING BLOB)
                INTO VR_BLOB
                FROM
                    DUAL;
            WHEN P_IN_SAMPLE_TYPE = 'diashow' THEN
                SELECT
                    JSON_ARRAYAGG(
                        JSON_OBJECT(
                            /* required - html for the frame [string] */
                            'html' VALUE '<div style="width:100%;height:100%;background-size:cover;background-position:center;' ||
                                         'background-size:cover;background-repeat:no-repeat;background-image:' ||
                                         'url(' || V('APP_IMAGES') ||
                                         '0' || ROWNUM || '.jpg)"></div>',
                            /* required - set duration after next slide is loaded [number] */
                            'duration' VALUE 5
                        RETURNING BLOB)
                    RETURNING BLOB)
                INTO VR_BLOB
                FROM
                    DUAL CONNECT BY ROWNUM <= 6;
            WHEN P_IN_SAMPLE_TYPE like 'ac%' THEN
                SELECT
                    JSON_ARRAYAGG(
                        JSON_OBJECT(
                            /* required - html for the frame [string] */
                            'html' VALUE '<iframe style="width:100%;border:none;height:100%" src="' || APEX_PAGE.GET_URL(P_PAGE => 6, P_ITEMS  => 'P6_TYPE', P_VALUES => SUBSTR(P_IN_SAMPLE_TYPE,3)) || '"></iframe>'
                        RETURNING BLOB)
                    RETURNING BLOB)
                INTO VR_BLOB
                FROM
                    DUAL;
            ELSE
                SELECT
                    JSON_ARRAY(
                        JSON_OBJECT(
                            /* required - html for the frame [string] */
                            'html' VALUE '<p><strong>Hello Wolrd<br /></strong></p>' ||
                                         '<p><strong>In this Item you can load HTML, iFrames, Video any many more</strong></p>' ||
                                         '<span aria-hidden="true" class="fa fa-emoji-sweet-smile fa-lg"></span>'
                        RETURNING BLOB)
                    RETURNING BLOB)
                INTO VR_BLOB
                FROM
                    DUAL;
            END CASE;
        RETURN VR_BLOB;
    EXCEPTION
        WHEN OTHERS THEN
            RETURN VR_BLOB;
    END;

    -------------------------------------------------------------------------------------------------------------------------------------------------
    -- Section 2: Public Functions to Get Data/Config of Dashboard Items
    -------------------------------------------------------------------------------------------------------------------------------------------------
    -- used in get_dashboard to get config for each item
    FUNCTION GET_ITEM_CONFIG (
        P_IN_IN_ITEM_IDENT   NUMBER,
        P_IN_TYPE_ID         VARCHAR2,
        P_IN_ATTRIBUTE_01    VARCHAR2 := NULL,
        P_IN_ATTRIBUTE_02    VARCHAR2 := NULL,
        P_IN_ATTRIBUTE_03    VARCHAR2 := NULL,
        P_IN_ATTRIBUTE_04    VARCHAR2 := NULL,
        P_IN_ATTRIBUTE_05    VARCHAR2 := NULL
    ) RETURN BLOB AS
    BEGIN
        CASE
            WHEN P_IN_TYPE_ID = 'calendar' THEN
                RETURN GET_CALENDAR_ITEM_CONFIG;
            WHEN P_IN_TYPE_ID = 'clock' THEN
                RETURN GET_CLOCK_ITEM_CONFIG;
            WHEN P_IN_TYPE_ID = 'chart' THEN
                RETURN GET_CHART_ITEM_CONFIG(P_IN_CHART_TYPE => P_IN_ATTRIBUTE_01);
            WHEN P_IN_TYPE_ID = 'map' THEN
                RETURN GET_MAP_ITEM_CONFIG(P_IN_TOUR_ENABLED => P_IN_ATTRIBUTE_01);
            ELSE
                RETURN NULL;
        END CASE;
    END;

    -- used in get_dashboard to get data for each item
    FUNCTION GET_ITEM_DATA (
        P_IN_IN_ITEM_IDENT   NUMBER,
        P_IN_TYPE_ID         VARCHAR2,
        P_IN_LOADING_MODE    VARCHAR2 := 'S',
        P_IN_ATTRIBUTE_01    VARCHAR2 := NULL,
        P_IN_ATTRIBUTE_02    VARCHAR2 := NULL,
        P_IN_ATTRIBUTE_03    VARCHAR2 := NULL,
        P_IN_ATTRIBUTE_04    VARCHAR2 := NULL,
        P_IN_ATTRIBUTE_05    VARCHAR2 := NULL
    ) RETURN BLOB AS
    BEGIN
        CASE 
            WHEN P_IN_LOADING_MODE = 'S' AND P_IN_TYPE_ID IN ('chart', 'calendar') THEN
                RETURN NULL;
            WHEN P_IN_TYPE_ID = 'calendar' THEN
                RETURN GET_CALENDAR_ITEM_DATA;
            WHEN P_IN_TYPE_ID = 'list' THEN
                RETURN GET_LIST_ITEM_DATA;
            WHEN P_IN_TYPE_ID = 'clock' THEN
                RETURN GET_CLOCK_ITEM_DATA;
            WHEN P_IN_TYPE_ID = 'note' THEN
                RETURN GET_NOTE_ITEM_DATA(P_IN_IN_ITEM_IDENT => P_IN_IN_ITEM_IDENT);
            WHEN P_IN_TYPE_ID = 'chart' THEN
                RETURN GET_CHART_ITEM_DATA(P_IN_CHART_TYPE => P_IN_ATTRIBUTE_01);
            WHEN P_IN_TYPE_ID = 'badge' THEN
                RETURN GET_BADGE_ITEM_DATA;
            WHEN P_IN_TYPE_ID = 'card' THEN
                RETURN GET_CARD_ITEM_DATA;
            WHEN P_IN_TYPE_ID = 'map' THEN
                RETURN GET_MAP_ITEM_DATA;
            WHEN P_IN_TYPE_ID = 'table' THEN
                RETURN GET_TABLE_ITEM_DATA;
            WHEN P_IN_TYPE_ID = 'html' THEN
                RETURN GET_HTML_ITEM_DATA(P_IN_SAMPLE_TYPE => P_IN_ATTRIBUTE_01);
            ELSE
                RETURN NULL;
        END CASE;
    END;
END;

/
--------------------------------------------------------
--  DDL for Package PKG_DASHBOARD_MGMT
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE PACKAGE "INFINITY21_JSFMS"."PKG_DASHBOARD_MGMT" AS    
    -------------------------------------------------------------------------------------------------------------------------------------------------
    -- Section 1: Execute Dashboard
    -------------------------------------------------------------------------------------------------------------------------------------------------
    -- used to get dashboard data for different modes
    FUNCTION GET_DASHBOARD (
        P_IN_DASHBOARD_IDENT   NUMBER,
        P_IN_LOADING_MODE      VARCHAR2 := 'S',
        P_IN_ITEM_IDENT        NUMBER := NULL
    ) RETURN BLOB;

    -------------------------------------------------------------------------------------------------------------------------------------------------
    -- Section 2: Edit Dashboard (Create, Edit or Delete Dashboards and Items
    -------------------------------------------------------------------------------------------------------------------------------------------------
    PROCEDURE ADD_ITEM (
        P_IN_DASHBOARD_IDENT     NUMBER,
        P_IN_TYPE_ID             VARCHAR2,
        P_IN_ITEM_TITLE          VARCHAR2,
        P_IN_ITEM_WIDTH          NUMBER,
        P_IN_ITEM_HEIGHT         NUMBER,
        P_IN_ITEM_ORDER_NUMBER   NUMBER,
        P_IN_ATTRIBUTE_01        VARCHAR2 := NULL,
        P_IN_ATTRIBUTE_02        VARCHAR2 := NULL,
        P_IN_ATTRIBUTE_03        VARCHAR2 := NULL,
        P_IN_ATTRIBUTE_04        VARCHAR2 := NULL,
        P_IN_ATTRIBUTE_05        VARCHAR2 := NULL
    );

    PROCEDURE EDIT_ITEM (
        P_IN_ITEM_IDENT          NUMBER,
        P_IN_TYPE_ID             VARCHAR2,
        P_IN_ITEM_TITLE          VARCHAR2,
        P_IN_ITEM_WIDTH          NUMBER,
        P_IN_ITEM_HEIGHT         NUMBER,
        P_IN_ITEM_ORDER_NUMBER   NUMBER,
        P_IN_ATTRIBUTE_01        VARCHAR2 := NULL,
        P_IN_ATTRIBUTE_02        VARCHAR2 := NULL,
        P_IN_ATTRIBUTE_03        VARCHAR2 := NULL,
        P_IN_ATTRIBUTE_04        VARCHAR2 := NULL,
        P_IN_ATTRIBUTE_05        VARCHAR2 := NULL
    );
    PROCEDURE DELETE_ITEM (
        P_IN_ITEM_IDENT NUMBER
    );

    PROCEDURE STORE_NEW_ITEM_ORDER (
        P_IN_DASHBOARD_IDENT   NUMBER,
        P_IN_ITEMS             VARCHAR
    );

END;
CREATE OR REPLACE EDITIONABLE PACKAGE BODY "PKG_DASHBOARD_MGMT" AS
    -------------------------------------------------------------------------------------------------------------------------------------------------
    -- Section 1: Execute Dashboard
    -------------------------------------------------------------------------------------------------------------------------------------------------

    -- used to get dashboard data for different modes
    FUNCTION GET_DASHBOARD (
        P_IN_DASHBOARD_IDENT   NUMBER,
        P_IN_LOADING_MODE      VARCHAR2 := 'S',
        P_IN_ITEM_IDENT        NUMBER := NULL
    ) RETURN BLOB AS
        B_BINARY_JSON   BLOB := EMPTY_BLOB();
        B_COMMA         CONSTANT BLOB := UTL_RAW.CAST_TO_RAW(',');
        I               PLS_INTEGER := 0;
    BEGIN
        DBMS_LOB.CREATETEMPORARY(
            LOB_LOC   => B_BINARY_JSON,
            CACHE     => TRUE,
            DUR       => DBMS_LOB.CALL
        );
        FOR REC IN (
            SELECT
                ITEMS.*,
                COUNT(*) OVER() AS ITEMS_COUNT
            FROM
                (
                    SELECT
                        JSON_OBJECT (
                            /* required - ID of each item that is needed for async load and resort */
                            'itemID' VALUE TDI.ITEM_IDENT, 
                            /* required -  type of the item e.g. chart or calendar */
                            'itemType' VALUE TDI.TYPE_ID,
                            /* optional - title of the dashboard item */
                            'title' VALUE TDI.ITEM_TITLE,
                            /* optional - set background color of dashboard item */
                            'backColor' VALUE NULL, 
                            /* optional - set a background color for the item title */
                            'titleBackColor' VALUE NULL,
                            /* optional - set a icon for the item title */
                            'titleIcon' VALUE NULL, 
                            /* optional - set a color for the item title */
                            'titleColor' VALUE NULL,
                            /* optional - set width of the item between 1 and 12 */
                            'colSpan' VALUE TDI.ITEM_WIDTH,
                            /* optional - set height of the item */
                            'height' VALUE ( TDI.ITEM_HEIGHT * 90 ),
                            /* optional - set if the item is marked */
                            'isMarked' VALUE NULL,
                            /* optional - set if the item has auto refresh (Only for async items) */
                            'refresh' VALUE NULL,
                            /* optional - set if the item is loaded async */
                            'isAsync' VALUE CASE WHEN TDI.TYPE_ID IN ('chart', 'calendar') THEN 1 ELSE 0 END,
                            /* optional - set an url for the options link */
                            'optionsLink' VALUE APEX_PAGE.GET_URL(
                                P_PAGE     => 3,
                                P_ITEMS    => 'P3_ITEM_IDENT',
                                P_VALUES   => TDI.ITEM_IDENT
                            ),
                            /* optional - set icon for the options link */
                            'optionsLinkIcon' VALUE 'fa-edit',
                            /* optional - set background color for the options link */
                            'optionsLinkBackColor' VALUE NULL,
                            /* optional - set color for the options link */
                            'optionsLinkColor' VALUE NULL,
                            /* optional - set an url for the options link top */
                            'optionsLinkTop' VALUE NULL,
                            /* optional - set icon for the options link top */
                            'optionsLinkTopIcon' VALUE 'fa-edit',
                            /* optional - set background color for the options link top */
                            'optionsLinkTopBackColor' VALUE NULL,
                            /* optional - set color for the options link top */
                            'optionsLinkTopColor' VALUE NULL,
                            /* optional - when using sanitizer and want to exclude the item from sanitizing then set this 1 */
                            'noSanitize' VALUE NULL,
                            /* optional - here is the item config loaded */
                            'itemConfig' VALUE PKG_DASHBOARD_ITEM_DATA.GET_ITEM_CONFIG(
                                P_IN_IN_ITEM_IDENT => TDI.ITEM_IDENT,
                                P_IN_TYPE_ID => TDI.TYPE_ID,
                                P_IN_ATTRIBUTE_01 => TDI.ATTRIBUTE_01,
                                P_IN_ATTRIBUTE_02 => TDI.ATTRIBUTE_02,
                                P_IN_ATTRIBUTE_03 => TDI.ATTRIBUTE_03,
                                P_IN_ATTRIBUTE_04 => TDI.ATTRIBUTE_04,
                                P_IN_ATTRIBUTE_05 => TDI.ATTRIBUTE_05
                            ) FORMAT JSON,
                            /* optional - here is the item data loaded */
                            'itemData' VALUE PKG_DASHBOARD_ITEM_DATA.GET_ITEM_DATA(
                                P_IN_IN_ITEM_IDENT => TDI.ITEM_IDENT,
                                P_IN_TYPE_ID => TDI.TYPE_ID,
                                P_IN_LOADING_MODE => P_IN_LOADING_MODE,
                                P_IN_ATTRIBUTE_01 => TDI.ATTRIBUTE_01,
                                P_IN_ATTRIBUTE_02 => TDI.ATTRIBUTE_02,
                                P_IN_ATTRIBUTE_03 => TDI.ATTRIBUTE_03,
                                P_IN_ATTRIBUTE_04 => TDI.ATTRIBUTE_04,
                                P_IN_ATTRIBUTE_05 => TDI.ATTRIBUTE_05
                            ) FORMAT JSON 
                        RETURNING BLOB ) AS JSON_BLOB
                    FROM
                        T_DASHBOARD_ITEMS TDI
                    WHERE
                        TDI.DASHBOARD_IDENT = P_IN_DASHBOARD_IDENT
                        AND (TDI.ITEM_IDENT = P_IN_ITEM_IDENT
                            OR P_IN_ITEM_IDENT IS NULL)
                    ORDER BY
                        TDI.ITEM_ORDER_NUMBER
                ) ITEMS
        ) LOOP
            I := I + 1;
            DBMS_LOB.APPEND(
                B_BINARY_JSON,
                REC.JSON_BLOB
            );
                -- exit when it's the last item and don't add a comma at the end
            IF I = REC.ITEMS_COUNT THEN
                EXIT;
            ELSE
                DBMS_LOB.APPEND(
                    B_BINARY_JSON,
                    B_COMMA
                );
            END IF;
        END LOOP;
        RETURN B_BINARY_JSON;
    END;

    -------------------------------------------------------------------------------------------------------------------------------------------------
    -- Section 2: Edit Dashboard (Create, Edit or Delete Dashboards and Items
    -------------------------------------------------------------------------------------------------------------------------------------------------
    -- add a new dashboard item
    PROCEDURE ADD_ITEM (
        P_IN_DASHBOARD_IDENT     NUMBER,
        P_IN_TYPE_ID             VARCHAR2,
        P_IN_ITEM_TITLE          VARCHAR2,
        P_IN_ITEM_WIDTH          NUMBER,
        P_IN_ITEM_HEIGHT         NUMBER,
        P_IN_ITEM_ORDER_NUMBER   NUMBER,
        P_IN_ATTRIBUTE_01        VARCHAR2 := NULL,
        P_IN_ATTRIBUTE_02        VARCHAR2 := NULL,
        P_IN_ATTRIBUTE_03        VARCHAR2 := NULL,
        P_IN_ATTRIBUTE_04        VARCHAR2 := NULL,
        P_IN_ATTRIBUTE_05        VARCHAR2 := NULL
    ) AS
    BEGIN
        INSERT INTO T_DASHBOARD_ITEMS (
            DASHBOARD_IDENT,
            TYPE_ID,
            ITEM_TITLE,
            ITEM_WIDTH,
            ITEM_HEIGHT,
            ITEM_ORDER_NUMBER,
            ATTRIBUTE_01,
            ATTRIBUTE_02,
            ATTRIBUTE_03,
            ATTRIBUTE_04,
            ATTRIBUTE_05
        ) VALUES (
            P_IN_DASHBOARD_IDENT,
            P_IN_TYPE_ID,
            P_IN_ITEM_TITLE,
            P_IN_ITEM_WIDTH,
            P_IN_ITEM_HEIGHT,
            P_IN_ITEM_ORDER_NUMBER,
            P_IN_ATTRIBUTE_01,
            P_IN_ATTRIBUTE_02,
            P_IN_ATTRIBUTE_03,
            P_IN_ATTRIBUTE_04,
            P_IN_ATTRIBUTE_05
        );
    END;
    -- edit a dashboard item
    PROCEDURE EDIT_ITEM (
        P_IN_ITEM_IDENT          NUMBER,
        P_IN_TYPE_ID             VARCHAR2,
        P_IN_ITEM_TITLE          VARCHAR2,
        P_IN_ITEM_WIDTH          NUMBER,
        P_IN_ITEM_HEIGHT         NUMBER,
        P_IN_ITEM_ORDER_NUMBER   NUMBER,
        P_IN_ATTRIBUTE_01        VARCHAR2 := NULL,
        P_IN_ATTRIBUTE_02        VARCHAR2 := NULL,
        P_IN_ATTRIBUTE_03        VARCHAR2 := NULL,
        P_IN_ATTRIBUTE_04        VARCHAR2 := NULL,
        P_IN_ATTRIBUTE_05        VARCHAR2 := NULL
    ) AS
    BEGIN
        UPDATE T_DASHBOARD_ITEMS
        SET
            TYPE_ID = P_IN_TYPE_ID,
            ITEM_TITLE = P_IN_ITEM_TITLE,
            ITEM_WIDTH = P_IN_ITEM_WIDTH,
            ITEM_HEIGHT = P_IN_ITEM_HEIGHT,
            ITEM_ORDER_NUMBER = P_IN_ITEM_ORDER_NUMBER,
            ATTRIBUTE_01 = P_IN_ATTRIBUTE_01,
            ATTRIBUTE_02 = P_IN_ATTRIBUTE_02,
            ATTRIBUTE_03 = P_IN_ATTRIBUTE_03,
            ATTRIBUTE_04 = P_IN_ATTRIBUTE_04,
            ATTRIBUTE_05 = P_IN_ATTRIBUTE_05
        WHERE
            ITEM_IDENT = P_IN_ITEM_IDENT;
    END;
    -- delete a dashboard item
    PROCEDURE DELETE_ITEM (
        P_IN_ITEM_IDENT NUMBER
    ) AS
    BEGIN
        DELETE FROM T_DASHBOARD_ITEMS
        WHERE
            ITEM_IDENT = P_IN_ITEM_IDENT;
    END;

    PROCEDURE STORE_NEW_ITEM_ORDER (
        P_IN_DASHBOARD_IDENT   NUMBER,
        P_IN_ITEMS             VARCHAR
    ) AS
    BEGIN
        FOR REC IN (
            SELECT
                COLUMN_VALUE AS ITEM_IDENT,
                ROWNUM AS ITEM_ORDER_NUMBER
            FROM
                TABLE ( APEX_STRING.SPLIT(
                    P_IN_ITEMS,
                    ':'
                ) )
        ) LOOP
            UPDATE T_DASHBOARD_ITEMS
            SET
                ITEM_ORDER_NUMBER = REC.ITEM_ORDER_NUMBER
            WHERE
                ITEM_IDENT = REC.ITEM_IDENT
                AND DASHBOARD_IDENT = P_IN_DASHBOARD_IDENT;
        END LOOP;
    END;
END;

/
--------------------------------------------------------
--  DDL for Function F_GEN_ALRAM_STATUS_ICON
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE FUNCTION "INFINITY21_JSFMS"."F_GEN_ALRAM_STATUS_ICON" (P_STATUS IN VARCHAR2 )
RETURN VARCHAR2
DETERMINISTIC
AS 
LVS_RETURN VARCHAR2(4000) ;
BEGIN
   SELECT
     CASE UPPER( COALESCE(P_STATUS, ' '))
    WHEN 'AS'     
    THEN   'fa-stop-circle fa-lg'
    WHEN 'MS'
        THEN 'fa-hand-stop-o fa-lg'
    WHEN 'SF'
        THEN 'fa-heartbeat fa-lg " style="color:blue'
    WHEN 'ST'
        THEN 'fa-times-square fa-lg " style="color:red'
    WHEN 'WN'
        THEN 'fa-warning fa-lg " style="color:green'
    END AS STATUS_ICON
   INTO LVS_RETURN 
   FROM DUAL ;
   RETURN LVS_RETURN ; 
END;

/
--------------------------------------------------------
--  DDL for Function F_GET_ALARM_MSG_BY_ADDRESS
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE FUNCTION "INFINITY21_JSFMS"."F_GET_ALARM_MSG_BY_ADDRESS" 
(
  P_PLC_CODE IN VARCHAR2 
, P_MACHINE_CODE IN VARCHAR2 
, P_TAG_ADDRESS IN VARCHAR2 
) RETURN VARCHAR2 AS 

LVS_RETURN VARCHAR2(1000) ;
BEGIN

  SELECT MAX(TAG_NAME )
    INTO LVS_RETURN 
    FROM VIEW_ALARM_CODE_MASTER 
   WHERE PLC_CODE = P_PLC_CODE 
   --  AND MACHINE_CODE = P_MACHINE_CODE
     AND TAG_ADDRESS = P_TAG_ADDRESS ;

  RETURN NVL(LVS_RETURN , P_TAG_ADDRESS||' '||P_PLC_CODE||' [NOT FOUND]' );

  EXCEPTION WHEN OTHERS THEN 
    RETURN P_TAG_ADDRESS||' '||P_PLC_CODE||' [NOT FOUND]' ;

END F_GET_ALARM_MSG_BY_ADDRESS;

/
--------------------------------------------------------
--  DDL for Function F_GET_BASECODE_MASTER
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE FUNCTION "INFINITY21_JSFMS"."F_GET_BASECODE_MASTER" 
(
  P_CODE_TYPE IN VARCHAR2 
, P_CODE_NAME IN VARCHAR2 
) RETURN VARCHAR2 AS 

LVS_RETURN VARCHAR2(100) ;
BEGIN

  SELECT CODE_MEAN_KOR 
    INTO LVS_RETURN
    FROM ISYS_BASECODE_MASTER
   WHERE CODE_TYPE = P_CODE_TYPE
     AND CODE_NAME = P_CODE_NAME ;

  RETURN LVS_RETURN;

  EXCEPTION WHEN OTHERS THEN 
     RETURN P_CODE_NAME ;
END F_GET_BASECODE_MASTER;

/
--------------------------------------------------------
--  DDL for Function F_GET_LAST_ACTUAL_QTY
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE FUNCTION "INFINITY21_JSFMS"."F_GET_LAST_ACTUAL_QTY" 
(
  P_MACHINE_CODE IN VARCHAR2 
) RETURN NUMBER AS 

LVS_RETURN VARCHAR2(10) ;

BEGIN

     SELECT MAX(TAG_VALUE) 
       INTO LVS_RETURN  
       FROM VIEW_OPERATION_DATA_RAW
      WHERE OPERATION_DATETIME >= TRUNC(SYSDATE)
        AND OPERATION_DATETIME < TRUNC(SYSDATE +1)
        AND MACHINE_CODE LIKE P_MACHINE_CODE
        AND TAG_VALUE > '0' 
        AND TAG_TYPE ='PA' ;

        RETURN TO_NUMBER(LVS_RETURN) ;

END F_GET_LAST_ACTUAL_QTY;

/
--------------------------------------------------------
--  DDL for Function F_GET_LAST_ALARM_BY_TYPE
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE FUNCTION "INFINITY21_JSFMS"."F_GET_LAST_ALARM_BY_TYPE" 
(
  P_TYPE IN VARCHAR2 
) RETURN VARCHAR2 AS 

LVS_RETURN VARCHAR2(1000) ;
-------------------------------------------------
-- P_TYPE :  경고 (PLC), 정지(PLC), 안전 (PLC / PRAICAM)
-- 경고와 정지는 PLC 알람에서 가져옴.
-- 전체범위의 데이터에서 가져오게 되어있는데 나중에 당일로 
-- 범위를 제한할지 경정해서 조건절에 추가할것.
-------------------------------------------------
BEGIN

    IF P_TYPE = 'WARNING' OR P_TYPE = '경고' THEN 
        BEGIN
            SELECT MACHINE_DATETIME||' : '||MACHINE_MESSAGE AS LAST_MSG
                INTO LVS_RETURN
                FROM
                  (
                   SELECT MACHINE_MESSAGE ,
                          TO_DATE( SUBSTR(MACHINE_DATETIME,1,10) , 'YYYYMMDDHH24MISS') AS MACHINE_DATETIME
                    FROM VIEW_ALARM_DATA_RAW
                   WHERE MACHINE_DIV = 'PLC'
                     AND MACHINE_STATUS_DIV = 'ALARM'
                     AND MACHINE_STATUS_VALUE = '1'
                     AND TAG_CLASS = 'WN'
                     AND MACHINE_DATETIME >= TO_CHAR(SYSDATE  , 'YYYYMMDD')||'080000'
                     ORDER BY ALARM_DATETIME DESC --등록일자 기준 최신데이터
                   )
                   WHERE ROWNUM = 1 ;

           EXCEPTION WHEN NO_DATA_FOUND THEN 
                RETURN 'None' ;
           END ;    

    ELSIF P_TYPE = 'STOP' OR P_TYPE = '정지' THEN 
         BEGIN
                 SELECT MACHINE_DATETIME||' : '||MACHINE_MESSAGE AS LAST_MSG
                INTO LVS_RETURN
                FROM
                  (
                   SELECT MACHINE_MESSAGE ,
                          TO_DATE( SUBSTR(MACHINE_DATETIME,1,10) , 'YYYYMMDDHH24MISS') AS MACHINE_DATETIME
                    FROM VIEW_ALARM_DATA_RAW
                   WHERE MACHINE_DIV = 'PLC'
                     AND MACHINE_STATUS_DIV = 'ALARM'
                     AND MACHINE_STATUS_VALUE = '1'
                     AND TAG_CLASS = 'ST'
                     AND MACHINE_DATETIME >= TO_CHAR(SYSDATE  , 'YYYYMMDD')||'080000'
                     ORDER BY ALARM_DATETIME DESC --등록일자 기준 최신데이터
                   )
                   WHERE ROWNUM = 1 ;

                EXCEPTION WHEN NO_DATA_FOUND THEN 
                RETURN 'None' ;
           END ;                

    ELSIF P_TYPE = 'SAFETY' OR P_TYPE = '안전'  THEN 

          BEGIN
                 SELECT MACHINE_DATETIME||' : '||MACHINE_MESSAGE AS LAST_MSG
                INTO LVS_RETURN
                FROM
                  (
                   SELECT MACHINE_MESSAGE ,
                          TO_DATE( SUBSTR(MACHINE_DATETIME,1,10) , 'YYYYMMDDHH24MISS') AS MACHINE_DATETIME
                    FROM VIEW_ALARM_DATA_RAW
                   WHERE MACHINE_DIV = 'PLC'
                     AND MACHINE_STATUS_DIV = 'ALARM'
                     AND MACHINE_STATUS_VALUE = '1'
                     AND TAG_CLASS = 'SF'
                     AND MACHINE_DATETIME >= TO_CHAR(SYSDATE , 'YYYYMMDD')||'080000' 
                     ORDER BY ALARM_DATETIME DESC --등록일자 기준 최신데이터
                   )
                   WHERE ROWNUM = 1 ;

                EXCEPTION WHEN NO_DATA_FOUND THEN 
                RETURN 'None' ;
           END ;                

--        ---------------------------------------------------------------------
--        -- PARICAM 은 MACHINE_STATUS_DIV 가 ALARM 인경우 전부 안전 알람으로 판단.
--        ---------------------------------------------------------------------
--        BEGIN 
--              SELECT MACHINE_DATETIME||' : '||MACHINE_MESSAGE AS LAST_MSG
--                INTO LVS_RETURN
--                FROM
--                  (
--                   SELECT MACHINE_MESSAGE ,
--                          TO_DATE( SUBSTR(MACHINE_DATETIME,1,10) , 'YYYYMMDDHH24MISS') AS MACHINE_DATETIME
--                    FROM VIEW_ALARM_DATA_RAW
--                   WHERE MACHINE_DIV = 'PRAICAM'
--                     AND MACHINE_STATUS_DIV = 'ALARM'
--                     AND MACHINE_STATUS_VALUE = '1'
--                     ORDER BY ENTER_DATE DESC --등록일자 기준 최신데이터
--                   )
--                   WHERE ROWNUM = 1 ;
--                   
--           EXCEPTION WHEN NO_DATA_FOUND THEN 
--                RETURN 'None' ;
--           END ;
    END IF ;

  RETURN LVS_RETURN;
EXCEPTION WHEN OTHERS THEN 

    RETURN 'DB Error' ;

END F_GET_LAST_ALARM_BY_TYPE;

/
--------------------------------------------------------
--  DDL for Function F_GET_LAST_WORK_DATETIME
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE FUNCTION "INFINITY21_JSFMS"."F_GET_LAST_WORK_DATETIME" 
(
  P_MACHINE_CODE IN VARCHAR2 ,
  P_DATETIME IN DATE 
) RETURN DATE AS 

LVDT_RETURN DATE ;
BEGIN

  SELECT PLAN_END_DATE 
    INTO LVDT_RETURN
    FROM IPLN_WORK_TIME
   WHERE PLAN_DATE = TRUNC(P_DATETIME) 
     AND MACHINE_CODE = P_MACHINE_CODE  ;

  RETURN LVDT_RETURN;

EXCEPTION WHEN OTHERS THEN 
          RETURN SYSDATE ;

END F_GET_LAST_WORK_DATETIME;

/
--------------------------------------------------------
--  DDL for Function F_GET_MACHINE_CODE_BY_ADDRESS
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE FUNCTION "INFINITY21_JSFMS"."F_GET_MACHINE_CODE_BY_ADDRESS" 
(
  P_PLC_CODE IN VARCHAR2 
, P_TAG_ADDRESS IN VARCHAR2 
) RETURN VARCHAR2 AS 

LVS_RETURN VARCHAR2(30) ;

BEGIN

  --설비까지 걸어야 중복이 없는데 
  SELECT MIN(MACHINE_CODE)
    INTO LVS_RETURN 
    FROM ICOM_PLC_TAG_MASTER
   WHERE PLC_CODE = P_PLC_CODE
     AND TAG_ADDRESS = P_TAG_ADDRESS ;

  RETURN NVL(LVS_RETURN, '*');

  EXCEPTION WHEN NO_DATA_FOUND THEN 
        RETURN '*' ;
     WHEN OTHERS THEN
        RAISE_APPLICATION_ERROR( -20001 , 'PLC CODE='||P_PLC_CODE||'=>'||P_TAG_ADDRESS||' '||SQLERRM );
END F_GET_MACHINE_CODE_BY_ADDRESS;

/
--------------------------------------------------------
--  DDL for Function F_GET_MACHINE_NAME
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE FUNCTION "INFINITY21_JSFMS"."F_GET_MACHINE_NAME" 
(
  P_MACHINE_CODE IN VARCHAR2 
) RETURN VARCHAR2 AS 
LVS_RETURN VARCHAR2(100) ;
BEGIN

  SELECT MACHINE_NAME 
    INTO LVS_RETURN 
    FROM ICOM_MACHINE_MASTER 
   WHERE MACHINE_CODE = P_MACHINE_CODE  ;

   RETURN LVS_RETURN;
   EXCEPTION WHEN OTHERS THEN 
     RETURN P_MACHINE_CODE||' NOT FOUND' ;
END F_GET_MACHINE_NAME;

/
--------------------------------------------------------
--  DDL for Function F_GET_TICKS_CONVERT
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE FUNCTION "INFINITY21_JSFMS"."F_GET_TICKS_CONVERT" 
(
  P_DATETIME IN VARCHAR2 
) RETURN VARCHAR2 AS 

LVS_RETURN VARCHAR2(20) ;
BEGIN

--9/24 

SELECT to_date('1970-01-01 00:00:00','YYYY-MM-DD HH24:MI:SS') + ((P_DATETIME - 621355968000000000 )  /10000000 )/60/60/24
  INTO LVS_RETURN
  FROM DUAL ; 
  RETURN TRIM(LVS_RETURN);

END F_GET_TICKS_CONVERT;

/
--------------------------------------------------------
--  DDL for Function F_GET_TODAY_ALARM_COUNT
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE FUNCTION "INFINITY21_JSFMS"."F_GET_TODAY_ALARM_COUNT" 
(
  P_MACHINE_CODE IN VARCHAR2 DEFAULT '%' 
) RETURN NUMBER AS 

LVL_RETURN NUMBER ; 
BEGIN

     SELECT COUNT(*) INTO LVL_RETURN 
       FROM VIEW_ALARM_DATA_RAW
      WHERE MACHINE_DATETIME >= TO_CHAR(SYSDATE , 'YYYYMMDD')||'073000'
        AND MACHINE_CODE LIKE P_MACHINE_CODE ;

        RETURN LVL_RETURN ;

END F_GET_TODAY_ALARM_COUNT;

/
--------------------------------------------------------
--  DDL for Function F_GET_TODAY_STOP_COUNT
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE FUNCTION "INFINITY21_JSFMS"."F_GET_TODAY_STOP_COUNT" 
(
  P_MACHINE_CODE IN VARCHAR2 DEFAULT '%' 
) RETURN NUMBER AS 
---------------------------------------------------
-- 당일 총 정이 횟수 
---------------------------------------------------
LVL_RETURN NUMBER ; 
BEGIN

     SELECT COUNT(*) INTO LVL_RETURN 
       FROM VIEW_DOWN_DATA_RAW
      WHERE PLC_DATETIME >= TO_CHAR(SYSDATE , 'YYYYMMDD')||'073000'
        AND MACHINE_CODE LIKE P_MACHINE_CODE ;

    RETURN LVL_RETURN ;

END F_GET_TODAY_STOP_COUNT;

/
--------------------------------------------------------
--  DDL for Function F_GET_TODAY_STOP_RATE
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE FUNCTION "INFINITY21_JSFMS"."F_GET_TODAY_STOP_RATE" 
(
  P_MACHINE_CODE IN VARCHAR2 DEFAULT '%' 
) RETURN NUMBER AS 
---------------------------------------------------
-- 당일 총 정지 횟수
-- F_GET_TODAY_WORK_LAST_TIME 월력을 찾아서 현재시간과 비교후 월력이전이면 현재시간
-- 월력이후면 월력마지막 시간을 리턴 
---------------------------------------------------
LVL_RETURN NUMBER ; 
LVL_TODAY_CAPA NUMBER := 380;

BEGIN

      SELECT TRUNC(SUM( (F_GET_TODAY_WORK_LAST_TIME( P_MACHINE_CODE , down_start_datetime ) - down_start_datetime ) * 24 * 60 ) , 2)
             --SUM(DOWN_TIME_TERM) DOWN_TIME_TERM
        INTO LVL_RETURN
      FROM VIEW_DOWN_DATA_RAW
     WHERE PLC_DATETIME >= TO_CHAR(SYSDATE  , 'YYYYMMDD')||'073000' 
       AND MACHINE_CODE = P_MACHINE_CODE
       AND TAG_CLASS LIKE '%'
      -- AND DOWN_TIME_TERM > 0  
       ;

     SELECT (SYSDATE - TO_DATE( TO_CHAR(SYSDATE , 'YYYYMMDD')||'073000' , 'YYYYMMDDHH24MISS' ) ) * 24 * 60 * 60
      INTO LVL_TODAY_CAPA
      FROM DUAL  ;

      IF LVL_TODAY_CAPA < 0 THEN 
          RETURN 0 ;
      END IF ;

      RETURN TRUNC( LVL_RETURN / LVL_TODAY_CAPA * 100 ,2 ) ;

END F_GET_TODAY_STOP_RATE;

/
--------------------------------------------------------
--  DDL for Function F_GET_TODAY_STOP_TIME
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE FUNCTION "INFINITY21_JSFMS"."F_GET_TODAY_STOP_TIME" 
(
  P_MACHINE_CODE IN VARCHAR2 DEFAULT '%' 
) RETURN NUMBER AS 
---------------------------------------------------
-- 당일 총 정이 횟수 
---------------------------------------------------
LVL_RETURN NUMBER ; 
BEGIN

  SELECT SUM(DOWN_TIME_TERM) DOWN_TIME_TERM
     INTO LVL_RETURN
  FROM VIEW_DOWN_DATA_RAW
 WHERE PLC_DATETIME >= TO_CHAR(SYSDATE , 'YYYYMMDD')||'073000' 
   AND MACHINE_CODE LIKE P_MACHINE_CODE
   AND TAG_CLASS LIKE '%'
   AND DOWN_TIME_TERM > 0  ;

   RETURN LVL_RETURN ;

END F_GET_TODAY_STOP_TIME;

/
--------------------------------------------------------
--  DDL for Function F_GET_TODAY_WORK_END_TIME
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE FUNCTION "INFINITY21_JSFMS"."F_GET_TODAY_WORK_END_TIME" 
RETURN DATE AS 

LVDT_RETURN DATE ;
BEGIN

--
--    BEGIN 
--      SELECT PLAN_END_DATE 
--        INTO LVDT_RETURN
--        FROM IPLN_WORK_TIME
--       WHERE PLAN_DATE = TRUNC(P_DATETIME) 
--         AND MACHINE_CODE = P_MACHINE_CODE  ;
--         
--    EXCEPTION WHEN NO_DATA_FOUND THEN 
--          LVDT_RETURN := NULL ;
--    END ;

--    IF   LVDT_RETURN IS NULL THEN 

       SELECT TO_DATE( TO_CHAR(SYSDATE, 'YYYY/MM/DD')||' '||'17:30:00' , 'YYYY/MM/DD HH24:MI:SS')
         INTO LVDT_RETURN
         FROM DUAL  ;
 --   END IF ;

     RETURN LVDT_RETURN ;
EXCEPTION WHEN OTHERS THEN 
          RETURN SYSDATE ;

END F_GET_TODAY_WORK_END_TIME;

/
--------------------------------------------------------
--  DDL for Function F_GET_TODAY_WORK_LAST_TIME
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE FUNCTION "INFINITY21_JSFMS"."F_GET_TODAY_WORK_LAST_TIME" ( P_MACHINE_CODE IN VARCHAR2 , P_DATETIME IN DATE 
 
 )
RETURN DATE AS 

LVDT_RETURN DATE ;
LVDT_PLAN_END_TIME DATE;
BEGIN

------------------------------------------------------
-- 월력에서 당일 작업종료시간 추출
------------------------------------------------------

    BEGIN 
        SELECT PLAN_END_TIME
          INTO LVDT_PLAN_END_TIME
          FROM ICOM_WORK_CAPA_CALENDAR
         WHERE PLAN_DATE = TRUNC(P_DATETIME) 
           AND MACHINE_CODE = P_MACHINE_CODE  ;
    EXCEPTION WHEN NO_DATA_FOUND THEN 
           --Ｃ＠만 어떤 시간을 종료시간으로 봐야 하지 애매함.
           --고정시간으로 일단 리턴 
           LVDT_PLAN_END_TIME := TO_DATE( TO_CHAR(P_DATETIME, 'YYYY/MM/DD')||' '||'17:30:00' , 'YYYY/MM/DD HH24:MI:SS') ;
    END ;
-----------------------------------------------------
-- 생성된 월력의 작업종료시간 이전이면 현재까지가 종료시간
-----------------------------------------------------
       IF SYSDATE < LVDT_PLAN_END_TIME THEN
          RETURN SYSDATE ;
        ELSE
            -----------------------------------------------------
            -- 생성된 월력의 작업종료 시간이후면 종료시간까지만
            -----------------------------------------------------        
           RETURN LVDT_PLAN_END_TIME ;
        END IF; 

EXCEPTION WHEN OTHERS THEN 
          RETURN TO_DATE( TO_CHAR(P_DATETIME, 'YYYY/MM/DD')||' '||'17:30:00' , 'YYYY/MM/DD HH24:MI:SS') ;

END F_GET_TODAY_WORK_LAST_TIME;

/
--------------------------------------------------------
--  DDL for Function F_GET_TODAY_WORK_START_TIME
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE FUNCTION "INFINITY21_JSFMS"."F_GET_TODAY_WORK_START_TIME" RETURN DATE AS 


LVDT_RETURN DATE ;
BEGIN

--
--    BEGIN 
--      SELECT PLAN_START_DATE 
--        INTO LVDT_RETURN
--        FROM IPLN_WORK_TIME
--       WHERE PLAN_DATE = TRUNC(P_DATETIME) 
--         AND MACHINE_CODE = P_MACHINE_CODE  ;
--         
--    EXCEPTION WHEN NO_DATA_FOUND THEN 
--          LVDT_RETURN := NULL ;
--    END ;

--    IF   LVDT_RETURN IS NULL THEN 

       SELECT TO_DATE( TO_CHAR(SYSDATE, 'YYYY/MM/DD')||' '||'07:30:00' , 'YYYY/MM/DD HH24:MI:SS')
         INTO LVDT_RETURN
         FROM DUAL  ;
 --   END IF ;

     RETURN LVDT_RETURN ;

END F_GET_TODAY_WORK_START_TIME;

/
--------------------------------------------------------
--  DDL for Function F_GET_UNION_DOWN_TIME
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE FUNCTION "INFINITY21_JSFMS"."F_GET_UNION_DOWN_TIME" (
    p_dateset IN DATE ,
    p_dateend IN DATE
) RETURN NUMBER AS
    lvf_return NUMBER;
    LVI_DAYS NUMBER ;
BEGIN

   SELECT p_dateend - p_dateset INTO LVI_DAYS
    FROM DUAL ;

    SELECT
       ( (day * 24 * 60) / ( 34 * 480 * LVI_DAYS ) )  * 100
    INTO lvf_return
    FROM
        (
            SELECT
                ( MAX(down_end_datetime) - MIN(down_start_datetime)) 
                - SUM(greatest(down_start_datetime - last_end_time, 0)) day
            FROM
                (
                    SELECT
                        down_start_datetime,
                        down_end_datetime,
                        MAX(down_end_datetime)
                        OVER(
                            ORDER BY
                                down_start_datetime
                            ROWS BETWEEN UNBOUNDED PRECEDING AND 1 PRECEDING
                        ) last_end_time
                    FROM
                        view_down_data_raw
                    WHERE   down_start_datetime >= p_dateset
                        AND down_end_datetime   <  p_dateend
                )
        );

    RETURN lvf_return;
END f_get_union_down_time;

/
--------------------------------------------------------
--  DDL for Function F_GET_WORKSTAGE_NAME
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE FUNCTION "INFINITY21_JSFMS"."F_GET_WORKSTAGE_NAME" 
(
  P_WORKSTAGE_CODE IN VARCHAR2 
) RETURN VARCHAR2 AS 
LVS_RETURN VARCHAR2(100) ;
BEGIN

  SELECT WORKSTAGE_NAME 
    INTO LVS_RETURN 
    FROM ICOM_WORKSTAGE_MASTER 
   WHERE WORKSTAGE_CODE = P_WORKSTAGE_CODE  ;

   RETURN LVS_RETURN;
   EXCEPTION WHEN OTHERS THEN 
     RETURN P_WORKSTAGE_CODE||' NOT FOUND' ;
END F_GET_WORKSTAGE_NAME;

/
--------------------------------------------------------
--  DDL for Synonymn F_GET_BASECODE
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE SYNONYM "INFINITY21_JSFMS"."F_GET_BASECODE" FOR "INFINITY21_PIMMES"."F_GET_BASECODE"@"DBLINK_OSCW";
--------------------------------------------------------
--  DDL for Synonymn F_GET_MOLD_NAME
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE SYNONYM "INFINITY21_JSFMS"."F_GET_MOLD_NAME" FOR "INFINITY21_PIMMES"."F_GET_MOLD_NAME"@"DBLINK_OSCW";
--------------------------------------------------------
--  DDL for Synonymn F_GET_RESIN_NAME
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE SYNONYM "INFINITY21_JSFMS"."F_GET_RESIN_NAME" FOR "INFINITY21_PIMMES"."F_GET_RESIN_NAME"@"DBLINK_OSCW";
--------------------------------------------------------
--  DDL for Synonymn ICOM_ITEM_MASTER
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE SYNONYM "INFINITY21_JSFMS"."ICOM_ITEM_MASTER" FOR "INFINITY21_PIMMES"."ICOM_ITEM_MASTER"@"DBLINK_OSCW";
--------------------------------------------------------
--  DDL for Synonymn ICOM_MACHINE
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE SYNONYM "INFINITY21_JSFMS"."ICOM_MACHINE" FOR "INFINITY21_PIMMES"."ICOM_MACHINE"@"DBLINK_OSCW";
--------------------------------------------------------
--  DDL for Synonymn ICOM_MACHINE_STATUS
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE SYNONYM "INFINITY21_JSFMS"."ICOM_MACHINE_STATUS" FOR "INFINITY21_PIMMES"."ICOM_MACHINE_STATUS"@"DBLINK_OSCW";
--------------------------------------------------------
--  DDL for Synonymn ICOM_MOLD_ITEM
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE SYNONYM "INFINITY21_JSFMS"."ICOM_MOLD_ITEM" FOR "INFINITY21_PIMMES"."ICOM_MOLD_ITEM"@"DBLINK_OSCW";
--------------------------------------------------------
--  DDL for Synonymn ICOM_PRODUCTION_BOARD_HIST
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE SYNONYM "INFINITY21_JSFMS"."ICOM_PRODUCTION_BOARD_HIST" FOR "INFINITY21_PIMMES"."ICOM_PRODUCTION_BOARD_HIST"@"DBLINK_OSCW";
--------------------------------------------------------
--  DDL for Synonymn ICOM_RECIEVE_DATA_ACTUAL
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE SYNONYM "INFINITY21_JSFMS"."ICOM_RECIEVE_DATA_ACTUAL" FOR "INFINITY21_PIMMES"."ICOM_RECIEVE_DATA_ACTUAL"@"DBLINK_OSCW";
--------------------------------------------------------
--  DDL for Synonymn ICOM_RECIEVE_DATA_NG
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE SYNONYM "INFINITY21_JSFMS"."ICOM_RECIEVE_DATA_NG" FOR "INFINITY21_PIMMES"."ICOM_RECIEVE_DATA_NG"@"DBLINK_OSCW";
--------------------------------------------------------
--  DDL for Synonymn IPLN_WORK_ORDER_MASTER
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE SYNONYM "INFINITY21_JSFMS"."IPLN_WORK_ORDER_MASTER" FOR "INFINITY21_PIMMES"."IPLN_WORK_ORDER_MASTER"@"DBLINK_OSCW";
--------------------------------------------------------
--  DDL for Synonymn IPLN_WORK_TIME
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE SYNONYM "INFINITY21_JSFMS"."IPLN_WORK_TIME" FOR "INFINITY21_PIMMES"."IPLN_WORK_TIME"@"DBLINK_OSCW";
--------------------------------------------------------
--  DDL for Synonymn ISYS_BASECODE
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE SYNONYM "INFINITY21_JSFMS"."ISYS_BASECODE" FOR "INFINITY21_PIMMES"."ISYS_BASECODE"@"DBLINK_OSCW";
--------------------------------------------------------
--  DDL for Synonymn ISYS_CODE_MASTER
--------------------------------------------------------

  CREATE OR REPLACE EDITIONABLE SYNONYM "INFINITY21_JSFMS"."ISYS_CODE_MASTER" FOR "INFINITY21_PIMMES"."ISYS_CODE_MASTER"@"DBLINK_OSCW";
--------------------------------------------------------
--  Constraints for Table CCC
--------------------------------------------------------

  ALTER TABLE "INFINITY21_JSFMS"."CCC" MODIFY ("ID" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."CCC" MODIFY ("CTIME" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."CCC" MODIFY ("OTIME" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."CCC" MODIFY ("DATATAG_NAME" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."CCC" MODIFY ("DATATAG_TYPE" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."CCC" MODIFY ("VALUE_STR" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."CCC" MODIFY ("VALUE_NUM" NOT NULL ENABLE);
--------------------------------------------------------
--  Constraints for Table ICOM_MACHINE_DETAIL
--------------------------------------------------------

  ALTER TABLE "INFINITY21_JSFMS"."ICOM_MACHINE_DETAIL" ADD CONSTRAINT "PK_ICOM_MACHINE_DETAIL" PRIMARY KEY ("MACHINE_CODE", "MACHINE_PROPERTY", "ORGANIZATION_ID")
  USING INDEX "INFINITY21_JSFMS"."INDXICOM_MACHINE_DETAIL"  ENABLE;
--------------------------------------------------------
--  Constraints for Table ICOM_MACHINE_MASTER
--------------------------------------------------------

  ALTER TABLE "INFINITY21_JSFMS"."ICOM_MACHINE_MASTER" ADD CONSTRAINT "PK_ICOM_MACHINE" PRIMARY KEY ("MACHINE_CODE", "ORGANIZATION_ID")
  USING INDEX "INFINITY21_JSFMS"."INDXICOM_MACHINE_MASTER"  ENABLE;
--------------------------------------------------------
--  Constraints for Table ICOM_RECIEVE_DATA_RAW
--------------------------------------------------------

  ALTER TABLE "INFINITY21_JSFMS"."ICOM_RECIEVE_DATA_RAW" MODIFY ("MACHINE_DIV" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."ICOM_RECIEVE_DATA_RAW" MODIFY ("MACHINE_CODE" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."ICOM_RECIEVE_DATA_RAW" MODIFY ("MACHINE_STATUS_DIV" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."ICOM_RECIEVE_DATA_RAW" MODIFY ("MACHINE_STATUS_VALUE" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."ICOM_RECIEVE_DATA_RAW" MODIFY ("MACHINE_MESSAGE" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."ICOM_RECIEVE_DATA_RAW" MODIFY ("MACHINE_DATETIME" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."ICOM_RECIEVE_DATA_RAW" MODIFY ("ENTER_DATE" NOT NULL ENABLE);
--------------------------------------------------------
--  Constraints for Table ICOM_TROUBLE_SOLVE_HIST
--------------------------------------------------------

  ALTER TABLE "INFINITY21_JSFMS"."ICOM_TROUBLE_SOLVE_HIST" ADD CONSTRAINT "XPKICOM_TROUBLE_SOLVE" PRIMARY KEY ("MACHINE_CODE", "TROUBLE_DATETIME", "SOLVE_ACTION_DATETIME")
  USING INDEX "INFINITY21_JSFMS"."XPKICOM_TROUBLE_SOLVE"  ENABLE;
--------------------------------------------------------
--  Constraints for Table ICOM_WORKSTAGE_MASTER
--------------------------------------------------------

  ALTER TABLE "INFINITY21_JSFMS"."ICOM_WORKSTAGE_MASTER" ADD CONSTRAINT "PK_ICOM_WORKSTAGE_MSTER" PRIMARY KEY ("WORKSTAGE_CODE", "ORGANIZATION_ID")
  USING INDEX "INFINITY21_JSFMS"."INDXICOM_WORKSTAGE_MSTER"  ENABLE;
--------------------------------------------------------
--  Constraints for Table ISYS_BASECODE_MASTER
--------------------------------------------------------

  ALTER TABLE "INFINITY21_JSFMS"."ISYS_BASECODE_MASTER" ADD CONSTRAINT "XPKISYS_BASECODE_MASTER" PRIMARY KEY ("CODE_TYPE", "CODE_NAME", "ORGANIZATION_ID")
  USING INDEX "INFINITY21_JSFMS"."XPKISYS_BASECODE_MASTER"  ENABLE;
  ALTER TABLE "INFINITY21_JSFMS"."ISYS_BASECODE_MASTER" MODIFY ("CODE_NAME" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."ISYS_BASECODE_MASTER" MODIFY ("CODE_TYPE" NOT NULL ENABLE);
--------------------------------------------------------
--  Constraints for Table ISYS_CONFIG_MASTER
--------------------------------------------------------

  ALTER TABLE "INFINITY21_JSFMS"."ISYS_CONFIG_MASTER" ADD CONSTRAINT "XPKISYS_CONFIG_MASTER" PRIMARY KEY ("CONFIG_NAME", "ORGANIZATION_ID")
  USING INDEX "INFINITY21_JSFMS"."XPKISYS_CONFIG_MASTER"  ENABLE;
  ALTER TABLE "INFINITY21_JSFMS"."ISYS_CONFIG_MASTER" MODIFY ("CONFIG_NAME" NOT NULL ENABLE);
--------------------------------------------------------
--  Constraints for Table T_DASHBOARD_ITEMS
--------------------------------------------------------

  ALTER TABLE "INFINITY21_JSFMS"."T_DASHBOARD_ITEMS" MODIFY ("ITEM_IDENT" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."T_DASHBOARD_ITEMS" MODIFY ("DASHBOARD_IDENT" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."T_DASHBOARD_ITEMS" MODIFY ("ITEM_WIDTH" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."T_DASHBOARD_ITEMS" MODIFY ("ITEM_HEIGHT" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."T_DASHBOARD_ITEMS" MODIFY ("TYPE_ID" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."T_DASHBOARD_ITEMS" ADD CONSTRAINT "T_DASHBOARD_ITEMS_PK" PRIMARY KEY ("ITEM_IDENT")
  USING INDEX "INFINITY21_JSFMS"."T_DASHBOARD_ITEMS_PK"  ENABLE;
--------------------------------------------------------
--  Constraints for Table T_DASHBOARD_ITEM_TYPES
--------------------------------------------------------

  ALTER TABLE "INFINITY21_JSFMS"."T_DASHBOARD_ITEM_TYPES" MODIFY ("ICON" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."T_DASHBOARD_ITEM_TYPES" MODIFY ("DEFAULT_WIDTH" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."T_DASHBOARD_ITEM_TYPES" MODIFY ("DEFAULT_HEIGHT" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."T_DASHBOARD_ITEM_TYPES" ADD CONSTRAINT "T_DASHBOARD_ITEM_TYPES_PK" PRIMARY KEY ("TYPE_ID")
  USING INDEX "INFINITY21_JSFMS"."T_DASHBOARD_ITEM_TYPES_PK"  ENABLE;
--------------------------------------------------------
--  Constraints for Table XSCADA_ALARM_LOG
--------------------------------------------------------

  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_ALARM_LOG" MODIFY ("ID" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_ALARM_LOG" MODIFY ("CTIME" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_ALARM_LOG" MODIFY ("OTIME" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_ALARM_LOG" MODIFY ("NAME" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_ALARM_LOG" MODIFY ("LEVEL_" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_ALARM_LOG" MODIFY ("ZONE" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_ALARM_LOG" MODIFY ("STATUS" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_ALARM_LOG" MODIFY ("MESSAGE" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_ALARM_LOG" MODIFY ("DATATAG_NAME" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_ALARM_LOG" MODIFY ("ACK_YN" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_ALARM_LOG" ADD PRIMARY KEY ("ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "USERS"  ENABLE;
--------------------------------------------------------
--  Constraints for Table XSCADA_DATATAG
--------------------------------------------------------

  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_DATATAG" MODIFY ("ID" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_DATATAG" MODIFY ("CTIME" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_DATATAG" MODIFY ("MTIME" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_DATATAG" MODIFY ("NAME" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_DATATAG" MODIFY ("TYPE" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_DATATAG" ADD PRIMARY KEY ("ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS"  ENABLE;
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_DATATAG" ADD UNIQUE ("NAME")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS"  ENABLE;
--------------------------------------------------------
--  Constraints for Table XSCADA_DATATAG_LOG
--------------------------------------------------------

  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_DATATAG_LOG" MODIFY ("ID" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_DATATAG_LOG" MODIFY ("CTIME" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_DATATAG_LOG" MODIFY ("OTIME" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_DATATAG_LOG" MODIFY ("DATATAG_NAME" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_DATATAG_LOG" MODIFY ("DATATAG_TYPE" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_DATATAG_LOG" MODIFY ("VALUE_STR" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_DATATAG_LOG" MODIFY ("VALUE_NUM" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_DATATAG_LOG" ADD PRIMARY KEY ("ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS"  ENABLE;
--------------------------------------------------------
--  Constraints for Table XSCADA_DATA_REPOSITORY
--------------------------------------------------------

  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_DATA_REPOSITORY" MODIFY ("CTIME" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_DATA_REPOSITORY" MODIFY ("MTIME" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_DATA_REPOSITORY" MODIFY ("KEY_" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_DATA_REPOSITORY" MODIFY ("VALUE" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_DATA_REPOSITORY" ADD PRIMARY KEY ("KEY_")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "USERS"  ENABLE;
--------------------------------------------------------
--  Constraints for Table XSCADA_GROUP
--------------------------------------------------------

  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_GROUP" MODIFY ("IDX" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_GROUP" MODIFY ("CTIME" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_GROUP" MODIFY ("MTIME" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_GROUP" MODIFY ("GROUPFULLNAME" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_GROUP" MODIFY ("GROUPNAME" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_GROUP" MODIFY ("DELETED" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_GROUP" ADD PRIMARY KEY ("IDX")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "USERS"  ENABLE;
--------------------------------------------------------
--  Constraints for Table XSCADA_GROUP_KEY_REF
--------------------------------------------------------

  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_GROUP_KEY_REF" ADD CONSTRAINT "PK_XSCADA_GROUP_KEY_REF" PRIMARY KEY ("GROUPIDX", "KEYIDX")
  USING INDEX "INFINITY21_JSFMS"."PK_XSCADA_GROUP_KEY_REF"  ENABLE;
--------------------------------------------------------
--  Constraints for Table XSCADA_LOGIN_USER
--------------------------------------------------------

  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_LOGIN_USER" MODIFY ("CTIME" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_LOGIN_USER" MODIFY ("LASTACCESS" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_LOGIN_USER" MODIFY ("USERID" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_LOGIN_USER" MODIFY ("HOST" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_LOGIN_USER" MODIFY ("WEBLOGIN" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_LOGIN_USER" MODIFY ("TIMEOUTMIN" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_LOGIN_USER" ADD PRIMARY KEY ("SESSION_")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "USERS"  ENABLE;
--------------------------------------------------------
--  Constraints for Table XSCADA_MOBILE
--------------------------------------------------------

  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_MOBILE" MODIFY ("ID" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_MOBILE" MODIFY ("CTIME" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_MOBILE" MODIFY ("MTIME" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_MOBILE" MODIFY ("NAME" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_MOBILE" MODIFY ("TYPE" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_MOBILE" MODIFY ("HOST" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_MOBILE" MODIFY ("PUSH_KEY" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_MOBILE" ADD PRIMARY KEY ("ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "USERS"  ENABLE;
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_MOBILE" ADD UNIQUE ("NAME")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "USERS"  ENABLE;
--------------------------------------------------------
--  Constraints for Table XSCADA_PROPERTIES
--------------------------------------------------------

  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_PROPERTIES" MODIFY ("IDX" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_PROPERTIES" MODIFY ("NAME" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_PROPERTIES" MODIFY ("VALUE" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_PROPERTIES" ADD PRIMARY KEY ("IDX")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "USERS"  ENABLE;
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_PROPERTIES" ADD CONSTRAINT "XSCADA_PROPERTIES_UQ" UNIQUE ("NAME")
  USING INDEX "INFINITY21_JSFMS"."XSCADA_PROPERTIES_UQ"  ENABLE;
--------------------------------------------------------
--  Constraints for Table XSCADA_SECURITY_KEY
--------------------------------------------------------

  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_SECURITY_KEY" MODIFY ("IDX" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_SECURITY_KEY" MODIFY ("CTIME" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_SECURITY_KEY" MODIFY ("MTIME" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_SECURITY_KEY" MODIFY ("KEYVALUE" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_SECURITY_KEY" ADD PRIMARY KEY ("IDX")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "USERS"  ENABLE;
--------------------------------------------------------
--  Constraints for Table XSCADA_SECURITY_LOG
--------------------------------------------------------

  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_SECURITY_LOG" MODIFY ("IDX" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_SECURITY_LOG" MODIFY ("CTIME" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_SECURITY_LOG" MODIFY ("OTIME" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_SECURITY_LOG" MODIFY ("ID" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_SECURITY_LOG" MODIFY ("HOST" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_SECURITY_LOG" MODIFY ("ACTION" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_SECURITY_LOG" ADD PRIMARY KEY ("IDX")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS"  ENABLE;
--------------------------------------------------------
--  Constraints for Table XSCADA_SMS_LOG
--------------------------------------------------------

  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_SMS_LOG" MODIFY ("ID" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_SMS_LOG" MODIFY ("CTIME" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_SMS_LOG" MODIFY ("MTIME" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_SMS_LOG" MODIFY ("NAME" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_SMS_LOG" MODIFY ("USER_" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_SMS_LOG" MODIFY ("ADDRESS" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_SMS_LOG" MODIFY ("MESSAGE" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_SMS_LOG" MODIFY ("STATUS" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_SMS_LOG" MODIFY ("SENDING_TIME" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_SMS_LOG" MODIFY ("SENT_TIME" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_SMS_LOG" MODIFY ("TRIAL_COUNT" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_SMS_LOG" ADD PRIMARY KEY ("ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "USERS"  ENABLE;
--------------------------------------------------------
--  Constraints for Table XSCADA_SYSTEM
--------------------------------------------------------

  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_SYSTEM" MODIFY ("ID" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_SYSTEM" MODIFY ("CTIME" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_SYSTEM" MODIFY ("MTIME" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_SYSTEM" MODIFY ("KEY" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_SYSTEM" MODIFY ("VALUE" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_SYSTEM" ADD PRIMARY KEY ("ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS"  ENABLE;
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_SYSTEM" ADD UNIQUE ("KEY")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS"  ENABLE;
--------------------------------------------------------
--  Constraints for Table XSCADA_SYSTEM_LOG
--------------------------------------------------------

  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_SYSTEM_LOG" MODIFY ("ID" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_SYSTEM_LOG" MODIFY ("CTIME" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_SYSTEM_LOG" MODIFY ("OTIME" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_SYSTEM_LOG" MODIFY ("CATEGORY" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_SYSTEM_LOG" MODIFY ("LEVEL_" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_SYSTEM_LOG" MODIFY ("MESSAGE" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_SYSTEM_LOG" ADD PRIMARY KEY ("ID")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  STORAGE(INITIAL 65536 NEXT 1048576 MINEXTENTS 1 MAXEXTENTS 2147483645
  PCTINCREASE 0 FREELISTS 1 FREELIST GROUPS 1
  BUFFER_POOL DEFAULT FLASH_CACHE DEFAULT CELL_FLASH_CACHE DEFAULT)
  TABLESPACE "USERS"  ENABLE;
--------------------------------------------------------
--  Constraints for Table XSCADA_USER
--------------------------------------------------------

  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_USER" MODIFY ("IDX" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_USER" MODIFY ("CTIME" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_USER" MODIFY ("MTIME" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_USER" MODIFY ("USERID" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_USER" MODIFY ("PASSWORD" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_USER" MODIFY ("USERTYPE" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_USER" MODIFY ("ACTIVE" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_USER" MODIFY ("TIMEOUTMIN" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_USER" MODIFY ("PROVIDER" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_USER" MODIFY ("DELETED" NOT NULL ENABLE);
  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_USER" ADD PRIMARY KEY ("IDX")
  USING INDEX PCTFREE 10 INITRANS 2 MAXTRANS 255 COMPUTE STATISTICS 
  TABLESPACE "USERS"  ENABLE;
--------------------------------------------------------
--  Constraints for Table XSCADA_USER_GROUP_REF
--------------------------------------------------------

  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_USER_GROUP_REF" ADD CONSTRAINT "PK_XSCADA_USER_GROUP_REF" PRIMARY KEY ("USERIDX", "GROUPIDX")
  USING INDEX "INFINITY21_JSFMS"."PK_XSCADA_USER_GROUP_REF"  ENABLE;
--------------------------------------------------------
--  Constraints for Table XSCADA_USER_KEY_REF
--------------------------------------------------------

  ALTER TABLE "INFINITY21_JSFMS"."XSCADA_USER_KEY_REF" ADD CONSTRAINT "PK_XSCADA_USER_KEY_REF" PRIMARY KEY ("USERIDX", "KEYIDX")
  USING INDEX "INFINITY21_JSFMS"."PK_XSCADA_USER_KEY_REF"  ENABLE;
