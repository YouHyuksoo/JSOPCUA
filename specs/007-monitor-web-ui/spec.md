# Feature Specification: 실시간 설비 모니터링 웹 UI

**Feature Branch**: `007-monitor-web-ui`
**Created**: 2025-11-03
**Status**: Draft
**Input**: User description: "Feature 7: 실시간 설비 모니터링 웹 UI - WebSocket과 Oracle DB 연동을 통한 실시간 생산 라인 설비 상태 모니터링 대시보드"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 실시간 설비 상태 모니터링 (Priority: P1)

운영자가 생산 라인의 17개 설비 상태를 실시간으로 모니터링하여 설비 이상 발생 시 즉시 확인하고 대응할 수 있어야 합니다.

**Why this priority**: 실시간 설비 상태 모니터링은 Monitor UI의 핵심 기능으로, 설비 이상을 즉시 감지하여 생산 중단을 최소화하는 가장 중요한 가치를 제공합니다.

**Independent Test**: WebSocket 연결을 통해 1초마다 태그 폴링 결과를 수신하고, 설비 상태 박스의 색상이 5가지 상태(가동/비가동/정지/설비이상/접속이상)에 따라 정확하게 변경되는지 확인하여 독립적으로 테스트 가능합니다.

**Acceptance Scenarios**:

1. **Given** Monitor 웹 페이지에 접속한 상태, **When** WebSocket이 연결되고 폴링 엔진이 태그 값을 전송할 때, **Then** 17개 설비 상태 박스가 1초 이내에 업데이트되고 현재 상태 색상(Green/Yellow/Red/Purple/Gray)으로 표시됩니다.
2. **Given** 정상 가동 중인 설비(Green), **When** 설비 이상 태그 값이 감지될 때, **Then** 해당 설비 박스가 즉시 Purple(설비이상)으로 변경되고 박스 내 상태 텍스트가 "설비이상"으로 표시됩니다.
3. **Given** PLC 통신이 정상인 상태, **When** PLC 연결이 끊어질 때, **Then** 해당 설비 박스가 Gray(접속이상)으로 변경되고 상태 텍스트가 "접속이상"으로 표시됩니다.
4. **Given** WebSocket 연결이 끊긴 상태, **When** 재연결 시도가 성공할 때, **Then** 3초 이내에 WebSocket이 재연결되고 모든 설비 상태가 최신 데이터로 갱신됩니다.

---

### User Story 2 - 설비별 알람 통계 조회 (Priority: P2)

운영자가 17개 설비별 알람 발생 건수와 일반 이상 건수를 조회하여 어느 설비에 문제가 집중되는지 파악할 수 있어야 합니다.

**Why this priority**: 알람 통계는 설비별 문제 빈도를 파악하여 예방 정비 계획을 수립하는 데 중요한 지표를 제공하지만, 실시간 상태 모니터링보다는 우선순위가 낮습니다.

**Independent Test**: Oracle DB에서 설비별 알람 데이터를 집계하는 SQL 쿼리를 실행하고, 상단 그리드에 17개 컬럼(설비명)과 2개 행(알람 합계, 일반)으로 데이터가 정확하게 표시되는지 확인하여 독립적으로 테스트 가능합니다.

**Acceptance Scenarios**:

1. **Given** Monitor 웹 페이지에 접속한 상태, **When** 페이지가 로드될 때, **Then** 상단 그리드에 17개 설비별 알람 합계와 일반 건수가 10초 이내에 표시됩니다.
2. **Given** 상단 그리드가 표시된 상태, **When** 10초가 경과할 때, **Then** Oracle DB에서 최신 알람 데이터를 조회하여 그리드가 자동으로 갱신됩니다.
3. **Given** 특정 설비에 알람이 5건 발생한 상태, **When** 새로운 알람이 추가로 발생할 때, **Then** 다음 10초 주기 갱신 시 해당 설비의 알람 합계가 6으로 증가하여 표시됩니다.
4. **Given** Oracle DB 연결이 실패한 상태, **When** 그리드 갱신 시도 시, **Then** 에러 메시지가 표시되고 이전 데이터가 유지됩니다.

---

### User Story 3 - 최근 알람 목록 조회 (Priority: P3)

운영자가 최근 발생한 5개 알람의 발생 시간과 메시지를 조회하여 최신 이상 상황을 빠르게 파악할 수 있어야 합니다.

**Why this priority**: 최근 알람 목록은 최신 이상 상황을 파악하는 데 유용하지만, 실시간 설비 상태와 알람 통계에 비해 상대적으로 보조적인 기능입니다.

**Independent Test**: Oracle DB에서 최근 5개 알람을 시간 역순으로 조회하는 SQL 쿼리를 실행하고, 하단 우측 테이블에 시간(HH:MM) 형식과 알람 메시지가 정확하게 표시되는지 확인하여 독립적으로 테스트 가능합니다.

**Acceptance Scenarios**:

1. **Given** Monitor 웹 페이지에 접속한 상태, **When** 페이지가 로드될 때, **Then** 하단 우측 테이블에 최근 5개 알람이 시간 역순으로 표시됩니다(최신 알람이 상단).
2. **Given** 최근 알람 목록이 표시된 상태, **When** 10초가 경과할 때, **Then** Oracle DB에서 최신 알람 데이터를 조회하여 목록이 자동으로 갱신됩니다.
3. **Given** 새로운 알람이 발생한 상태, **When** 다음 10초 주기 갱신 시, **Then** 새 알람이 목록 최상단에 추가되고 가장 오래된 알람이 목록에서 제거됩니다(최대 5개 유지).
4. **Given** 알람이 5개 미만인 상태, **When** 목록 갱신 시, **Then** 실제 알람 건수만큼만 표시되고 빈 행은 표시되지 않습니다.

---

### Edge Cases

- **WebSocket 연결 실패 시**: 3초 간격으로 최대 5회 재연결을 시도하고, 모두 실패 시 "WebSocket 연결 실패" 경고 메시지를 표시합니다. 설비 상태 박스는 모두 Gray(접속이상)로 표시됩니다.
- **Oracle DB 연결 실패 시**: 상단 그리드와 최근 알람 목록에 에러 메시지를 표시하고, 이전에 표시된 데이터를 유지합니다. 10초마다 재시도하며, 연결 복구 시 자동으로 데이터를 갱신합니다.
- **설비 레이아웃 이미지 로드 실패 시**: 대체 텍스트("설비 레이아웃 이미지를 불러올 수 없습니다")를 표시하고, 설비 상태 박스는 이미지 없이도 정상적으로 표시됩니다.
- **브라우저 창 크기 변경 시**: 반응형 디자인을 적용하여 1280px 이상에서는 3단 레이아웃(상단 그리드 / 중앙 설비 레이아웃 / 하단 우측 알람)을 유지하고, 1280px 미만에서는 세로 스택 레이아웃으로 전환합니다.
- **17개 설비 중 일부만 폴링 그룹에 포함된 경우**: 폴링되지 않는 설비는 Gray(접속이상)로 표시하고 상태 텍스트를 "미설정"으로 표시합니다.

## Requirements *(mandatory)*

### Functional Requirements

#### 실시간 설비 상태 모니터링 (User Story 1)

- **FR-001**: 시스템은 WebSocket 연결을 통해 백엔드로부터 1초마다 17개 설비의 태그 폴링 결과를 수신해야 합니다.
- **FR-002**: 시스템은 수신한 태그 값을 기반으로 각 설비의 상태를 5가지 중 하나로 판단해야 합니다: 가동(Green), 비가동(Yellow), 정지(Red), 설비이상(Purple), 접속이상(Gray).
- **FR-003**: 시스템은 중앙 레이아웃에 설비 배치도 이미지를 배경으로 표시하고, 17개 설비 위치에 상태 박스를 오버레이로 배치해야 합니다.
- **FR-004**: 각 설비 상태 박스는 설비명, 현재 상태 텍스트, 배경 색상(상태에 따라 Green/Yellow/Red/Purple/Gray)을 표시해야 합니다.
- **FR-005**: 시스템은 WebSocket 연결이 끊어질 경우 3초 간격으로 최대 5회 자동 재연결을 시도해야 합니다.
- **FR-006**: WebSocket 재연결 실패 시 모든 설비 상태 박스를 Gray(접속이상)로 변경하고 경고 메시지를 표시해야 합니다.

#### 설비별 알람 통계 조회 (User Story 2)

- **FR-007**: 시스템은 페이지 로드 시 Oracle DB에서 17개 설비별 알람 통계를 조회하여 상단 그리드에 표시해야 합니다.
- **FR-008**: 상단 그리드는 17개 컬럼(설비명)과 2개 행(알람 합계, 일반)으로 구성되어야 합니다.
- **FR-009**: 시스템은 10초마다 Oracle DB에서 최신 알람 통계를 조회하여 상단 그리드를 자동으로 갱신해야 합니다.
- **FR-010**: 상단 그리드 우측 하단에 "C/Time: 10초" 텍스트를 표시하여 갱신 주기를 안내해야 합니다.
- **FR-011**: Oracle DB 연결 실패 시 에러 메시지를 표시하고 이전 데이터를 유지해야 합니다.

#### 최근 알람 목록 조회 (User Story 3)

- **FR-012**: 시스템은 페이지 로드 시 Oracle DB에서 최근 5개 알람을 시간 역순으로 조회하여 하단 우측 테이블에 표시해야 합니다.
- **FR-013**: 각 알람 행은 발생 시간(HH:MM 형식)과 알람 메시지를 표시해야 합니다.
- **FR-014**: 시스템은 10초마다 Oracle DB에서 최신 5개 알람을 조회하여 테이블을 자동으로 갱신해야 합니다.
- **FR-015**: 알람이 5개 미만인 경우 실제 건수만큼만 표시하고 빈 행은 표시하지 않아야 합니다.

#### 기술 요구사항

- **FR-016**: 시스템은 Next.js 14 App Router 기반 웹 애플리케이션으로 구현되어야 합니다.
- **FR-017**: 백엔드 WebSocket 서버는 ws://localhost:8000/ws/monitor 엔드포인트를 제공해야 합니다.
- **FR-018**: Oracle DB 연결은 python-oracledb 라이브러리를 사용해야 합니다(cx_Oracle 사용 금지).
- **FR-019**: 시스템은 1280px 이상 해상도에서 3단 레이아웃(상단 그리드 / 중앙 설비 레이아웃 / 하단 우측 알람)을 표시해야 합니다.
- **FR-020**: 시스템은 1280px 미만 해상도에서 반응형 세로 스택 레이아웃으로 전환해야 합니다.

### Key Entities

- **설비 상태 (Equipment Status)**: 17개 설비 각각의 실시간 상태를 나타내는 엔티티. 속성: 설비명, 설비 코드, 현재 상태(가동/비가동/정지/설비이상/접속이상), 마지막 업데이트 시간, 관련 태그 ID 목록.
- **알람 (Alarm)**: Oracle DB에 저장된 설비 이상 알람 엔티티. 속성: 알람 ID, 설비 코드, 발생 시간, 알람 메시지, 알람 유형(알람/일반).
- **알람 통계 (Alarm Statistics)**: 설비별 알람 발생 건수 집계 데이터. 속성: 설비 코드, 알람 합계 건수, 일반 건수, 집계 기간.
- **WebSocket 메시지 (WebSocket Message)**: 백엔드에서 프론트엔드로 전송되는 실시간 폴링 결과 메시지. 속성: 타임스탬프, 설비별 태그 값 배열, 메시지 타입(status_update/connection_status).

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: WebSocket 연결을 통해 설비 상태 업데이트가 1초 이내에 화면에 반영되어야 합니다(지연 시간 <1초).
- **SC-002**: 상단 알람 통계 그리드와 하단 최근 알람 목록이 10초 주기로 정확하게 갱신되어야 합니다(오차 범위 ±1초).
- **SC-003**: WebSocket 연결 실패 시 3초 이내에 자동 재연결을 시도해야 하며, 5회 재시도 동안 총 15초 이내에 재연결이 완료되거나 실패 메시지가 표시되어야 합니다.
- **SC-004**: 17개 설비 상태 박스가 5가지 색상 상태에 따라 100% 정확하게 표시되어야 합니다(색상 오류율 0%).
- **SC-005**: Oracle DB에서 알람 데이터를 조회하는 SQL 쿼리 실행 시간이 2초 이내여야 합니다(대용량 데이터 환경에서도 성능 보장).
- **SC-006**: 페이지 초기 로드 시 모든 UI 컴포넌트(상단 그리드, 중앙 레이아웃, 하단 알람 목록)가 5초 이내에 표시되어야 합니다.
- **SC-007**: 브라우저 창 크기 변경 시 0.3초 이내에 반응형 레이아웃으로 전환되어야 합니다.
- **SC-008**: 운영자가 별도의 새로고침 없이 최소 8시간 동안 연속으로 모니터링할 수 있어야 합니다(메모리 누수 없음, 안정성 보장).
