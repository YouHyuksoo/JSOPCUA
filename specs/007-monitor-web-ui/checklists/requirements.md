# Requirements Checklist - Feature 7: 실시간 설비 모니터링 웹 UI

## User Story 1: 실시간 설비 상태 모니터링 (P1)

### 기능 요구사항
- [ ] FR-001: WebSocket 연결을 통해 1초마다 17개 설비의 태그 폴링 결과를 수신
- [ ] FR-002: 수신한 태그 값을 기반으로 5가지 상태(가동/비가동/정지/설비이상/접속이상) 판단
- [ ] FR-003: 중앙 레이아웃에 설비 배치도 이미지 배경 표시 및 17개 설비 상태 박스 오버레이 배치
- [ ] FR-004: 각 설비 상태 박스에 설비명, 상태 텍스트, 배경 색상(Green/Yellow/Red/Purple/Gray) 표시
- [ ] FR-005: WebSocket 연결 끊김 시 3초 간격으로 최대 5회 자동 재연결 시도
- [ ] FR-006: WebSocket 재연결 실패 시 모든 설비 상태 박스를 Gray(접속이상)로 변경 및 경고 메시지 표시

### 수용 시나리오 검증
- [ ] AS1-1: WebSocket 연결 시 17개 설비 상태 박스가 1초 이내에 업데이트되고 상태 색상으로 표시
- [ ] AS1-2: 정상 가동 중(Green) 설비에서 이상 감지 시 즉시 Purple(설비이상)으로 변경
- [ ] AS1-3: PLC 연결 끊김 시 해당 설비 박스가 Gray(접속이상)로 변경
- [ ] AS1-4: WebSocket 재연결 성공 시 3초 이내 모든 설비 상태 최신 데이터로 갱신

### Edge Cases
- [ ] WebSocket 연결 실패 시 5회 재연결 시도 후 경고 메시지 표시 및 모든 설비 Gray 표시
- [ ] 설비 레이아웃 이미지 로드 실패 시 대체 텍스트 표시 및 설비 상태 박스 정상 표시
- [ ] 17개 설비 중 일부만 폴링 그룹에 포함된 경우 미설정 설비를 Gray(접속이상) + "미설정" 텍스트로 표시

---

## User Story 2: 설비별 알람 통계 조회 (P2)

### 기능 요구사항
- [ ] FR-007: 페이지 로드 시 Oracle DB에서 17개 설비별 알람 통계를 조회하여 상단 그리드에 표시
- [ ] FR-008: 상단 그리드를 17개 컬럼(설비명)과 2개 행(알람 합계, 일반)으로 구성
- [ ] FR-009: 10초마다 Oracle DB에서 최신 알람 통계를 조회하여 상단 그리드 자동 갱신
- [ ] FR-010: 상단 그리드 우측 하단에 "C/Time: 10초" 텍스트 표시
- [ ] FR-011: Oracle DB 연결 실패 시 에러 메시지 표시 및 이전 데이터 유지

### 수용 시나리오 검증
- [ ] AS2-1: 페이지 로드 시 상단 그리드에 17개 설비별 알람 합계와 일반 건수가 10초 이내에 표시
- [ ] AS2-2: 10초 경과 시 Oracle DB에서 최신 알람 데이터를 조회하여 그리드 자동 갱신
- [ ] AS2-3: 새 알람 발생 시 다음 10초 주기 갱신 시 해당 설비의 알람 합계가 증가하여 표시
- [ ] AS2-4: Oracle DB 연결 실패 시 에러 메시지 표시 및 이전 데이터 유지

### Edge Cases
- [ ] Oracle DB 연결 실패 시 에러 메시지 표시, 이전 데이터 유지, 10초마다 재시도
- [ ] Oracle DB 연결 복구 시 자동으로 데이터 갱신

---

## User Story 3: 최근 알람 목록 조회 (P3)

### 기능 요구사항
- [ ] FR-012: 페이지 로드 시 Oracle DB에서 최근 5개 알람을 시간 역순으로 조회하여 하단 우측 테이블에 표시
- [ ] FR-013: 각 알람 행에 발생 시간(HH:MM 형식)과 알람 메시지 표시
- [ ] FR-014: 10초마다 Oracle DB에서 최신 5개 알람을 조회하여 테이블 자동 갱신
- [ ] FR-015: 알람이 5개 미만인 경우 실제 건수만큼만 표시하고 빈 행은 표시하지 않음

### 수용 시나리오 검증
- [ ] AS3-1: 페이지 로드 시 하단 우측 테이블에 최근 5개 알람이 시간 역순으로 표시(최신 알람이 상단)
- [ ] AS3-2: 10초 경과 시 Oracle DB에서 최신 알람 데이터를 조회하여 목록 자동 갱신
- [ ] AS3-3: 새 알람 발생 시 다음 10초 주기 갱신 시 새 알람이 최상단에 추가되고 가장 오래된 알람 제거(최대 5개 유지)
- [ ] AS3-4: 알람이 5개 미만인 경우 실제 건수만큼만 표시하고 빈 행 미표시

---

## 기술 요구사항

### 프론트엔드
- [ ] FR-016: Next.js 14 App Router 기반 웹 애플리케이션으로 구현
- [ ] FR-019: 1280px 이상 해상도에서 3단 레이아웃(상단 그리드 / 중앙 설비 레이아웃 / 하단 우측 알람) 표시
- [ ] FR-020: 1280px 미만 해상도에서 반응형 세로 스택 레이아웃으로 전환

### 백엔드
- [ ] FR-017: WebSocket 서버 ws://localhost:8000/ws/monitor 엔드포인트 제공
- [ ] FR-018: Oracle DB 연결 시 python-oracledb 라이브러리 사용 (⚠️ cx_Oracle 사용 금지)

### 브라우저 호환성
- [ ] 브라우저 창 크기 변경 시 반응형 레이아웃 정상 전환

---

## Success Criteria 검증

### 성능 지표
- [ ] SC-001: WebSocket 연결을 통한 설비 상태 업데이트 지연 시간 <1초
- [ ] SC-002: 상단 알람 통계 그리드와 하단 최근 알람 목록 10초 주기 갱신 (오차 범위 ±1초)
- [ ] SC-003: WebSocket 연결 실패 시 3초 이내 재연결 시도, 5회 재시도 총 15초 이내 완료 또는 실패 메시지 표시
- [ ] SC-004: 17개 설비 상태 박스 5가지 색상 상태 100% 정확 표시 (색상 오류율 0%)
- [ ] SC-005: Oracle DB 알람 데이터 조회 SQL 쿼리 실행 시간 <2초
- [ ] SC-006: 페이지 초기 로드 시 모든 UI 컴포넌트 5초 이내 표시
- [ ] SC-007: 브라우저 창 크기 변경 시 0.3초 이내 반응형 레이아웃 전환
- [ ] SC-008: 별도 새로고침 없이 최소 8시간 연속 모니터링 가능 (메모리 누수 없음)

---

## 통합 테스트

### End-to-End 시나리오
- [ ] 페이지 로드 → WebSocket 연결 → 17개 설비 상태 표시 → Oracle DB 알람 통계 표시 → 10초 주기 갱신 → 8시간 연속 모니터링
- [ ] PLC 통신 정상 → 설비 이상 발생 → 설비 상태 Purple 변경 → 알람 DB 저장 → 10초 후 알람 통계 증가 확인
- [ ] WebSocket 연결 끊김 → 재연결 시도 5회 → 실패 시 경고 메시지 및 모든 설비 Gray 표시
- [ ] Oracle DB 연결 실패 → 에러 메시지 표시 및 이전 데이터 유지 → 10초 후 재시도 → 연결 복구 시 데이터 갱신

### 성능 테스트
- [ ] 17개 설비 동시 상태 변경 시 1초 이내 모든 박스 업데이트
- [ ] Oracle DB에서 알람 10,000건 이상 저장된 환경에서 쿼리 실행 시간 <2초
- [ ] 8시간 연속 모니터링 후 메모리 사용량 증가율 <10%

---

## 배포 전 최종 확인

- [ ] 모든 기능 요구사항 (FR-001 ~ FR-020) 구현 완료
- [ ] 모든 수용 시나리오 (AS1-1 ~ AS3-4) 테스트 통과
- [ ] 모든 성공 지표 (SC-001 ~ SC-008) 달성
- [ ] Edge Cases 모두 처리 완료
- [ ] 통합 테스트 및 성능 테스트 통과
- [ ] python-oracledb 사용 확인 (⚠️ cx_Oracle 미사용)
